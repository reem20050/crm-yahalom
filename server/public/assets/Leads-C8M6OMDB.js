import{r,c as U,e as X,d as u,m as $,j as e,w as F,t as G,q as H,X as J,z as l,l as o}from"./index-DNhSfFTF.js";import{u as V}from"./index.esm-CTjlG80w.js";import{t as W,o as Y,n as Z,s as t,l as ee}from"./types-C-QvhzS9.js";import{c as se}from"./Skeleton-B57jvd7z.js";import{u as ae,B as le}from"./BulkActionBar-DykjjnnX.js";import{P as te}from"./plus-42YS-w1A.js";import{F as P}from"./filter-DxBDU594.js";import{P as ne}from"./phone-C6GpoGt1.js";import{M as ie}from"./mail-elckFBEn.js";import{T}from"./trash-2-C8JFUyr_.js";const ce=Y({company_name:t().optional(),contact_name:t().min(1,"נדרש שם איש קשר"),phone:t().min(1,"נדרש מספר טלפון"),email:t().email("אימייל לא תקין").optional().or(ee("")),source:t().optional(),service_type:t().optional(),location:t().optional(),description:t().optional(),expected_value:Z().optional()}),y={new:{label:"חדש",class:"badge-info"},contacted:{label:"נוצר קשר",class:"badge-gray"},meeting_scheduled:{label:"פגישה נקבעה",class:"badge-warning"},proposal_sent:{label:"הצעה נשלחה",class:"badge-warning"},negotiation:{label:"משא ומתן",class:"badge-warning"},won:{label:"נסגר",class:"badge-success"},lost:{label:"אבד",class:"badge-danger"}},re={website:"אתר אינטרנט",whatsapp:"וואטסאפ",phone:"טלפון",referral:"המלצה"};function Ne(){var _;const[q,c]=r.useState(!1),[h,L]=r.useState(""),[p,B]=r.useState(""),[E,j]=r.useState(!1),[f,Q]=r.useState("contacted"),d=U(),{selectedIds:w,selectedCount:m,isSelected:S,toggleSelect:D,toggleAll:K,clearSelection:b}=ae(),{data:n,isLoading:A}=X({queryKey:["leads",{search:h,status:p}],queryFn:()=>o.getAll({search:h,status:p,limit:50}).then(s=>s.data)}),g=u({mutationFn:s=>o.create(s),onSuccess:()=>{d.invalidateQueries({queryKey:["leads"]}),l.success("ליד נוצר בהצלחה"),c(!1),v()},onError:()=>{l.error("שגיאה ביצירת ליד")}}),I=u({mutationFn:s=>o.delete(s),onSuccess:()=>{d.invalidateQueries({queryKey:["leads"]}),l.success("נמחק בהצלחה")},onError:()=>{l.error("שגיאה במחיקה")}}),N=u({mutationFn:({ids:s,status:i})=>o.bulkUpdateStatus(s,i),onSuccess:s=>{d.invalidateQueries({queryKey:["leads"]}),b(),j(!1),l.success(s.data.message||"לידים עודכנו")},onError:()=>l.error("שגיאה בעדכון לידים")}),k=u({mutationFn:s=>o.bulkDelete(s),onSuccess:s=>{d.invalidateQueries({queryKey:["leads"]}),b(),l.success(s.data.message||"לידים נמחקו")},onError:()=>l.error("שגיאה במחיקת לידים")}),{register:a,handleSubmit:O,reset:v,formState:{errors:x}}=V({resolver:W(ce)}),{can:C}=$(),z=s=>{g.mutate(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"לידים"}),e.jsx("p",{className:"page-subtitle",children:"ניהול לידים ומעקב מכירות"})]}),C("leads:create")&&e.jsxs("button",{onClick:()=>c(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"ליד חדש"]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(F,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש לפי שם, טלפון או חברה...",value:h,onChange:s=>L(s.target.value),className:"input pr-11"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-gray-400"}),e.jsxs("select",{value:p,onChange:s=>B(s.target.value),className:"input w-auto",children:[e.jsx("option",{value:"",children:"כל הסטטוסים"}),Object.entries(y).map(([s,{label:i}])=>e.jsx("option",{value:s,children:i},s))]})]})]})}),e.jsx("div",{className:"card p-0 overflow-hidden",children:A?e.jsx(se,{columns:7,rows:5}):((_=n==null?void 0:n.leads)==null?void 0:_.length)>0?e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 cursor-pointer",checked:m>0&&m===n.leads.length,onChange:()=>K(n.leads.map(s=>s.id))})}),e.jsx("th",{children:"איש קשר"}),e.jsx("th",{children:"חברה"}),e.jsx("th",{children:"מקור"}),e.jsx("th",{children:"סטטוס"}),e.jsx("th",{children:"תאריך יצירה"}),e.jsx("th",{})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:n.leads.map(s=>{var i,M;return e.jsxs("tr",{className:S(s.id)?"bg-primary-50":"",children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 cursor-pointer",checked:S(s.id),onChange:()=>D(s.id)})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.contact_name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-3 h-3"}),s.phone]}),s.email&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"}),s.email]})]})]})}),e.jsx("td",{children:s.company_name||"-"}),e.jsx("td",{children:re[s.source]||s.source||"-"}),e.jsx("td",{children:e.jsx("span",{className:((i=y[s.status])==null?void 0:i.class)||"badge-gray",children:((M=y[s.status])==null?void 0:M.label)||s.status})}),e.jsx("td",{children:e.jsxs("span",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(G,{className:"w-4 h-4"}),new Date(s.created_at).toLocaleDateString("he-IL")]})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{to:`/leads/${s.id}`,className:"text-primary-600 hover:text-primary-700 font-medium",children:"צפייה"}),C("leads:delete")&&e.jsx("button",{onClick:R=>{R.preventDefault(),confirm("האם אתה בטוח שברצונך למחוק ליד זה?")&&I.mutate(s.id)},className:"p-1.5 rounded-lg text-gray-300 hover:text-danger-500 hover:bg-danger-50 transition-colors",title:"מחק",children:e.jsx(T,{className:"w-4 h-4"})})]})})]},s.id)})})]})}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gray-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(F,{className:"w-7 h-7 text-gray-400"})}),e.jsx("p",{className:"text-gray-500 font-medium mb-1",children:"לא נמצאו לידים"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"התחל להוסיף לידים חדשים למעקב"}),e.jsx("button",{onClick:()=>c(!0),className:"btn-primary",children:"הוסף ליד ראשון"})]})}),q&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-content max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:"ליד חדש"}),e.jsx("button",{onClick:()=>{c(!1),v()},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(J,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:O(z),className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"col-span-2 sm:col-span-2",children:[e.jsx("label",{className:"label",children:"שם איש קשר *"}),e.jsx("input",{...a("contact_name"),className:"input"}),x.contact_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:x.contact_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון *"}),e.jsx("input",{...a("phone"),className:"input",dir:"ltr"}),x.phone&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:x.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אימייל"}),e.jsx("input",{...a("email"),type:"email",className:"input",dir:"ltr"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"שם חברה"}),e.jsx("input",{...a("company_name"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מקור"}),e.jsxs("select",{...a("source"),className:"input",children:[e.jsx("option",{value:"",children:"בחר מקור"}),e.jsx("option",{value:"website",children:"אתר אינטרנט"}),e.jsx("option",{value:"whatsapp",children:"וואטסאפ"}),e.jsx("option",{value:"phone",children:"טלפון"}),e.jsx("option",{value:"referral",children:"המלצה"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג שירות"}),e.jsxs("select",{...a("service_type"),className:"input",children:[e.jsx("option",{value:"",children:"בחר סוג"}),e.jsx("option",{value:"regular",children:"אבטחה קבועה"}),e.jsx("option",{value:"event",children:"אירוע חד-פעמי"}),e.jsx("option",{value:"both",children:"שניהם"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"מיקום / אזור"}),e.jsx("input",{...a("location"),className:"input"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"תיאור"}),e.jsx("textarea",{...a("description"),className:"input",rows:3})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:g.isPending,className:"btn-primary flex-1",children:g.isPending?"שומר...":"שמור"}),e.jsx("button",{type:"button",onClick:()=>{c(!1),v()},className:"btn-secondary",children:"ביטול"})]})]})]})}),E&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-content max-w-sm p-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4",children:["עדכון סטטוס (",m," לידים)"]}),e.jsxs("select",{value:f,onChange:s=>Q(s.target.value),className:"input w-full mb-4",children:[e.jsx("option",{value:"new",children:"חדש"}),e.jsx("option",{value:"contacted",children:"נוצר קשר"}),e.jsx("option",{value:"meeting_scheduled",children:"פגישה נקבעה"}),e.jsx("option",{value:"proposal_sent",children:"הצעה נשלחה"}),e.jsx("option",{value:"negotiation",children:"משא ומתן"}),e.jsx("option",{value:"won",children:"נסגר"}),e.jsx("option",{value:"lost",children:"אבד"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>j(!1),className:"btn-secondary",children:"ביטול"}),e.jsx("button",{onClick:()=>N.mutate({ids:[...w],status:f}),className:"btn-primary",disabled:N.isPending,children:N.isPending?"מעדכן...":"עדכן"})]})]})}),e.jsx(le,{selectedCount:m,onClear:b,actions:[{label:"עדכן סטטוס",onClick:()=>j(!0),icon:e.jsx(P,{className:"w-4 h-4"}),variant:"primary"},{label:"מחק נבחרים",onClick:()=>{confirm("האם למחוק את הלידים הנבחרים?")&&k.mutate([...w])},icon:e.jsx(T,{className:"w-4 h-4"}),variant:"danger",loading:k.isPending}]})]})}export{Ne as default};
