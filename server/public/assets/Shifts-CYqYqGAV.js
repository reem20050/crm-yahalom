import{c as de,M as j,N as q,O as ee,_ as Ue,Q as Pe,T as Ye,i as re,r as C,f as W,k as E,j as e,X as ne,z as p,V as Z,g as $e,n as Ne,W as _e,C as ke,A as Ce,Y as he,e as Te,o as We,Z as te,U as le,$,a0 as Fe,v as Le}from"./index-CqrGJYtT.js";import{u as Qe}from"./index.esm-_rtmzU6p.js";import{t as Ae,o as Ke,s as X,b as xe,n as He}from"./types-DzqlLUKh.js";import{C as Se}from"./check-circle-BYK8BHV6.js";import{P as fe}from"./plus-DI2jJC8-.js";import{T as Oe}from"./trash-2-C4dWQi6Z.js";import{C as Re,a as Ge}from"./chevron-right-BFYfsfnk.js";import{S as ce}from"./shield-B8_YxS0l.js";import{C as oe}from"./car-CWfDRwTN.js";import{M as ge}from"./map-pin-CiqgE478.js";import{M as ve}from"./message-circle-0WN99nHj.js";import{U as Ie}from"./user-plus-C23Aywau.js";/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=de("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=de("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=de("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function Q(n){if(n===null||n===!0||n===!1)return NaN;var a=Number(n);return isNaN(a)?a:a<0?Math.ceil(a):Math.floor(a)}function J(n,a){j(2,arguments);var t=q(n),s=Q(a);return isNaN(s)?new Date(NaN):(s&&t.setDate(t.getDate()+s),t)}function Ve(n,a){j(2,arguments);var t=q(n).getTime(),s=Q(a);return new Date(t+s)}function ze(n,a){var t,s,r,i,l,m,x,g;j(1,arguments);var h=ee(),f=Q((t=(s=(r=(i=a==null?void 0:a.weekStartsOn)!==null&&i!==void 0?i:a==null||(l=a.locale)===null||l===void 0||(m=l.options)===null||m===void 0?void 0:m.weekStartsOn)!==null&&r!==void 0?r:h.weekStartsOn)!==null&&s!==void 0?s:(x=h.locale)===null||x===void 0||(g=x.options)===null||g===void 0?void 0:g.weekStartsOn)!==null&&t!==void 0?t:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var o=q(n),c=o.getDay(),v=(c<f?7:0)+c-f;return o.setDate(o.getDate()-v),o.setHours(0,0,0,0),o}function Je(n){return j(1,arguments),n instanceof Date||Ue(n)==="object"&&Object.prototype.toString.call(n)==="[object Date]"}function Ze(n){if(j(1,arguments),!Je(n)&&typeof n!="number")return!1;var a=q(n);return!isNaN(Number(a))}function et(n,a){j(2,arguments);var t=Q(a);return Ve(n,-t)}var tt=864e5;function at(n){j(1,arguments);var a=q(n),t=a.getTime();a.setUTCMonth(0,1),a.setUTCHours(0,0,0,0);var s=a.getTime(),r=t-s;return Math.floor(r/tt)+1}function ae(n){j(1,arguments);var a=1,t=q(n),s=t.getUTCDay(),r=(s<a?7:0)+s-a;return t.setUTCDate(t.getUTCDate()-r),t.setUTCHours(0,0,0,0),t}function qe(n){j(1,arguments);var a=q(n),t=a.getUTCFullYear(),s=new Date(0);s.setUTCFullYear(t+1,0,4),s.setUTCHours(0,0,0,0);var r=ae(s),i=new Date(0);i.setUTCFullYear(t,0,4),i.setUTCHours(0,0,0,0);var l=ae(i);return a.getTime()>=r.getTime()?t+1:a.getTime()>=l.getTime()?t:t-1}function st(n){j(1,arguments);var a=qe(n),t=new Date(0);t.setUTCFullYear(a,0,4),t.setUTCHours(0,0,0,0);var s=ae(t);return s}var rt=6048e5;function nt(n){j(1,arguments);var a=q(n),t=ae(a).getTime()-st(a).getTime();return Math.round(t/rt)+1}function se(n,a){var t,s,r,i,l,m,x,g;j(1,arguments);var h=ee(),f=Q((t=(s=(r=(i=a==null?void 0:a.weekStartsOn)!==null&&i!==void 0?i:a==null||(l=a.locale)===null||l===void 0||(m=l.options)===null||m===void 0?void 0:m.weekStartsOn)!==null&&r!==void 0?r:h.weekStartsOn)!==null&&s!==void 0?s:(x=h.locale)===null||x===void 0||(g=x.options)===null||g===void 0?void 0:g.weekStartsOn)!==null&&t!==void 0?t:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var o=q(n),c=o.getUTCDay(),v=(c<f?7:0)+c-f;return o.setUTCDate(o.getUTCDate()-v),o.setUTCHours(0,0,0,0),o}function De(n,a){var t,s,r,i,l,m,x,g;j(1,arguments);var h=q(n),f=h.getUTCFullYear(),o=ee(),c=Q((t=(s=(r=(i=a==null?void 0:a.firstWeekContainsDate)!==null&&i!==void 0?i:a==null||(l=a.locale)===null||l===void 0||(m=l.options)===null||m===void 0?void 0:m.firstWeekContainsDate)!==null&&r!==void 0?r:o.firstWeekContainsDate)!==null&&s!==void 0?s:(x=o.locale)===null||x===void 0||(g=x.options)===null||g===void 0?void 0:g.firstWeekContainsDate)!==null&&t!==void 0?t:1);if(!(c>=1&&c<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var v=new Date(0);v.setUTCFullYear(f+1,0,c),v.setUTCHours(0,0,0,0);var T=se(v,a),N=new Date(0);N.setUTCFullYear(f,0,c),N.setUTCHours(0,0,0,0);var S=se(N,a);return h.getTime()>=T.getTime()?f+1:h.getTime()>=S.getTime()?f:f-1}function it(n,a){var t,s,r,i,l,m,x,g;j(1,arguments);var h=ee(),f=Q((t=(s=(r=(i=a==null?void 0:a.firstWeekContainsDate)!==null&&i!==void 0?i:a==null||(l=a.locale)===null||l===void 0||(m=l.options)===null||m===void 0?void 0:m.firstWeekContainsDate)!==null&&r!==void 0?r:h.firstWeekContainsDate)!==null&&s!==void 0?s:(x=h.locale)===null||x===void 0||(g=x.options)===null||g===void 0?void 0:g.firstWeekContainsDate)!==null&&t!==void 0?t:1),o=De(n,a),c=new Date(0);c.setUTCFullYear(o,0,f),c.setUTCHours(0,0,0,0);var v=se(c,a);return v}var lt=6048e5;function ct(n,a){j(1,arguments);var t=q(n),s=se(t,a).getTime()-it(t,a).getTime();return Math.round(s/lt)+1}function y(n,a){for(var t=n<0?"-":"",s=Math.abs(n).toString();s.length<a;)s="0"+s;return t+s}var K={y:function(a,t){var s=a.getUTCFullYear(),r=s>0?s:1-s;return y(t==="yy"?r%100:r,t.length)},M:function(a,t){var s=a.getUTCMonth();return t==="M"?String(s+1):y(s+1,2)},d:function(a,t){return y(a.getUTCDate(),t.length)},a:function(a,t){var s=a.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];case"aaaa":default:return s==="am"?"a.m.":"p.m."}},h:function(a,t){return y(a.getUTCHours()%12||12,t.length)},H:function(a,t){return y(a.getUTCHours(),t.length)},m:function(a,t){return y(a.getUTCMinutes(),t.length)},s:function(a,t){return y(a.getUTCSeconds(),t.length)},S:function(a,t){var s=t.length,r=a.getUTCMilliseconds(),i=Math.floor(r*Math.pow(10,s-3));return y(i,t.length)}},V={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},ot={G:function(a,t,s){var r=a.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return s.era(r,{width:"abbreviated"});case"GGGGG":return s.era(r,{width:"narrow"});case"GGGG":default:return s.era(r,{width:"wide"})}},y:function(a,t,s){if(t==="yo"){var r=a.getUTCFullYear(),i=r>0?r:1-r;return s.ordinalNumber(i,{unit:"year"})}return K.y(a,t)},Y:function(a,t,s,r){var i=De(a,r),l=i>0?i:1-i;if(t==="YY"){var m=l%100;return y(m,2)}return t==="Yo"?s.ordinalNumber(l,{unit:"year"}):y(l,t.length)},R:function(a,t){var s=qe(a);return y(s,t.length)},u:function(a,t){var s=a.getUTCFullYear();return y(s,t.length)},Q:function(a,t,s){var r=Math.ceil((a.getUTCMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return y(r,2);case"Qo":return s.ordinalNumber(r,{unit:"quarter"});case"QQQ":return s.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(r,{width:"wide",context:"formatting"})}},q:function(a,t,s){var r=Math.ceil((a.getUTCMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return y(r,2);case"qo":return s.ordinalNumber(r,{unit:"quarter"});case"qqq":return s.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(r,{width:"wide",context:"standalone"})}},M:function(a,t,s){var r=a.getUTCMonth();switch(t){case"M":case"MM":return K.M(a,t);case"Mo":return s.ordinalNumber(r+1,{unit:"month"});case"MMM":return s.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(r,{width:"wide",context:"formatting"})}},L:function(a,t,s){var r=a.getUTCMonth();switch(t){case"L":return String(r+1);case"LL":return y(r+1,2);case"Lo":return s.ordinalNumber(r+1,{unit:"month"});case"LLL":return s.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(r,{width:"wide",context:"standalone"})}},w:function(a,t,s,r){var i=ct(a,r);return t==="wo"?s.ordinalNumber(i,{unit:"week"}):y(i,t.length)},I:function(a,t,s){var r=nt(a);return t==="Io"?s.ordinalNumber(r,{unit:"week"}):y(r,t.length)},d:function(a,t,s){return t==="do"?s.ordinalNumber(a.getUTCDate(),{unit:"date"}):K.d(a,t)},D:function(a,t,s){var r=at(a);return t==="Do"?s.ordinalNumber(r,{unit:"dayOfYear"}):y(r,t.length)},E:function(a,t,s){var r=a.getUTCDay();switch(t){case"E":case"EE":case"EEE":return s.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(r,{width:"short",context:"formatting"});case"EEEE":default:return s.day(r,{width:"wide",context:"formatting"})}},e:function(a,t,s,r){var i=a.getUTCDay(),l=(i-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(l);case"ee":return y(l,2);case"eo":return s.ordinalNumber(l,{unit:"day"});case"eee":return s.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(i,{width:"short",context:"formatting"});case"eeee":default:return s.day(i,{width:"wide",context:"formatting"})}},c:function(a,t,s,r){var i=a.getUTCDay(),l=(i-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(l);case"cc":return y(l,t.length);case"co":return s.ordinalNumber(l,{unit:"day"});case"ccc":return s.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(i,{width:"narrow",context:"standalone"});case"cccccc":return s.day(i,{width:"short",context:"standalone"});case"cccc":default:return s.day(i,{width:"wide",context:"standalone"})}},i:function(a,t,s){var r=a.getUTCDay(),i=r===0?7:r;switch(t){case"i":return String(i);case"ii":return y(i,t.length);case"io":return s.ordinalNumber(i,{unit:"day"});case"iii":return s.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(r,{width:"short",context:"formatting"});case"iiii":default:return s.day(r,{width:"wide",context:"formatting"})}},a:function(a,t,s){var r=a.getUTCHours(),i=r/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(a,t,s){var r=a.getUTCHours(),i;switch(r===12?i=V.noon:r===0?i=V.midnight:i=r/12>=1?"pm":"am",t){case"b":case"bb":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(a,t,s){var r=a.getUTCHours(),i;switch(r>=17?i=V.evening:r>=12?i=V.afternoon:r>=4?i=V.morning:i=V.night,t){case"B":case"BB":case"BBB":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(a,t,s){if(t==="ho"){var r=a.getUTCHours()%12;return r===0&&(r=12),s.ordinalNumber(r,{unit:"hour"})}return K.h(a,t)},H:function(a,t,s){return t==="Ho"?s.ordinalNumber(a.getUTCHours(),{unit:"hour"}):K.H(a,t)},K:function(a,t,s){var r=a.getUTCHours()%12;return t==="Ko"?s.ordinalNumber(r,{unit:"hour"}):y(r,t.length)},k:function(a,t,s){var r=a.getUTCHours();return r===0&&(r=24),t==="ko"?s.ordinalNumber(r,{unit:"hour"}):y(r,t.length)},m:function(a,t,s){return t==="mo"?s.ordinalNumber(a.getUTCMinutes(),{unit:"minute"}):K.m(a,t)},s:function(a,t,s){return t==="so"?s.ordinalNumber(a.getUTCSeconds(),{unit:"second"}):K.s(a,t)},S:function(a,t){return K.S(a,t)},X:function(a,t,s,r){var i=r._originalDate||a,l=i.getTimezoneOffset();if(l===0)return"Z";switch(t){case"X":return pe(l);case"XXXX":case"XX":return I(l);case"XXXXX":case"XXX":default:return I(l,":")}},x:function(a,t,s,r){var i=r._originalDate||a,l=i.getTimezoneOffset();switch(t){case"x":return pe(l);case"xxxx":case"xx":return I(l);case"xxxxx":case"xxx":default:return I(l,":")}},O:function(a,t,s,r){var i=r._originalDate||a,l=i.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+ye(l,":");case"OOOO":default:return"GMT"+I(l,":")}},z:function(a,t,s,r){var i=r._originalDate||a,l=i.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+ye(l,":");case"zzzz":default:return"GMT"+I(l,":")}},t:function(a,t,s,r){var i=r._originalDate||a,l=Math.floor(i.getTime()/1e3);return y(l,t.length)},T:function(a,t,s,r){var i=r._originalDate||a,l=i.getTime();return y(l,t.length)}};function ye(n,a){var t=n>0?"-":"+",s=Math.abs(n),r=Math.floor(s/60),i=s%60;if(i===0)return t+String(r);var l=a;return t+String(r)+l+y(i,2)}function pe(n,a){if(n%60===0){var t=n>0?"-":"+";return t+y(Math.abs(n)/60,2)}return I(n,a)}function I(n,a){var t=a||"",s=n>0?"-":"+",r=Math.abs(n),i=y(Math.floor(r/60),2),l=y(r%60,2);return s+i+t+l}var be=function(a,t){switch(a){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Ee=function(a,t){switch(a){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},dt=function(a,t){var s=a.match(/(P+)(p+)?/)||[],r=s[1],i=s[2];if(!i)return be(a,t);var l;switch(r){case"P":l=t.dateTime({width:"short"});break;case"PP":l=t.dateTime({width:"medium"});break;case"PPP":l=t.dateTime({width:"long"});break;case"PPPP":default:l=t.dateTime({width:"full"});break}return l.replace("{{date}}",be(r,t)).replace("{{time}}",Ee(i,t))},ut={p:Ee,P:dt},mt=["D","DD"],ht=["YY","YYYY"];function xt(n){return mt.indexOf(n)!==-1}function ft(n){return ht.indexOf(n)!==-1}function je(n,a,t){if(n==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(a,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(n==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(a,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(n==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(a,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(n==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(a,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var gt=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,vt=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,yt=/^'([^]*?)'?$/,pt=/''/g,bt=/[a-zA-Z]/;function k(n,a,t){var s,r,i,l,m,x,g,h,f,o,c,v,T,N,S,F,U,O;j(2,arguments);var L=String(a),P=ee(),M=(s=(r=t==null?void 0:t.locale)!==null&&r!==void 0?r:P.locale)!==null&&s!==void 0?s:Pe,_=Q((i=(l=(m=(x=t==null?void 0:t.firstWeekContainsDate)!==null&&x!==void 0?x:t==null||(g=t.locale)===null||g===void 0||(h=g.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&m!==void 0?m:P.firstWeekContainsDate)!==null&&l!==void 0?l:(f=P.locale)===null||f===void 0||(o=f.options)===null||o===void 0?void 0:o.firstWeekContainsDate)!==null&&i!==void 0?i:1);if(!(_>=1&&_<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var H=Q((c=(v=(T=(N=t==null?void 0:t.weekStartsOn)!==null&&N!==void 0?N:t==null||(S=t.locale)===null||S===void 0||(F=S.options)===null||F===void 0?void 0:F.weekStartsOn)!==null&&T!==void 0?T:P.weekStartsOn)!==null&&v!==void 0?v:(U=P.locale)===null||U===void 0||(O=U.options)===null||O===void 0?void 0:O.weekStartsOn)!==null&&c!==void 0?c:0);if(!(H>=0&&H<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!M.localize)throw new RangeError("locale must contain localize property");if(!M.formatLong)throw new RangeError("locale must contain formatLong property");var Y=q(n);if(!Ze(Y))throw new RangeError("Invalid time value");var z=Ye(Y),d=et(Y,z),B={firstWeekContainsDate:_,weekStartsOn:H,locale:M,_originalDate:Y},ie=L.match(vt).map(function(w){var D=w[0];if(D==="p"||D==="P"){var R=ut[D];return R(w,M.formatLong)}return w}).join("").match(gt).map(function(w){if(w==="''")return"'";var D=w[0];if(D==="'")return jt(w);var R=ot[D];if(R)return!(t!=null&&t.useAdditionalWeekYearTokens)&&ft(w)&&je(w,a,String(n)),!(t!=null&&t.useAdditionalDayOfYearTokens)&&xt(w)&&je(w,a,String(n)),R(d,w,M.localize,B);if(D.match(bt))throw new RangeError("Format string contains an unescaped latin alphabet character `"+D+"`");return w}).join("");return ie}function jt(n){var a=n.match(yt);return a?a[1].replace(pt,"'"):n}const wt=[{value:0,label:"ראשון"},{value:1,label:"שני"},{value:2,label:"שלישי"},{value:3,label:"רביעי"},{value:4,label:"חמישי"},{value:5,label:"שישי"},{value:6,label:"שבת"}],Nt=[{value:"regular",label:"רגילה"},{value:"night",label:"לילה"},{value:"weekend",label:"סוף שבוע"},{value:"holiday",label:"חג"}];function _t({template:n,onClose:a}){var f,o;const t=re(),s=!!n,[r,i]=C.useState({name:(n==null?void 0:n.name)||"",customer_id:(n==null?void 0:n.customer_id)||"",site_id:(n==null?void 0:n.site_id)||"",start_time:(n==null?void 0:n.start_time)||"08:00",end_time:(n==null?void 0:n.end_time)||"16:00",required_employees:(n==null?void 0:n.required_employees)||1,requires_weapon:!!(n!=null&&n.requires_weapon),requires_vehicle:!!(n!=null&&n.requires_vehicle),days_of_week:n!=null&&n.days_of_week?typeof n.days_of_week=="string"?JSON.parse(n.days_of_week):n.days_of_week:[],shift_type:(n==null?void 0:n.shift_type)||"regular",default_notes:(n==null?void 0:n.default_notes)||""}),{data:l}=W({queryKey:["customers-list"],queryFn:()=>Ne.getAll({limit:100,status:"active"}).then(c=>c.data)}),{data:m}=W({queryKey:["sites",r.customer_id],queryFn:()=>r.customer_id?_e.getByCustomer(r.customer_id).then(c=>c.data):Promise.resolve({sites:[]}),enabled:!!r.customer_id}),x=E({mutationFn:c=>s?Z.update(n.id,c):Z.create(c),onSuccess:()=>{t.invalidateQueries({queryKey:["shift-templates"]}),p.success(s?"התבנית עודכנה":"התבנית נוצרה"),a()},onError:()=>p.error("שגיאה בשמירת תבנית")}),g=c=>{if(c.preventDefault(),!r.name.trim())return p.error("נא להזין שם לתבנית");if(r.days_of_week.length===0)return p.error("נא לבחור ימים בשבוע");x.mutate(r)},h=c=>{i(v=>({...v,days_of_week:v.days_of_week.includes(c)?v.days_of_week.filter(T=>T!==c):[...v.days_of_week,c].sort()}))};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/40 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:s?"עריכת תבנית":"תבנית משמרת חדשה"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(ne,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:g,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם התבנית *"}),e.jsx("input",{value:r.name,onChange:c=>i({...r,name:c.target.value}),className:"input",placeholder:'לדוג׳ "שמירה לילית - מגדלי עזריאלי"'})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"לקוח"}),e.jsxs("select",{value:r.customer_id,onChange:c=>i({...r,customer_id:c.target.value,site_id:""}),className:"input",children:[e.jsx("option",{value:"",children:"בחר לקוח..."}),(f=l==null?void 0:l.customers)==null?void 0:f.map(c=>e.jsx("option",{value:c.id,children:c.company_name},c.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אתר"}),e.jsxs("select",{value:r.site_id,onChange:c=>i({...r,site_id:c.target.value}),className:"input",disabled:!r.customer_id,children:[e.jsx("option",{value:"",children:"בחר אתר..."}),(o=m==null?void 0:m.sites)==null?void 0:o.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שעת התחלה *"}),e.jsx("input",{type:"time",value:r.start_time,onChange:c=>i({...r,start_time:c.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שעת סיום *"}),e.jsx("input",{type:"time",value:r.end_time,onChange:c=>i({...r,end_time:c.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"עובדים נדרשים"}),e.jsx("input",{type:"number",min:"1",value:r.required_employees,onChange:c=>i({...r,required_employees:parseInt(c.target.value)||1}),className:"input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג משמרת"}),e.jsx("select",{value:r.shift_type,onChange:c=>i({...r,shift_type:c.target.value}),className:"input",children:Nt.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"ימים בשבוע *"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:wt.map(c=>e.jsx("button",{type:"button",onClick:()=>h(c.value),className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${r.days_of_week.includes(c.value)?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:c.label},c.value))})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.requires_weapon,onChange:c=>i({...r,requires_weapon:c.target.checked}),className:"w-4 h-4 text-primary-600 rounded"}),e.jsx("span",{children:"נדרש נשק"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.requires_vehicle,onChange:c=>i({...r,requires_vehicle:c.target.checked}),className:"w-4 h-4 text-primary-600 rounded"}),e.jsx("span",{children:"נדרש רכב"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"הערות ברירת מחדל"}),e.jsx("textarea",{value:r.default_notes,onChange:c=>i({...r,default_notes:c.target.value}),className:"input min-h-[60px]",placeholder:"הערות שייכללו בכל משמרת שתיווצר..."})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"submit",disabled:x.isPending,className:"btn-primary flex-1",children:x.isPending?"שומר...":s?"עדכן תבנית":"צור תבנית"}),e.jsx("button",{type:"button",onClick:a,className:"btn-secondary",children:"ביטול"})]})]})]})})}function kt({templateId:n,templateName:a,onClose:t}){const s=re(),[r,i]=C.useState(""),[l,m]=C.useState(""),x=E({mutationFn:()=>Z.generate(n,r,l),onSuccess:h=>{s.invalidateQueries({queryKey:["shifts"]}),p.success(h.data.message||"משמרות נוצרו בהצלחה"),t()},onError:()=>p.error("שגיאה ביצירת משמרות מתבנית")}),g=h=>{if(h.preventDefault(),!r||!l)return p.error("נא לבחור טווח תאריכים");if(l<r)return p.error("תאריך סיום חייב להיות אחרי תאריך התחלה");x.mutate()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/40 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5"}),"יצירת משמרות מתבנית"]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(ne,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:g,className:"p-6 space-y-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 mb-2",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"תבנית:"})," ",a]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מתאריך *"}),e.jsx("input",{type:"date",value:r,onChange:h=>i(h.target.value),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"עד תאריך *"}),e.jsx("input",{type:"date",value:l,onChange:h=>m(h.target.value),className:"input"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"submit",disabled:x.isPending,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:x.isPending?"יוצר...":e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4"}),"צור משמרות"]})}),e.jsx("button",{type:"button",onClick:t,className:"btn-secondary",children:"ביטול"})]})]})]})})}const we={ok:{icon:Se,color:"text-green-500",label:"תקין"},issue_found:{icon:Ce,color:"text-yellow-500",label:"נמצאה בעיה"},requires_attention:{icon:Xe,color:"text-red-500",label:"דורש טיפול"}};function Ct({siteId:n,assignmentId:a}){const{data:t,isLoading:s}=W({queryKey:["patrols-site-today",n],queryFn:()=>he.getSiteToday(n).then(o=>o.data),enabled:!!n&&!a}),{data:r,isLoading:i}=W({queryKey:["patrols-shift",a],queryFn:()=>he.getShiftLogs(a).then(o=>o.data),enabled:!!a}),l=s||i,m=a?r==null?void 0:r.logs:t==null?void 0:t.logs,x=(t==null?void 0:t.checkpoints)||[],g=(t==null?void 0:t.total_checkpoints)||x.length,h=(t==null?void 0:t.visited_today)||0,f=g>0?Math.round(h/g*100):0;return l?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-primary-500 border-t-transparent"})}):e.jsxs("div",{className:"space-y-4",children:[!a&&g>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"התקדמות סיורים היום"}),e.jsxs("span",{className:"font-medium",children:[h,"/",g," (",f,"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all ${f>=80?"bg-green-500":f>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${f}%`}})})]}),!a&&x.length>0&&e.jsx("div",{className:"space-y-1",children:x.map(o=>{const c=m==null?void 0:m.some(v=>v.checkpoint_id===o.id);return e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded text-sm ${c?"bg-green-50 text-green-800":"bg-gray-50 text-gray-600"}`,children:[c?e.jsx(Se,{className:"w-4 h-4 text-green-500 flex-shrink-0"}):e.jsx(ke,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:o.name}),o.description&&e.jsxs("span",{className:"text-xs text-gray-400",children:["- ",o.description]})]},o.id)})}),m&&m.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"רישום סיורים"}),m.map(o=>{const c=we[o.status]||we.ok,v=c.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx(v,{className:`w-5 h-5 mt-0.5 flex-shrink-0 ${c.color}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-sm",children:o.checkpoint_name||"נקודת ביקורת"}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(o.checked_at).toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"})})]}),o.employee_name&&e.jsx("p",{className:"text-xs text-gray-500",children:o.employee_name}),o.observation&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:o.observation}),e.jsx("span",{className:`text-xs ${c.color}`,children:c.label})]})]},o.id)})]}):e.jsx("p",{className:"text-gray-400 text-sm text-center py-4",children:"אין רישומי סיורים"})]})}const Tt=Ke({site_id:X().optional(),customer_id:X().optional(),date:X().min(1,"נדרש תאריך"),start_time:X().min(1,"נדרשת שעת התחלה"),end_time:X().min(1,"נדרשת שעת סיום"),required_employees:He().min(1,"נדרש לפחות עובד אחד"),requires_weapon:xe().optional(),requires_vehicle:xe().optional(),notes:X().optional()});function St({shiftId:n,onClose:a}){const t=re(),{can:s}=Te(),[r,i]=C.useState("מאבטח"),[l,m]=C.useState(""),[x,g]=C.useState(!1),{data:h,isLoading:f}=W({queryKey:["shift-detail",n],queryFn:()=>$.getOne(n).then(d=>d.data)}),o=(h==null?void 0:h.shift)??h,c=(h==null?void 0:h.assignments)??(o==null?void 0:o.assignments)??[],{data:v}=W({queryKey:["employees-active"],queryFn:()=>Le.getAll({status:"active",limit:200}).then(d=>d.data)}),T=(v==null?void 0:v.employees)??[],N=E({mutationFn:d=>$.assign(n,d),onSuccess:()=>{t.invalidateQueries({queryKey:["shift-detail",n]}),t.invalidateQueries({queryKey:["shifts"]}),p.success("העובד שובץ בהצלחה"),m(""),i("מאבטח")},onError:()=>{p.error("שגיאה בשיבוץ העובד")}}),S=E({mutationFn:d=>$.unassign(n,d),onSuccess:()=>{t.invalidateQueries({queryKey:["shift-detail",n]}),t.invalidateQueries({queryKey:["shifts"]}),p.success("העובד הוסר מהמשמרת")},onError:()=>{p.error("שגיאה בהסרת העובד")}}),F=E({mutationFn:()=>$.delete(n),onSuccess:()=>{t.invalidateQueries({queryKey:["shifts"]}),p.success("המשמרת נמחקה בהצלחה"),a()},onError:()=>{p.error("שגיאה במחיקת המשמרת")}}),U=E({mutationFn:d=>$.remindOne(n,d),onSuccess:()=>p.success("תזכורת WhatsApp נשלחה!"),onError:()=>p.error("שגיאה בשליחת תזכורת")}),O=E({mutationFn:()=>$.remindAll(n),onSuccess:d=>p.success(d.data.message||"תזכורות נשלחו"),onError:()=>p.error("שגיאה בשליחת תזכורות")}),L=E({mutationFn:d=>$.checkIn(d),onSuccess:()=>{t.invalidateQueries({queryKey:["shift-detail",n]}),t.invalidateQueries({queryKey:["shifts"]}),p.success("צ'ק-אין בוצע בהצלחה")},onError:()=>p.error("שגיאה בביצוע צ'ק-אין")}),P=E({mutationFn:d=>$.checkOut(d),onSuccess:()=>{t.invalidateQueries({queryKey:["shift-detail",n]}),t.invalidateQueries({queryKey:["shifts"]}),p.success("צ'ק-אאוט בוצע בהצלחה")},onError:()=>p.error("שגיאה בביצוע צ'ק-אאוט")}),M=(o==null?void 0:o.date)===k(new Date,"yyyy-MM-dd"),_=()=>{O.mutate()},H=()=>{if(!l){p.error("נא לבחור עובד");return}N.mutate({employee_id:l,role:r})},Y=()=>{F.mutate()},z=d=>{switch(d){case"checked_in":return e.jsx("span",{className:"badge-success",children:"נכנס"});case"checked_out":return e.jsx("span",{className:"badge-info",children:"יצא"});case"no_show":return e.jsx("span",{className:"badge-danger",children:"לא הגיע"});default:return e.jsx("span",{className:"badge-warning",children:"משובץ"})}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/40 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-modal w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-slide-up",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:"פרטי משמרת"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(ne,{className:"w-5 h-5"})})]}),f?e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary-600 border-t-transparent"})}):o?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:o.company_name}),e.jsxs("p",{className:"text-gray-500",children:[o.site_name,o.site_address?` - ${o.site_address}`:""]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-700",children:o.date?k(new Date(o.date+"T00:00:00"),"EEEE, d MMMM yyyy",{locale:te}):""}),e.jsxs("p",{className:"text-gray-500",children:[o.start_time," - ",o.end_time]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-gray-400"}),e.jsxs("span",{children:["נדרשים: ",o.required_employees," עובדים"]})]}),o.requires_weapon&&e.jsxs("div",{className:"flex items-center gap-1 text-orange-600",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"נדרש נשק"})]}),o.requires_vehicle&&e.jsxs("div",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"נדרש רכב"})]})]}),o.notes&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-gray-600",children:o.notes})})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),"עובדים משובצים (",c.length,"/",o.required_employees,")"]}),c.length>0&&e.jsxs("button",{onClick:_,className:"text-sm flex items-center gap-1 px-3 py-1.5 rounded-lg bg-green-50 text-green-700 hover:bg-green-100 transition-colors",children:[e.jsx(ve,{className:"w-3.5 h-3.5"}),"שלח תזכורת לכולם"]})]}),c.length>0?e.jsx("div",{className:"space-y-2",children:c.map(d=>{var B;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-100 text-primary-700 rounded-full flex items-center justify-center text-sm font-medium",children:((B=d.employee_name)==null?void 0:B.charAt(0))||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:d.employee_name}),e.jsx("p",{className:"text-sm text-gray-500",children:d.role})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[z(d.status),M&&d.status==="assigned"&&e.jsxs("button",{onClick:()=>L.mutate(d.id),disabled:L.isPending,className:"flex items-center gap-1 px-2 py-1 text-xs rounded-lg bg-green-100 text-green-700 hover:bg-green-200 transition-colors",title:"צ'ק-אין",children:[e.jsx(Be,{className:"w-3.5 h-3.5"}),"כניסה"]}),M&&d.status==="checked_in"&&!d.check_out_time&&e.jsxs("button",{onClick:()=>P.mutate(d.id),disabled:P.isPending,className:"flex items-center gap-1 px-2 py-1 text-xs rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition-colors",title:"צ'ק-אאוט",children:[e.jsx(Fe,{className:"w-3.5 h-3.5"}),"יציאה"]}),d.check_in_time&&e.jsx("span",{className:"text-xs text-gray-400",title:"שעת כניסה",children:new Date(d.check_in_time).toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"})}),d.check_out_time&&e.jsxs("span",{className:"text-xs text-gray-400",title:"שעת יציאה",children:["- ",new Date(d.check_out_time).toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"})]}),d.employee_phone&&e.jsx("button",{onClick:()=>U.mutate(d.id),disabled:U.isPending,className:"text-green-500 hover:text-green-700 hover:bg-green-50 p-1.5 rounded-lg transition-colors",title:"שלח תזכורת WhatsApp (CRM)",children:e.jsx(ve,{className:"w-4 h-4"})}),s("shifts:assign")&&e.jsx("button",{onClick:()=>S.mutate(d.id),disabled:S.isPending,className:"text-red-500 hover:text-red-700 hover:bg-red-50 p-1.5 rounded-lg transition-colors text-sm",title:"הסר מהמשמרת",children:"הסר"})]})]},d.id)})}):e.jsx("p",{className:"text-gray-400 text-sm text-center py-4",children:"אין עובדים משובצים למשמרת זו"})]}),o.site_id&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5"}),"סיורים ונקודות ביקורת"]}),e.jsx(Ct,{siteId:o.site_id})]}),s("shifts:assign")&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5"}),"שבץ עובד"]}),e.jsxs("div",{className:"flex gap-3 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"label",children:"עובד"}),e.jsxs("select",{value:l,onChange:d=>m(d.target.value),className:"input",children:[e.jsx("option",{value:"",children:"בחר עובד..."}),T.map(d=>e.jsxs("option",{value:d.id,children:[d.first_name," ",d.last_name]},d.id))]})]}),e.jsxs("div",{className:"w-40",children:[e.jsx("label",{className:"label",children:"תפקיד"}),e.jsx("input",{type:"text",value:r,onChange:d=>i(d.target.value),className:"input",placeholder:"מאבטח"})]}),e.jsx("button",{onClick:H,disabled:N.isPending||!l,className:"btn-primary whitespace-nowrap",children:N.isPending?"משבץ...":"שבץ"})]})]}),s("shifts:delete")&&e.jsx("div",{className:"border-t pt-4",children:x?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ce,{className:"w-5 h-5 text-red-600"}),e.jsx("p",{className:"font-medium text-red-800",children:"האם אתה בטוח שברצונך למחוק משמרת זו?"})]}),e.jsx("p",{className:"text-sm text-red-600 mb-3",children:"פעולה זו תמחק את המשמרת ואת כל השיבוצים שלה. לא ניתן לבטל פעולה זו."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:Y,disabled:F.isPending,className:"btn-danger",children:F.isPending?"מוחק...":"כן, מחק"}),e.jsx("button",{onClick:()=>g(!1),className:"btn-secondary",children:"ביטול"})]})]}):e.jsxs("button",{onClick:()=>g(!0),className:"btn-danger flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"מחק משמרת"]})})]}):e.jsx("div",{className:"flex items-center justify-center h-48 text-gray-400",children:"לא נמצאו פרטי משמרת"})]})})}function Qt(){var D,R,ue,me;const[n,a]=C.useState(new Date),[t,s]=C.useState(!1),[r,i]=C.useState(null),[l,m]=C.useState(""),[x,g]=C.useState(!1),[h,f]=C.useState(!1),[o,c]=C.useState(null),v=ze(n,{weekStartsOn:0}),T=re(),{can:N}=Te(),{data:S,isLoading:F}=W({queryKey:["shifts",k(v,"yyyy-MM-dd")],queryFn:()=>$.getAll({start_date:k(v,"yyyy-MM-dd"),end_date:k(J(v,6),"yyyy-MM-dd")}).then(u=>u.data)}),{data:U}=W({queryKey:["customers-list"],queryFn:()=>Ne.getAll({limit:100,status:"active"}).then(u=>u.data)}),{data:O}=W({queryKey:["sites",l],queryFn:()=>l?_e.getByCustomer(l).then(u=>u.data):Promise.resolve({sites:[]}),enabled:!!l}),{data:L}=W({queryKey:["shift-templates"],queryFn:()=>Z.getAll().then(u=>u.data),enabled:x}),P=E({mutationFn:u=>Z.delete(u),onSuccess:()=>{T.invalidateQueries({queryKey:["shift-templates"]}),p.success("התבנית נמחקה")},onError:()=>p.error("שגיאה במחיקה")}),M=E({mutationFn:u=>$.create(u),onSuccess:()=>{T.invalidateQueries({queryKey:["shifts"]}),p.success("משמרת נוצרה בהצלחה"),s(!1),Y(),m("")},onError:()=>{p.error("שגיאה ביצירת משמרת")}}),{register:_,handleSubmit:H,reset:Y,setValue:z,formState:{errors:d}}=Qe({resolver:Ae(Tt),defaultValues:{date:k(new Date,"yyyy-MM-dd"),required_employees:1,requires_weapon:!1,requires_vehicle:!1}}),B=u=>{M.mutate({...u,customer_id:l||void 0})},ie=Array.from({length:7},(u,A)=>J(v,A)),w=u=>{var G;const A=k(u,"yyyy-MM-dd");return((G=S==null?void 0:S.shifts)==null?void 0:G.filter(b=>b.date===A))||[]};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"משמרות"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"לוח משמרות שבועי"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[N("shifts:create")&&e.jsxs("button",{onClick:()=>g(!x),className:"btn-secondary flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"תבניות"]}),N("shifts:create")&&e.jsxs("button",{onClick:()=>s(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"משמרת חדשה"]})]})]}),x&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"תבניות משמרות"}),e.jsxs("button",{onClick:()=>f(!0),className:"btn-primary text-sm flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4"}),"תבנית חדשה"]})]}),((D=L==null?void 0:L.templates)==null?void 0:D.length)>0?e.jsx("div",{className:"space-y-2",children:L.templates.map(u=>{const A=typeof u.days_of_week=="string"?JSON.parse(u.days_of_week):u.days_of_week,G=["א","ב","ג","ד","ה","ו","ש"];return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg ${u.is_active?"bg-blue-50 border border-blue-200":"bg-gray-50"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:u.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[u.company_name&&`${u.company_name} `,u.site_name&&`- ${u.site_name} `,"| ",u.start_time,"-",u.end_time,"| ",u.required_employees," עובדים"]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["ימים: ",(A||[]).map(b=>G[b]).join(", ")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>c({id:u.id,name:u.name}),className:"btn-success text-xs flex items-center gap-1 px-2 py-1",children:[e.jsx(Me,{className:"w-3.5 h-3.5"}),"צור משמרות"]}),e.jsx("button",{onClick:()=>P.mutate(u.id),className:"text-red-400 hover:text-red-600 p-1",children:e.jsx(Oe,{className:"w-4 h-4"})})]})]},u.id)})}):e.jsx("p",{className:"text-gray-400 text-center py-4",children:"אין תבניות. צור תבנית ראשונה כדי לחסוך זמן."})]}),h&&e.jsx(_t,{onClose:()=>f(!1)}),o&&e.jsx(kt,{templateId:o.id,templateName:o.name,onClose:()=>c(null)}),e.jsx("div",{className:"card !p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(J(n,-7)),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-gray-50 hover:bg-gray-100 text-gray-500 transition-colors",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsxs("h2",{className:"text-sm font-semibold text-gray-900",children:[k(v,"d MMMM",{locale:te})," -"," ",k(J(v,6),"d MMMM yyyy",{locale:te})]}),e.jsx("button",{onClick:()=>a(J(n,7)),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-gray-50 hover:bg-gray-100 text-gray-500 transition-colors",children:e.jsx(Ge,{className:"w-4 h-4"})})]})}),F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary-600 border-t-transparent"})}):e.jsx("div",{className:"grid grid-cols-7 gap-3",children:ie.map(u=>{const A=w(u),G=k(u,"yyyy-MM-dd")===k(new Date,"yyyy-MM-dd");return e.jsxs("div",{className:`card !p-3 min-h-[200px] ${G?"ring-2 ring-primary-500/40 !shadow-sm":""}`,children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("p",{className:"text-xs text-gray-400 font-medium",children:k(u,"EEEE",{locale:te})}),e.jsx("p",{className:`text-lg font-bold mt-0.5 ${G?"text-primary-600":"text-gray-900"}`,children:k(u,"d")})]}),e.jsx("div",{className:"space-y-2",children:A.length>0?A.map(b=>e.jsxs("div",{onClick:()=>i(b.id),className:`p-2 rounded-lg text-xs cursor-pointer hover:shadow-sm transition-all ${b.assigned_count>=b.required_employees?"bg-emerald-50/80 border border-emerald-100":"bg-amber-50/80 border border-amber-100"}`,children:[e.jsx("p",{className:"font-medium truncate text-gray-900",children:b.company_name}),e.jsx("p",{className:"text-gray-500 truncate",children:b.site_name}),e.jsxs("p",{className:"text-gray-400 mt-0.5 font-mono",children:[b.start_time," - ",b.end_time]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(le,{className:"w-3 h-3"}),e.jsxs("span",{children:[b.assigned_count,"/",b.required_employees]})]}),b.requires_weapon&&e.jsx(ce,{className:"w-3 h-3 text-amber-500"}),b.requires_vehicle&&e.jsx(oe,{className:"w-3 h-3 text-sky-500"})]})]},b.id)):e.jsx("p",{className:"text-xs text-gray-300 text-center py-4",children:"—"})})]},u.toISOString())})}),r&&e.jsx(St,{shiftId:r,onClose:()=>i(null)}),t&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/40 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:"משמרת חדשה"}),e.jsx("button",{onClick:()=>{s(!1),Y(),m("")},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(ne,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:H(B),className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"לקוח *"}),e.jsxs("select",{value:l,onChange:u=>{m(u.target.value),z("site_id","")},className:"input",children:[e.jsx("option",{value:"",children:"בחר לקוח..."}),(R=U==null?void 0:U.customers)==null?void 0:R.map(u=>e.jsx("option",{value:u.id,children:u.company_name},u.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אתר"}),e.jsxs("select",{..._("site_id"),className:"input",disabled:!l,children:[e.jsx("option",{value:"",children:l?((ue=O==null?void 0:O.sites)==null?void 0:ue.length)===0?"אין אתרים ללקוח זה":"בחר אתר...":"יש לבחור לקוח תחילה..."}),(me=O==null?void 0:O.sites)==null?void 0:me.map(u=>e.jsxs("option",{value:u.id,children:[u.name," - ",u.address]},u.id))]}),!l&&e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"בחר לקוח כדי לראות את רשימת האתרים"}),d.site_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.site_id.message})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תאריך *"}),e.jsx("input",{..._("date"),type:"date",className:"input"}),d.date&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.date.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שעת התחלה *"}),e.jsx("input",{..._("start_time"),type:"time",className:"input"}),d.start_time&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.start_time.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שעת סיום *"}),e.jsx("input",{..._("end_time"),type:"time",className:"input"}),d.end_time&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.end_time.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מספר עובדים נדרש *"}),e.jsx("input",{..._("required_employees",{valueAsNumber:!0}),type:"number",min:"1",className:"input w-32"}),d.required_employees&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.required_employees.message})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"דרישות"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{..._("requires_weapon"),type:"checkbox",className:"w-4 h-4 text-primary-600 rounded"}),e.jsx(ce,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{children:"נדרש נשק"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{..._("requires_vehicle"),type:"checkbox",className:"w-4 h-4 text-primary-600 rounded"}),e.jsx(oe,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{children:"נדרש רכב"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"הערות"}),e.jsx("textarea",{..._("notes"),className:"input min-h-[80px]"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:M.isPending,className:"btn-primary flex-1",children:M.isPending?"שומר...":"שמור"}),e.jsx("button",{type:"button",onClick:()=>{s(!1),Y(),m("")},className:"btn-secondary",children:"ביטול"})]})]})]})})]})}export{Qt as default};
