import{r as h,g as L,i as z,d as j,h as E,j as e,L as K,P as _,C as O,U as Q,X as I,z as w,V as q,m as U,l as V}from"./index-DBiankO6.js";import{u as R}from"./index.esm-DPhks1II.js";import{t as X,o as $,s as t,n as b,b as S}from"./types-BJfaIygm.js";import{P as B}from"./plus-DARtcNrK.js";import{M as G}from"./map-pin-7npkPiaC.js";import{S as H}from"./shield-DShWo00u.js";import{C as J}from"./car-CAfYEGYD.js";const W=$({event_name:t().min(1,"נדרש שם אירוע"),customer_id:t().optional(),lead_id:t().optional(),event_type:t().optional(),event_date:t().min(1,"נדרש תאריך"),start_time:t().min(1,"נדרשת שעת התחלה"),end_time:t().min(1,"נדרשת שעת סיום"),location:t().min(1,"נדרש מיקום"),address:t().optional(),expected_attendance:b().optional(),required_guards:b().min(1,"נדרש לפחות מאבטח אחד"),requires_weapon:S().optional(),requires_vehicle:S().optional(),special_equipment:t().optional(),price:b().optional(),notes:t().optional()}),N={quote:{label:"הצעת מחיר",class:"badge-gray"},approved:{label:"מאושר",class:"badge-info"},staffed:{label:"מאויש",class:"badge-success"},completed:{label:"הושלם",class:"badge-success"},invoiced:{label:"חשבונית הופקה",class:"badge-success"},cancelled:{label:"בוטל",class:"badge-danger"}},Y=[{value:"wedding",label:"חתונה"},{value:"barmitzvah",label:"בר/בת מצווה"},{value:"corporate",label:"אירוע חברה"},{value:"conference",label:"כנס"},{value:"party",label:"מסיבה"},{value:"sport",label:"אירוע ספורט"},{value:"concert",label:"הופעה/קונצרט"},{value:"other",label:"אחר"}];function ie(){var v,g,y;const[d,C]=h.useState(""),[k,i]=h.useState(!1),[n,m]=h.useState("new"),A=L(),{can:P}=z(),{data:c,isLoading:T}=j({queryKey:["events",{status:d}],queryFn:()=>q.getAll({status:d,limit:50}).then(s=>s.data)}),{data:x}=j({queryKey:["customers-list"],queryFn:()=>U.getAll({limit:100,status:"active"}).then(s=>s.data)}),{data:o}=j({queryKey:["leads-list"],queryFn:()=>V.getAll({limit:100,status:"new,contacted,quoted"}).then(s=>s.data)}),p=E({mutationFn:s=>q.create(s),onSuccess:()=>{A.invalidateQueries({queryKey:["events"]}),w.success("אירוע נוצר בהצלחה"),i(!1),u()},onError:()=>{w.error("שגיאה ביצירת אירוע")}}),{register:a,handleSubmit:F,reset:u,formState:{errors:l}}=R({resolver:X(W),defaultValues:{event_date:new Date().toISOString().split("T")[0],required_guards:1,requires_weapon:!1,requires_vehicle:!1,event_type:"other"}}),M=s=>{p.mutate(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"אירועים"}),e.jsx("p",{className:"text-gray-500",children:"ניהול אירועים חד-פעמיים"})]}),P("events:create")&&e.jsxs("button",{onClick:()=>i(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"אירוע חדש"]})]}),e.jsx("div",{className:"card",children:e.jsxs("select",{value:d,onChange:s=>C(s.target.value),className:"input w-auto",children:[e.jsx("option",{value:"",children:"כל הסטטוסים"}),Object.entries(N).map(([s,{label:r}])=>e.jsx("option",{value:s,children:r},s))]})}),T?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-primary-500 border-t-transparent"})}):((v=c==null?void 0:c.events)==null?void 0:v.length)>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:c.events.map(s=>{var r,f;return e.jsx(K,{to:`/events/${s.id}`,className:"card hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(_,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.event_name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.company_name})]}),e.jsx("span",{className:((r=N[s.status])==null?void 0:r.class)||"badge-gray",children:((f=N[s.status])==null?void 0:f.label)||s.status})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"w-4 h-4"}),s.event_date]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4"}),s.location]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("span",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Q,{className:"w-4 h-4"}),s.assigned_count,"/",s.required_guards," מאבטחים"]}),s.price&&e.jsxs("span",{className:"font-medium text-gray-900",children:["₪",s.price.toLocaleString()]})]})]})]})},s.id)})}):e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(_,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"לא נמצאו אירועים"}),e.jsx("button",{onClick:()=>i(!0),className:"btn-primary",children:"הוסף אירוע ראשון"})]}),k&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:"אירוע חדש"}),e.jsx("button",{onClick:()=>{i(!1),u()},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(I,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:F(M),className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מקור האירוע"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:n==="new",onChange:()=>m("new"),className:"w-4 h-4 text-primary-600"}),e.jsx("span",{children:"אירוע חדש"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:n==="customer",onChange:()=>m("customer"),className:"w-4 h-4 text-primary-600"}),e.jsx("span",{children:"לקוח קיים"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:n==="lead",onChange:()=>m("lead"),className:"w-4 h-4 text-primary-600"}),e.jsx("span",{children:"ליד"})]})]})]}),n==="customer"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"לקוח"}),e.jsxs("select",{...a("customer_id"),className:"input",children:[e.jsx("option",{value:"",children:"בחר לקוח..."}),(g=x==null?void 0:x.customers)==null?void 0:g.map(s=>e.jsx("option",{value:s.id,children:s.company_name},s.id))]})]}),n==="lead"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"ליד"}),e.jsxs("select",{...a("lead_id"),className:"input",children:[e.jsx("option",{value:"",children:"בחר ליד..."}),(y=o==null?void 0:o.leads)==null?void 0:y.map(s=>e.jsx("option",{value:s.id,children:s.company_name||s.contact_name},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"שם האירוע *"}),e.jsx("input",{...a("event_name"),className:"input",placeholder:"חתונה של ישראל ישראלי"}),l.event_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.event_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג אירוע"}),e.jsx("select",{...a("event_type"),className:"input",children:Y.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תאריך *"}),e.jsx("input",{...a("event_date"),type:"date",className:"input"}),l.event_date&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.event_date.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שעת התחלה *"}),e.jsx("input",{...a("start_time"),type:"time",className:"input"}),l.start_time&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.start_time.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שעת סיום *"}),e.jsx("input",{...a("end_time"),type:"time",className:"input"}),l.end_time&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.end_time.message})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"מיקום *"}),e.jsx("input",{...a("location"),className:"input",placeholder:"אולמי הירדן, הרצליה"}),l.location&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.location.message})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"כתובת מלאה"}),e.jsx("input",{...a("address"),className:"input",placeholder:"רחוב הירקון 123"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מספר משתתפים צפוי"}),e.jsx("input",{...a("expected_attendance",{valueAsNumber:!0}),type:"number",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מספר מאבטחים נדרש *"}),e.jsx("input",{...a("required_guards",{valueAsNumber:!0}),type:"number",min:"1",className:"input"}),l.required_guards&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.required_guards.message})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"דרישות"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{...a("requires_weapon"),type:"checkbox",className:"w-4 h-4 text-primary-600 rounded"}),e.jsx(H,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{children:"נדרש נשק"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{...a("requires_vehicle"),type:"checkbox",className:"w-4 h-4 text-primary-600 rounded"}),e.jsx(J,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{children:"נדרש רכב"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"ציוד מיוחד"}),e.jsx("input",{...a("special_equipment"),className:"input",placeholder:"מכשירי קשר, פנסים..."})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מחיר (₪)"}),e.jsx("input",{...a("price",{valueAsNumber:!0}),type:"number",step:"0.01",className:"input w-48",dir:"ltr"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"הערות"}),e.jsx("textarea",{...a("notes"),className:"input min-h-[80px]"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:p.isPending,className:"btn-primary flex-1",children:p.isPending?"שומר...":"שמור"}),e.jsx("button",{type:"button",onClick:()=>{i(!1),u()},className:"btn-secondary",children:"ביטול"})]})]})]})})]})}export{ie as default};
