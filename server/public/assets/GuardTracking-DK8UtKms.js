import{j as e,r as u,d,aa as f,a7 as y,C as m,T as j,a9 as w}from"./index-BuGAJY-0.js";import{G as v,M as N,a as x,I as b}from"./GoogleMapProvider-DJZsR8K0.js";function c(s){return s?Math.round((Date.now()-new Date(s+"Z").getTime())/6e4):1/0}function _(){const[s,n]=u.useState(null),{data:i=[],isLoading:h}=d({queryKey:["active-guards"],queryFn:()=>j.getActiveGuards().then(t=>t.data),refetchInterval:3e4}),{data:g=[]}=d({queryKey:["sites-with-coordinates"],queryFn:()=>w.getWithCoordinates().then(t=>t.data)}),p=i.filter(t=>t.latitude&&t.longitude);return i.filter(t=>!t.latitude||!t.longitude),e.jsxs("div",{className:"h-[calc(100vh-4rem)] flex",children:[e.jsxs("div",{className:"w-80 bg-white border-l border-gray-200 overflow-y-auto flex-shrink-0",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-primary-600"}),"×ž×¢×§×‘ ×©×•×ž×¨×™×"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[i.length," ×©×•×ž×¨×™× ×¤×¢×™×œ×™×"]})]}),h?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-primary-600 border-t-transparent"})}):i.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"××™×Ÿ ×©×•×ž×¨×™× ×¤×¢×™×œ×™× ×›×¨×’×¢"})]}):e.jsx("div",{className:"divide-y divide-gray-100",children:i.map(t=>{const a=c(t.recorded_at),l=a<10,r=a>=10&&a<60,o=!t.latitude;return e.jsxs("button",{onClick:()=>n(t),className:`w-full text-right p-3 hover:bg-gray-50 transition-colors ${(s==null?void 0:s.assignment_id)===t.assignment_id?"bg-primary-50":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${o?"bg-gray-400":l?"bg-green-500":r?"bg-amber-500":"bg-red-500"}`}),e.jsx("p",{className:"font-medium text-sm text-gray-900",children:t.employee_name})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.site_name," - ",t.company_name]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1 flex items-center gap-1",children:[e.jsx(m,{className:"w-3 h-3"}),o?"××™×Ÿ ×ž×™×§×•×":l?`×œ×¤× ×™ ${a} ×“×§×•×ª`:`×œ×¤× ×™ ${a} ×“×§×•×ª`]})]},t.assignment_id)})})]}),e.jsx("div",{className:"flex-1 relative",children:e.jsxs(N,{defaultCenter:{lat:31.5,lng:34.8},defaultZoom:8,gestureHandling:"greedy",className:"w-full h-full",children:[g.map(t=>e.jsx(x,{position:{lat:t.latitude,lng:t.longitude},title:t.name,icon:{url:"data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><circle cx="10" cy="10" r="8" fill="%239CA3AF" stroke="white" stroke-width="2"/></svg>'),scaledSize:{width:20,height:20,equals:()=>!1}}},`site-${t.id}`)),p.map(t=>{const r=c(t.recorded_at)<10?"%233B82F6":"%23F59E0B";return e.jsx(x,{position:{lat:t.latitude,lng:t.longitude},onClick:()=>n(t),title:t.employee_name,icon:{url:"data:image/svg+xml,"+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><circle cx="16" cy="16" r="14" fill="${r}" stroke="white" stroke-width="3"/><text x="16" y="21" text-anchor="middle" fill="white" font-size="14">ðŸ‘¤</text></svg>`),scaledSize:{width:32,height:32,equals:()=>!1}}},t.assignment_id)}),s&&s.latitude&&s.longitude&&e.jsx(b,{position:{lat:s.latitude,lng:s.longitude},onCloseClick:()=>n(null),children:e.jsxs("div",{className:"p-2 min-w-[180px]",dir:"rtl",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:s.employee_name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.site_name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.company_name}),s.recorded_at&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1 flex items-center gap-1",children:[e.jsx(m,{className:"w-3 h-3"}),"×¢×“×›×•×Ÿ ×œ×¤× ×™ ",c(s.recorded_at)," ×“×§×•×ª"]})]})})]})})]})}function q(){return e.jsx(v,{children:e.jsx(_,{})})}export{q as default};
