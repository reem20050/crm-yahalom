import{c as _,e as y,d as b,j as e,af as S,p,ag as C,x as j,z as h,ah as u,Z as K}from"./index-CYVBYVvl.js";import{S as d}from"./Skeleton-DLC-Bf1b.js";import{R as m}from"./refresh-cw-Dxqpz4z1.js";const L={shifts:"משמרות",invoices:"חשבוניות",shift_generation:"יצירת משמרות",invoice_generation:"יצירת חשבוניות",monthly_invoices:"חשבוניות חודשיות"};function P(n){try{return new Date(n).toLocaleDateString("he-IL",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return n}}function v(n,i){return n?n.length>i?n.slice(0,i)+"...":n:"-"}function A(){const n=_(),{data:i,isLoading:N}=y({queryKey:["automation-status"],queryFn:async()=>(await u.getStatus()).data}),{data:r}=y({queryKey:["shift-templates"],queryFn:async()=>(await K.getAll()).data}),{data:g,isLoading:w}=y({queryKey:["automation-logs"],queryFn:async()=>{var t;const s=await u.getLogs({limit:20});return((t=s.data)==null?void 0:t.logs)||s.data||[]}}),x=b({mutationFn:()=>u.generateShifts(),onSuccess:s=>{var l,c;const t=((l=s.data)==null?void 0:l.message)||"משמרות נוצרו בהצלחה",a=(c=s.data)==null?void 0:c.generated_count;h.success(a!=null?`${t} (${a} משמרות)`:t),n.invalidateQueries({queryKey:["automation-logs"]}),n.invalidateQueries({queryKey:["shifts"]})},onError:s=>{var t,a;h.error(((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"שגיאה ביצירת משמרות אוטומטית")}}),o=b({mutationFn:()=>u.generateMonthlyInvoices(),onSuccess:s=>{var l,c;const t=((l=s.data)==null?void 0:l.message)||"חשבוניות נוצרו בהצלחה",a=(c=s.data)==null?void 0:c.generated_count;h.success(a!=null?`${t} (${a} חשבוניות)`:t),n.invalidateQueries({queryKey:["automation-logs"]}),n.invalidateQueries({queryKey:["invoices"]})},onError:s=>{var t,a;h.error(((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"שגיאה ביצירת חשבוניות חודשיות")}}),f=(i==null?void 0:i.auto_generate_count)??(r!=null&&r.templates?r.templates.filter(s=>s.auto_generate).length:0),q=(i==null?void 0:i.total_templates)??(r!=null&&r.templates?r.templates.length:0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-xl flex items-center justify-center",children:e.jsx(S,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"הגדרות אוטומציה"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"ניהול יצירת משמרות וחשבוניות אוטומטית"})]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(p,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"יצירת משמרות אוטומטית"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"יצירת משמרות מתבניות פעילות לשבוע הקרוב"})]}),N?e.jsx(d,{className:"h-8 w-36"}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-blue-50 text-blue-700 rounded-lg text-sm font-medium",children:[e.jsx(C,{className:"w-4 h-4"}),f," / ",q," תבניות פעילות"]})]}),e.jsx("div",{className:"mt-4 flex items-center gap-3",children:e.jsxs("button",{onClick:()=>x.mutate(),disabled:x.isPending,className:"btn-primary flex items-center gap-2",children:[x.isPending?e.jsx(m,{className:"w-4 h-4 animate-spin"}):e.jsx(p,{className:"w-4 h-4"}),x.isPending?"יוצר משמרות...":"יצירת משמרות עכשיו"]})}),f===0&&!N&&e.jsx("div",{className:"mt-3 p-3 bg-amber-50 rounded-lg border border-amber-200",children:e.jsx("p",{className:"text-sm text-amber-800",children:'אין תבניות עם יצירה אוטומטית מופעלת. ניתן להפעיל מעמוד המשמרות בלשונית "תבניות".'})})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(j,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"יצירת חשבוניות חודשיות"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"הפקת חשבוניות אוטומטית לכל הלקוחות הפעילים על בסיס חוזים ומשמרות"})]}),e.jsx("div",{className:"mt-4 flex items-center gap-3",children:e.jsxs("button",{onClick:()=>o.mutate(),disabled:o.isPending,className:"btn-primary flex items-center gap-2",children:[o.isPending?e.jsx(m,{className:"w-4 h-4 animate-spin"}):e.jsx(j,{className:"w-4 h-4"}),o.isPending?"יוצר חשבוניות...":"יצירת חשבוניות חודשיות"]})})]})]})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 text-lg flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-gray-400"}),"יומן יצירות אוטומטיות"]}),e.jsxs("button",{onClick:()=>n.invalidateQueries({queryKey:["automation-logs"]}),className:"btn-secondary text-sm flex items-center gap-1.5",children:[e.jsx(m,{className:"w-3.5 h-3.5"}),"רענן"]})]}),w?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((s,t)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx(d,{className:"h-5 w-24"}),e.jsx(d,{className:"h-5 w-16"}),e.jsx(d,{className:"h-5 w-36"}),e.jsx(d,{className:"h-5 flex-1"})]},t))}):!g||g.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(m,{className:"w-10 h-10 mx-auto mb-2 opacity-40"}),e.jsx("p",{className:"text-sm",children:"אין רשומות יצירה אוטומטית עדיין"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 text-gray-500",children:[e.jsx("th",{className:"text-right py-3 px-3 font-medium",children:"סוג"}),e.jsx("th",{className:"text-right py-3 px-3 font-medium",children:"כמות"}),e.jsx("th",{className:"text-right py-3 px-3 font-medium",children:"תאריך"}),e.jsx("th",{className:"text-right py-3 px-3 font-medium",children:"פרטים"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:g.map(s=>{var t,a,l,c;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"py-3 px-3",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${(t=s.type)!=null&&t.includes("invoice")||(a=s.type)!=null&&a.includes("חשבונ")?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:[(l=s.type)!=null&&l.includes("invoice")||(c=s.type)!=null&&c.includes("חשבונ")?e.jsx(j,{className:"w-3 h-3"}):e.jsx(p,{className:"w-3 h-3"}),L[s.type]||s.type]})}),e.jsx("td",{className:"py-3 px-3 font-semibold text-gray-900",children:s.generated_count}),e.jsx("td",{className:"py-3 px-3 text-gray-600",children:P(s.created_at)}),e.jsx("td",{className:"py-3 px-3 text-gray-500",children:s.error?e.jsx("span",{className:"text-red-600 font-medium",children:v(s.error,60)}):v(s.details||"",60)})]},s.id)})})]})})]})]})}export{A as default};
