import{c as L,m as Q,u as D,i as K,r,f as T,k as x,j as e,B as I,X as z,A as O,z as i,l as d}from"./index-CqrGJYtT.js";import{W as B,S as R}from"./WhatsAppButton-CbzvLozY.js";import{A as $,E as W}from"./EmailComposeModal-DQlsgiOL.js";import{A as H,S as X}from"./save-BKD0W3AO.js";import{A as w}from"./arrow-left-right-DkbP8gFT.js";import{T as _}from"./trash-2-C4dWQi6Z.js";import{P as Z}from"./phone-Be-FhdAg.js";import{M as G}from"./mail-30m87wbN.js";import{M as J}from"./map-pin-CiqgE478.js";import"./message-circle-0WN99nHj.js";import"./external-link-Dm-4pgKY.js";import"./plus-DI2jJC8-.js";import"./refresh-cw-CDRQjf66.js";/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=L("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),V=[{value:"new",label:"חדש"},{value:"contacted",label:"נוצר קשר"},{value:"meeting_scheduled",label:"פגישה נקבעה"},{value:"proposal_sent",label:"הצעה נשלחה"},{value:"negotiation",label:"משא ומתן"},{value:"won",label:"נסגר"},{value:"lost",label:"אבד"}],C=[{value:"website",label:"אתר אינטרנט"},{value:"whatsapp",label:"וואטסאפ"},{value:"phone",label:"טלפון"},{value:"referral",label:"הפניה"}],S=[{value:"regular",label:"שמירה רגילה"},{value:"event",label:"אירועים"},{value:"both",label:"שניהם"}];function xe(){var y,b;const{id:l}=Q(),u=D(),c=K(),[o,h]=r.useState(!1),[k,p]=r.useState(!1),[E,j]=r.useState(!1),[M,f]=r.useState(!1),[t,n]=r.useState({contact_name:"",company_name:"",phone:"",email:"",location:"",description:"",source:"",service_type:""}),{data:v,isLoading:P}=T({queryKey:["lead",l],queryFn:()=>d.getOne(l).then(a=>a.data),enabled:!!l}),s=v==null?void 0:v.lead;r.useEffect(()=>{s&&n({contact_name:s.contact_name||"",company_name:s.company_name||"",phone:s.phone||"",email:s.email||"",location:s.location||"",description:s.description||"",source:s.source||"",service_type:s.service_type||""})},[s]);const q=x({mutationFn:a=>d.update(l,{status:a}),onSuccess:()=>{c.invalidateQueries({queryKey:["lead",l]}),i.success("סטטוס עודכן")},onError:()=>i.error("שגיאה בעדכון סטטוס")}),g=x({mutationFn:a=>d.update(l,a),onSuccess:()=>{c.invalidateQueries({queryKey:["lead",l]}),c.invalidateQueries({queryKey:["leads"]}),i.success("הליד עודכן בהצלחה"),h(!1)},onError:()=>{i.error("שגיאה בעדכון הליד")}}),N=x({mutationFn:()=>d.delete(l),onSuccess:()=>{c.invalidateQueries({queryKey:["leads"]}),i.success("הליד נמחק בהצלחה"),u("/leads")},onError:()=>{i.error("שגיאה במחיקת הליד")}}),m=x({mutationFn:()=>d.convert(l),onSuccess:a=>{c.invalidateQueries({queryKey:["lead",l]}),c.invalidateQueries({queryKey:["leads"]}),i.success("הליד הומר ללקוח בהצלחה"),u(`/customers/${a.data.customer.id}`)},onError:()=>{i.error("שגיאה בהמרת הליד")}}),A=()=>{if(!t.contact_name.trim()){i.error("שם איש קשר הוא שדה חובה");return}g.mutate(t)},F=()=>{s&&n({contact_name:s.contact_name||"",company_name:s.company_name||"",phone:s.phone||"",email:s.email||"",location:s.location||"",description:s.description||"",source:s.source||"",service_type:s.service_type||""}),h(!1)};return P?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary-600 border-t-transparent"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:()=>u("/leads"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[e.jsx(H,{className:"w-5 h-5"}),"חזרה ללידים"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{children:o?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם איש קשר *"}),e.jsx("input",{value:t.contact_name,onChange:a=>n({...t,contact_name:a.target.value}),className:"input text-2xl font-bold",placeholder:"שם איש קשר"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם חברה"}),e.jsx("input",{value:t.company_name,onChange:a=>n({...t,company_name:a.target.value}),className:"input",placeholder:"שם חברה"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s==null?void 0:s.contact_name}),(s==null?void 0:s.company_name)&&e.jsxs("p",{className:"text-gray-500 flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),s.company_name]})]})}),e.jsx("div",{className:"flex items-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:A,disabled:g.isPending,className:"btn-primary flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),g.isPending?"שומר...":"שמור"]}),e.jsxs("button",{onClick:F,className:"btn-secondary flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"ביטול"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>h(!0),className:"btn-secondary flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),"עריכה"]}),(s==null?void 0:s.status)!=="lost"&&(s==null?void 0:s.status)!=="converted"&&e.jsxs("button",{onClick:()=>j(!0),disabled:m.isPending,className:"btn-success flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"המר ללקוח"]}),e.jsxs("button",{onClick:()=>p(!0),className:"btn-danger flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"מחק ליד"]})]})})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-gray-900/40 backdrop-blur-sm animate-fade-in flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4 space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"מחיקת ליד"}),e.jsxs("p",{className:"text-gray-600",children:["האם אתה בטוח שברצונך למחוק את הליד של ",e.jsx("strong",{children:s==null?void 0:s.contact_name}),"?",e.jsx("br",{}),"פעולה זו אינה ניתנת לביטול."]}),e.jsxs("div",{className:"flex items-center gap-3 justify-end",children:[e.jsx("button",{onClick:()=>p(!1),className:"btn-secondary",children:"ביטול"}),e.jsxs("button",{onClick:()=>{N.mutate(),p(!1)},disabled:N.isPending,className:"btn-danger flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),N.isPending?"מוחק...":"מחק"]})]})]})}),E&&e.jsx("div",{className:"fixed inset-0 bg-gray-900/40 backdrop-blur-sm animate-fade-in flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(O,{className:"w-5 h-5 text-yellow-600"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"המרת ליד ללקוח"})]}),e.jsx("p",{className:"text-gray-600",children:"האם אתה בטוח שברצונך להמר ליד זה ללקוח?"}),e.jsx("p",{className:"text-sm text-gray-500",children:"פעולה זו תיצור לקוח חדש מפרטי הליד"}),e.jsxs("div",{className:"flex items-center gap-3 justify-end",children:[e.jsx("button",{onClick:()=>j(!1),className:"btn-secondary",children:"ביטול"}),e.jsxs("button",{onClick:()=>{m.mutate(),j(!1)},disabled:m.isPending,className:"btn-success flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),m.isPending?"ממיר...":"כן, המר"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"פרטי קשר"}),o?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון"}),e.jsx("input",{value:t.phone,onChange:a=>n({...t,phone:a.target.value}),className:"input",dir:"ltr",placeholder:"טלפון"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אימייל"}),e.jsx("input",{value:t.email,onChange:a=>n({...t,email:a.target.value}),className:"input",dir:"ltr",type:"email",placeholder:"אימייל"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מיקום"}),e.jsx("input",{value:t.location,onChange:a=>n({...t,location:a.target.value}),className:"input",placeholder:"מיקום"})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"טלפון"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`tel:${s==null?void 0:s.phone}`,className:"text-primary-600 font-medium",children:s==null?void 0:s.phone}),(s==null?void 0:s.phone)&&e.jsx(B,{phone:s.phone,name:s.contact_name,size:"sm"})]})]})]}),(s==null?void 0:s.email)&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"אימייל"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`mailto:${s.email}`,className:"text-primary-600 font-medium",children:s.email}),e.jsx("button",{onClick:()=>f(!0),className:"text-blue-500 hover:text-blue-700 p-1 rounded hover:bg-blue-50 transition-colors",title:"שלח אימייל",children:e.jsx(R,{className:"w-4 h-4"})})]})]})]}),(s==null?void 0:s.location)&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"מיקום"}),e.jsx("p",{className:"font-medium",children:s.location})]})]})]})]}),o?e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"תיאור"}),e.jsx("textarea",{value:t.description,onChange:a=>n({...t,description:a.target.value}),className:"input",rows:4,placeholder:"תיאור הליד..."})]}):(s==null?void 0:s.description)&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"תיאור"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.description})]}),l&&e.jsx($,{entityType:"lead",entityId:l})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"סטטוס"}),e.jsx("select",{value:s==null?void 0:s.status,onChange:a=>q.mutate(a.target.value),className:"input",children:V.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"פרטים"}),o?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מקור"}),e.jsxs("select",{value:t.source,onChange:a=>n({...t,source:a.target.value}),className:"input",children:[e.jsx("option",{value:"",children:"בחר מקור"}),C.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג שירות"}),e.jsxs("select",{value:t.service_type,onChange:a=>n({...t,service_type:a.target.value}),className:"input",children:[e.jsx("option",{value:"",children:"בחר סוג שירות"}),S.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"תאריך יצירה"}),e.jsx("dd",{className:"font-medium",children:(s==null?void 0:s.created_at)&&new Date(s.created_at).toLocaleDateString("he-IL")})]})]}):e.jsxs("dl",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"מקור"}),e.jsx("dd",{className:"font-medium",children:((y=C.find(a=>a.value===(s==null?void 0:s.source)))==null?void 0:y.label)||(s==null?void 0:s.source)||"-"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"סוג שירות"}),e.jsx("dd",{className:"font-medium",children:((b=S.find(a=>a.value===(s==null?void 0:s.service_type)))==null?void 0:b.label)||(s==null?void 0:s.service_type)||"-"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"תאריך יצירה"}),e.jsx("dd",{className:"font-medium",children:(s==null?void 0:s.created_at)&&new Date(s.created_at).toLocaleDateString("he-IL")})]})]})]})]})]}),e.jsx(W,{isOpen:M,onClose:()=>f(!1),defaultTo:(s==null?void 0:s.email)||"",defaultName:(s==null?void 0:s.contact_name)||"",entityType:"lead",entityId:l})]})}export{xe as default};
