import{g as W,h as me,r as d,i as j,j as e,X as M,z as i,v as xe,k as ye,u as Ne,d as S,s as le,A as ve,w as ie,x as _e,n as be,y as B,t as b,D as fe,E as we}from"./index-BITl8q-_.js";import{W as Ce}from"./WhatsAppButton-CtDu9n5o.js";import{S as T}from"./star-Cxait9GJ.js";import{P as Se,W as ke,D as Ee}from"./WhatsAppHistory-CAZl6Szu.js";import{A as qe,S as Pe}from"./save-DoFAw1Oe.js";import{S as Fe}from"./shield-C1dmT5K6.js";import{C as Me}from"./car-DabXJZD1.js";import{T as z}from"./trash-2-DHaWZIae.js";import{P as re}from"./package-CKTYyOnA.js";import{P as ce}from"./phone-BcPLbSQv.js";import{P as de}from"./plus-JELt5jWj.js";import{M as Te}from"./mail-D8PtV0gG.js";import{M as De}from"./map-pin-Diam8K2P.js";import"./message-circle-CpjEXpUI.js";import"./external-link-BBARTLZd.js";import"./refresh-cw-CSP9gSB4.js";import"./alert-circle-Dg8nJNjH.js";/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=W("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=W("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=W("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),Re=[{value:"manager",label:"דירוג מנהל"},{value:"client",label:"דירוג לקוח"},{value:"incident_handling",label:"טיפול באירוע"}];function Ie({employeeId:t,employeeName:k,onClose:m}){const p=me(),[x,D]=d.useState(0),[E,y]=d.useState(0),[f,o]=d.useState("manager"),[$,Y]=d.useState(""),[w,v]=d.useState(""),_=j({mutationFn:l=>xe.rate(l),onSuccess:()=>{p.invalidateQueries({queryKey:["performance",t]}),p.invalidateQueries({queryKey:["performance-rankings"]}),i.success("הדירוג נשמר בהצלחה"),m()},onError:()=>i.error("שגיאה בשמירת דירוג")}),r=l=>{if(l.preventDefault(),x===0){i.error("נא לבחור דירוג");return}_.mutate({employee_id:t,rating_type:f,rating:x,shift_id:$||null,comments:w||null})};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/40 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:"דירוג מאבטח"}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(M,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:r,className:"p-6 space-y-4",children:[e.jsx("div",{className:"text-center mb-2",children:e.jsx("p",{className:"text-lg font-medium text-gray-900",children:k})}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג דירוג *"}),e.jsx("select",{value:f,onChange:l=>o(l.target.value),className:"input",children:Re.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"דירוג *"}),e.jsx("div",{className:"flex items-center justify-center gap-2 py-3",children:[1,2,3,4,5].map(l=>e.jsx("button",{type:"button",onMouseEnter:()=>y(l),onMouseLeave:()=>y(0),onClick:()=>D(l),className:"transition-transform hover:scale-110",children:e.jsx(T,{className:`w-10 h-10 ${l<=(E||x)?"text-yellow-400 fill-yellow-400":"text-gray-300"}`})},l))}),e.jsxs("p",{className:"text-center text-sm text-gray-500",children:[x===1&&"גרוע",x===2&&"מתחת לממוצע",x===3&&"סביר",x===4&&"טוב",x===5&&"מצוין"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"הערות"}),e.jsx("textarea",{value:w,onChange:l=>v(l.target.value),className:"input min-h-[80px]",placeholder:"הערות על הביצוע..."})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"submit",disabled:_.isPending||x===0,className:"btn-primary flex-1",children:_.isPending?"שומר...":"שמור דירוג"}),e.jsx("button",{type:"button",onClick:m,className:"btn-secondary",children:"ביטול"})]})]})]})})}const Le=[{value:"id_card",label:"תעודת זהות"},{value:"weapon_license",label:"רישיון נשק"},{value:"driving_license",label:"רישיון נהיגה"},{value:"certificate",label:"תעודה"},{value:"other",label:"אחר"}],Qe={id_card:"תעודת זהות",weapon_license:"רישיון נשק",driving_license:"רישיון נהיגה",certificate:"תעודה",other:"אחר"},Oe=[{value:"hourly",label:"שעתי"},{value:"monthly",label:"חודשי"},{value:"contractor",label:"קבלן"}],Be=[{value:"B",label:"B"},{value:"C",label:"C"},{value:"C1",label:"C1"},{value:"D",label:"D"},{value:"D1",label:"D1"}];function rs(){var G,U,H,V,X;const{id:t}=ye(),k=Ne(),m=me(),[p,x]=d.useState(!1),[D,E]=d.useState(!1),[y,f]=d.useState(!1),[o,$]=d.useState("info"),[Y,w]=d.useState(!1),[v,_]=d.useState(!1),[r,l]=d.useState({cert_type:"firearm_license",cert_name:"",cert_number:"",issuing_authority:"",issue_date:"",expiry_date:"",notes:""}),[n,c]=d.useState({first_name:"",last_name:"",phone:"",email:"",address:"",city:"",hourly_rate:"",employment_type:"",has_weapon_license:!1,has_driving_license:!1,driving_license_type:"",emergency_contact_name:"",emergency_contact_phone:""}),[N,A]=d.useState({document_type:"id_card",expiry_date:""}),{data:u,isLoading:oe}=S({queryKey:["employee",t],queryFn:()=>b.getOne(t).then(s=>s.data),enabled:!!t}),a=u==null?void 0:u.employee,{data:q}=S({queryKey:["certifications",t],queryFn:()=>B.getByEmployee(t).then(s=>s.data),enabled:!!t&&o==="certifications"}),{data:P}=S({queryKey:["weapons",t],queryFn:()=>fe.getByEmployee(t).then(s=>s.data),enabled:!!t&&o==="weapons"}),{data:F}=S({queryKey:["equipment",t],queryFn:()=>we.getByEmployee(t).then(s=>s.data),enabled:!!t&&o==="equipment"}),{data:h}=S({queryKey:["performance",t],queryFn:()=>xe.getEmployee(t).then(s=>s.data),enabled:!!t&&o==="performance"}),K=j({mutationFn:s=>B.create(s),onSuccess:()=>{m.invalidateQueries({queryKey:["certifications",t]}),i.success("הסמכה נוספה בהצלחה"),_(!1),l({cert_type:"firearm_license",cert_name:"",cert_number:"",issuing_authority:"",issue_date:"",expiry_date:"",notes:""})},onError:()=>i.error("שגיאה בהוספת הסמכה")}),he=j({mutationFn:s=>B.delete(s),onSuccess:()=>{m.invalidateQueries({queryKey:["certifications",t]}),i.success("הסמכה נמחקה")},onError:()=>i.error("שגיאה במחיקה")});d.useEffect(()=>{var s;a&&c({first_name:a.first_name||"",last_name:a.last_name||"",phone:a.phone||"",email:a.email||"",address:a.address||"",city:a.city||"",hourly_rate:((s=a.hourly_rate)==null?void 0:s.toString())||"",employment_type:a.employment_type||"hourly",has_weapon_license:!!a.has_weapon_license,has_driving_license:!!a.has_driving_license,driving_license_type:a.driving_license_type||"",emergency_contact_name:a.emergency_contact_name||"",emergency_contact_phone:a.emergency_contact_phone||""})},[a]);const R=j({mutationFn:s=>b.update(t,s),onSuccess:()=>{m.invalidateQueries({queryKey:["employee",t]}),m.invalidateQueries({queryKey:["employees"]}),i.success("העובד עודכן בהצלחה"),x(!1)},onError:()=>i.error("שגיאה בעדכון העובד")}),I=j({mutationFn:()=>{const s=(a==null?void 0:a.status)==="active"?"inactive":"active";return b.update(t,{status:s})},onSuccess:()=>{m.invalidateQueries({queryKey:["employee",t]}),m.invalidateQueries({queryKey:["employees"]});const s=(a==null?void 0:a.status)==="active"?"לא פעיל":"פעיל";i.success(`סטטוס העובד שונה ל${s}`)},onError:()=>i.error("שגיאה בשינוי סטטוס")}),L=j({mutationFn:()=>b.delete(t),onSuccess:()=>{m.invalidateQueries({queryKey:["employees"]}),i.success("העובד נמחק בהצלחה"),k("/employees")},onError:()=>i.error("שגיאה במחיקת העובד")}),Q=j({mutationFn:s=>b.addDocument(t,s),onSuccess:()=>{m.invalidateQueries({queryKey:["employee",t]}),i.success("מסמך נוסף בהצלחה"),f(!1),A({document_type:"id_card",expiry_date:""})},onError:()=>i.error("שגיאה בהוספת מסמך")}),ue=j({mutationFn:s=>b.deleteDocument(t,s),onSuccess:()=>{m.invalidateQueries({queryKey:["employee",t]}),i.success("מסמך נמחק בהצלחה")},onError:()=>i.error("שגיאה במחיקת מסמך")}),pe=()=>{const s={...n,hourly_rate:n.hourly_rate?Number(n.hourly_rate):null};R.mutate(s)},ge=()=>{var s;a&&c({first_name:a.first_name||"",last_name:a.last_name||"",phone:a.phone||"",email:a.email||"",address:a.address||"",city:a.city||"",hourly_rate:((s=a.hourly_rate)==null?void 0:s.toString())||"",employment_type:a.employment_type||"hourly",has_weapon_license:!!a.has_weapon_license,has_driving_license:!!a.has_driving_license,driving_license_type:a.driving_license_type||"",emergency_contact_name:a.emergency_contact_name||"",emergency_contact_phone:a.emergency_contact_phone||""}),x(!1)},je=s=>{s.preventDefault(),Q.mutate({document_type:N.document_type,expiry_date:N.expiry_date||null})};return oe?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary-600 border-t-transparent"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:()=>k("/employees"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[e.jsx(qe,{className:"w-5 h-5"}),"חזרה לעובדים"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(le,{className:"w-12 h-12 text-gray-400"})}),e.jsxs("div",{children:[p?e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{value:n.first_name,onChange:s=>c({...n,first_name:s.target.value}),className:"input text-xl font-bold w-40",placeholder:"שם פרטי"}),e.jsx("input",{value:n.last_name,onChange:s=>c({...n,last_name:s.target.value}),className:"input text-xl font-bold w-40",placeholder:"שם משפחה"})]}):e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[a==null?void 0:a.first_name," ",a==null?void 0:a.last_name]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("span",{className:`badge ${(a==null?void 0:a.status)==="active"?"badge-success":"badge-gray"}`,children:(a==null?void 0:a.status)==="active"?"פעיל":"לא פעיל"}),(a==null?void 0:a.has_weapon_license)&&e.jsxs("span",{className:"badge badge-info flex items-center gap-1",children:[e.jsx(Fe,{className:"w-3 h-3"}),"רישיון נשק"]}),(a==null?void 0:a.has_driving_license)&&e.jsxs("span",{className:"badge badge-gray flex items-center gap-1",children:[e.jsx(Me,{className:"w-3 h-3"}),"רישיון ",a.driving_license_type]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:p?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:pe,disabled:R.isPending,className:"btn-success text-sm flex items-center gap-1 px-3 py-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),R.isPending?"שומר...":"שמור"]}),e.jsxs("button",{onClick:ge,className:"btn-secondary text-sm flex items-center gap-1 px-3 py-2",children:[e.jsx(M,{className:"w-4 h-4"}),"ביטול"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>x(!0),className:"btn-primary text-sm flex items-center gap-1 px-3 py-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"עריכה"]}),e.jsxs("button",{onClick:()=>I.mutate(),disabled:I.isPending,className:"btn-secondary text-sm flex items-center gap-1 px-3 py-2",title:(a==null?void 0:a.status)==="active"?"העבר ללא פעיל":"הפעל עובד",children:[(a==null?void 0:a.status)==="active"?e.jsx(Ke,{className:"w-4 h-4 text-green-600"}):e.jsx(Ae,{className:"w-4 h-4 text-gray-400"}),I.isPending?"מעדכן...":(a==null?void 0:a.status)==="active"?"השבת":"הפעל"]}),e.jsxs("button",{onClick:()=>E(!0),className:"btn-danger text-sm flex items-center gap-1 px-3 py-2",children:[e.jsx(z,{className:"w-4 h-4"}),"מחק עובד"]})]})})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-gray-900/40 backdrop-blur-sm animate-fade-in flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(ve,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"מחיקת עובד"}),e.jsx("p",{className:"text-sm text-gray-500",children:"פעולה זו אינה ניתנת לביטול"})]})]}),e.jsxs("p",{className:"text-gray-700 mb-6",children:["האם אתה בטוח שברצונך למחוק את העובד"," ",e.jsxs("strong",{children:[a==null?void 0:a.first_name," ",a==null?void 0:a.last_name]}),"? כל הנתונים הקשורים לעובד זה יימחקו לצמיתות."]}),e.jsxs("div",{className:"flex items-center gap-3 justify-end",children:[e.jsx("button",{onClick:()=>E(!1),className:"btn-secondary px-4 py-2",children:"ביטול"}),e.jsx("button",{onClick:()=>L.mutate(),disabled:L.isPending,className:"btn-danger px-4 py-2",children:L.isPending?"מוחק...":"מחק עובד"})]})]})}),e.jsx("div",{className:"border-b",children:e.jsx("nav",{className:"flex gap-4",children:[{id:"info",label:"מידע כללי",icon:le},{id:"certifications",label:"הסמכות",icon:$e},{id:"weapons",label:"נשק",icon:ie},{id:"equipment",label:"ציוד",icon:re},{id:"performance",label:"ביצועים",icon:_e},{id:"whatsapp",label:"WhatsApp",icon:ce}].map(s=>e.jsxs("button",{onClick:()=>$(s.id),className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors text-sm ${o===s.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]},s.id))})}),o==="certifications"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"הסמכות ורישיונות"}),e.jsxs("button",{onClick:()=>_(!v),className:"btn-primary text-sm flex items-center gap-1",children:[v?e.jsx(M,{className:"w-4 h-4"}):e.jsx(de,{className:"w-4 h-4"}),v?"ביטול":"הוסף הסמכה"]})]}),v&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),K.mutate({...r,employee_id:t})},className:"card space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג הסמכה *"}),e.jsxs("select",{value:r.cert_type,onChange:s=>l({...r,cert_type:s.target.value}),className:"input",children:[e.jsx("option",{value:"firearm_license",children:"רישיון נשק"}),e.jsx("option",{value:"security_officer",children:"קצין ביטחון"}),e.jsx("option",{value:"first_aid",children:"עזרה ראשונה"}),e.jsx("option",{value:"fire_safety",children:"בטיחות אש"}),e.jsx("option",{value:"driving_license",children:"רישיון נהיגה"}),e.jsx("option",{value:"guard_license",children:"רישיון שמירה"}),e.jsx("option",{value:"other",children:"אחר"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם ההסמכה *"}),e.jsx("input",{value:r.cert_name,onChange:s=>l({...r,cert_name:s.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מספר תעודה"}),e.jsx("input",{value:r.cert_number,onChange:s=>l({...r,cert_number:s.target.value}),className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"גוף מנפיק"}),e.jsx("input",{value:r.issuing_authority,onChange:s=>l({...r,issuing_authority:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תאריך הנפקה"}),e.jsx("input",{type:"date",value:r.issue_date,onChange:s=>l({...r,issue_date:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תאריך תפוגה"}),e.jsx("input",{type:"date",value:r.expiry_date,onChange:s=>l({...r,expiry_date:s.target.value}),className:"input"})]})]}),e.jsx("button",{type:"submit",disabled:K.isPending,className:"btn-primary text-sm",children:K.isPending?"שומר...":"שמור הסמכה"})]}),((G=q==null?void 0:q.certifications)==null?void 0:G.length)>0?e.jsx("div",{className:"space-y-2",children:q.certifications.map(s=>{const C=s.expiry_status==="expired"?"bg-red-100 border-red-300 text-red-800":s.expiry_status==="expiring_soon"?"bg-yellow-100 border-yellow-300 text-yellow-800":s.expiry_status==="expiring"?"bg-orange-50 border-orange-200 text-orange-700":"bg-green-50 border-green-200 text-green-800",O={expired:"פג תוקף",expiring_soon:"פג בקרוב (<30 יום)",expiring:"פג ב-60 יום",valid:"בתוקף",no_expiry:"ללא תפוגה"};return e.jsx("div",{className:`p-3 rounded-lg border ${C}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.cert_name}),e.jsxs("p",{className:"text-sm opacity-80",children:[s.cert_number&&`מס׳ ${s.cert_number} | `,s.issuing_authority||""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium",children:O[s.expiry_status||"valid"]}),s.expiry_date&&e.jsx("span",{className:"text-xs opacity-70",children:s.expiry_date}),e.jsx("button",{onClick:()=>he.mutate(s.id),className:"text-red-500 hover:text-red-700 p-1 rounded hover:bg-red-100",children:e.jsx(z,{className:"w-3.5 h-3.5"})})]})]})},s.id)})}):e.jsx("p",{className:"text-gray-400 text-center py-8",children:"אין הסמכות רשומות"})]}),o==="weapons"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"נשק מוקצה"}),((U=P==null?void 0:P.weapons)==null?void 0:U.length)>0?e.jsx("div",{className:"space-y-2",children:P.weapons.map(s=>e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.weapon_type," ",s.manufacturer&&`- ${s.manufacturer}`," ",s.model||""]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["מס״ס: ",s.serial_number]})]})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:`badge ${s.status==="assigned"?"badge-success":s.status==="maintenance"?"badge-warning":"badge-gray"}`,children:s.status==="assigned"?"מוקצה":s.status==="maintenance"?"בתחזוקה":"במחסן"}),s.license_expiry&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["רישיון: ",s.license_expiry]})]})]})},s.id))}):e.jsx("p",{className:"text-gray-400 text-center py-8",children:"אין נשק מוקצה"})]}),o==="equipment"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"ציוד מוקצה"}),((H=F==null?void 0:F.equipment)==null?void 0:H.length)>0?e.jsx("div",{className:"space-y-2",children:F.equipment.map(s=>{const C={new:"חדש",good:"תקין",fair:"סביר",needs_repair:"דורש תיקון",damaged:"פגום"};return e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(re,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.item_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.item_type,s.serial_number&&` | מס"ס: ${s.serial_number}`]}),s.assigned_date&&e.jsxs("p",{className:"text-xs text-gray-400",children:["מאז: ",s.assigned_date]})]})]}),e.jsx("span",{className:`badge ${s.condition==="good"||s.condition==="new"?"badge-success":s.condition==="fair"?"badge-warning":"badge-danger"}`,children:C[s.condition]||s.condition})]})},s.id)})}):e.jsx("p",{className:"text-gray-400 text-center py-8",children:"אין ציוד מוקצה"})]}),o==="performance"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"ביצועים"}),e.jsxs("button",{onClick:()=>w(!0),className:"btn-primary text-sm flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4"}),"דרג מאבטח"]})]}),h&&(()=>{var J,Z,ee,se,ae,te;const s=((J=h.ratings)==null?void 0:J.avg_rating)||0,C=((Z=h.ratings)==null?void 0:Z.total_ratings)||0,O=((ee=h.attendance)==null?void 0:ee.rate)||0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"card text-center",children:[e.jsx("div",{className:"flex items-center justify-center gap-1 mb-1",children:[1,2,3,4,5].map(g=>e.jsx(T,{className:`w-4 h-4 ${g<=Math.round(s)?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},g))}),e.jsx("p",{className:"text-2xl font-bold",children:Number(s).toFixed(1)}),e.jsxs("p",{className:"text-xs text-gray-500",children:["דירוג ממוצע (",C," דירוגים)"]})]}),e.jsxs("div",{className:"card text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[O,"%"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"נוכחות"})]}),e.jsxs("div",{className:"card text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:h.total_hours||0}),e.jsx("p",{className:"text-xs text-gray-500",children:"שעות (3 חודשים)"})]}),e.jsxs("div",{className:"card text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:h.shifts_this_month||0}),e.jsx("p",{className:"text-xs text-gray-500",children:"משמרות החודש"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"font-medium mb-2",children:"סטטיסטיקות"}),e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-500",children:"אירועי אבטחה דווחו"}),e.jsx("dd",{className:"font-medium",children:h.incidents_reported||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-500",children:"סיורים שהושלמו"}),e.jsx("dd",{className:"font-medium",children:h.total_patrols||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-500",children:"משמרות הגיע"}),e.jsxs("dd",{className:"font-medium",children:[((se=h.attendance)==null?void 0:se.checked_in)||0,"/",((ae=h.attendance)==null?void 0:ae.total_assignments)||0]})]})]})]}),((te=h.recent_ratings)==null?void 0:te.length)>0&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"font-medium mb-2",children:"דירוגים אחרונים"}),e.jsx("div",{className:"space-y-2",children:h.recent_ratings.slice(0,5).map(g=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(ne=>e.jsx(T,{className:`w-3 h-3 ${ne<=g.rating?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},ne)),e.jsx("span",{className:"text-xs text-gray-500 mr-2",children:g.rating_type==="manager_review"?"מנהל":g.rating_type==="customer_feedback"?"לקוח":"אירוע"})]}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(g.created_at).toLocaleDateString("he-IL")})]},g.id))})]})]})]})})()]}),Y&&a&&e.jsx(Ie,{employeeId:t,employeeName:`${a.first_name} ${a.last_name}`,onClose:()=>w(!1)}),o==="whatsapp"&&t&&e.jsx("div",{className:"max-w-2xl",children:e.jsx("div",{className:"card p-0 overflow-hidden",children:e.jsx(ke,{entityType:"employee",entityId:t,phone:a==null?void 0:a.phone,entityName:a?`${a.first_name} ${a.last_name}`:void 0})})}),o==="info"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"פרטי קשר"}),p?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון"}),e.jsx("input",{value:n.phone,onChange:s=>c({...n,phone:s.target.value}),className:"input",dir:"ltr",placeholder:"050-0000000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אימייל"}),e.jsx("input",{value:n.email,onChange:s=>c({...n,email:s.target.value}),className:"input",dir:"ltr",type:"email",placeholder:"email@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"כתובת"}),e.jsx("input",{value:n.address,onChange:s=>c({...n,address:s.target.value}),className:"input",placeholder:"רחוב ומספר"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"עיר"}),e.jsx("input",{value:n.city,onChange:s=>c({...n,city:s.target.value}),className:"input",placeholder:"עיר"})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"טלפון"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`tel:${a==null?void 0:a.phone}`,className:"text-primary-600 font-medium",children:a==null?void 0:a.phone}),(a==null?void 0:a.phone)&&e.jsx(Ce,{phone:a.phone,name:`${a.first_name||""} ${a.last_name||""}`.trim()||"עובד",size:"sm"})]})]})]}),(a==null?void 0:a.email)&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Te,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"אימייל"}),e.jsx("a",{href:`mailto:${a.email}`,className:"text-primary-600 font-medium",children:a.email})]})]}),(a==null?void 0:a.address)&&e.jsxs("div",{className:"flex items-center gap-3 col-span-2",children:[e.jsx(De,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"כתובת"}),e.jsxs("p",{className:"font-medium",children:[a.address,", ",a.city]})]})]})]})]}),p&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"פרטי העסקה - עריכה"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג העסקה"}),e.jsx("select",{value:n.employment_type,onChange:s=>c({...n,employment_type:s.target.value}),className:"input",children:Oe.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שכר שעתי (₪)"}),e.jsx("input",{type:"number",value:n.hourly_rate,onChange:s=>c({...n,hourly_rate:s.target.value}),className:"input",dir:"ltr",placeholder:"0"})]}),e.jsxs("div",{className:"col-span-2 flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.has_weapon_license,onChange:s=>c({...n,has_weapon_license:s.target.checked}),className:"w-4 h-4 text-primary-600 rounded"}),e.jsx("span",{children:"רישיון נשק"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.has_driving_license,onChange:s=>c({...n,has_driving_license:s.target.checked}),className:"w-4 h-4 text-primary-600 rounded"}),e.jsx("span",{children:"רישיון נהיגה"})]}),n.has_driving_license&&e.jsxs("select",{value:n.driving_license_type,onChange:s=>c({...n,driving_license_type:s.target.value}),className:"input w-auto",children:[e.jsx("option",{value:"",children:"סוג רישיון"}),Be.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})]})]}),p&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"איש קשר לחירום - עריכה"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם איש קשר"}),e.jsx("input",{value:n.emergency_contact_name,onChange:s=>c({...n,emergency_contact_name:s.target.value}),className:"input",placeholder:"שם מלא"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון חירום"}),e.jsx("input",{value:n.emergency_contact_phone,onChange:s=>c({...n,emergency_contact_phone:s.target.value}),className:"input",dir:"ltr",placeholder:"050-0000000"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"משמרות אחרונות"}),((V=u==null?void 0:u.recentShifts)==null?void 0:V.length)>0?e.jsx("div",{className:"space-y-2",children:u.recentShifts.slice(0,10).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.company_name," - ",s.site_name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.date," | ",s.start_time," - ",s.end_time]})]}),s.actual_hours&&e.jsxs("span",{className:"text-sm text-gray-500",children:[s.actual_hours," שעות"]})]},s.id))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"אין משמרות"})]}),t&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"מסמכים"}),e.jsx(Ee,{entityType:"employee",entityId:t})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"פרטי העסקה"}),e.jsxs("dl",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"ת.ז"}),e.jsx("dd",{className:"font-medium",children:a==null?void 0:a.id_number})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"תאריך התחלה"}),e.jsx("dd",{className:"font-medium",children:a==null?void 0:a.hire_date})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"סוג העסקה"}),e.jsx("dd",{className:"font-medium",children:(a==null?void 0:a.employment_type)==="hourly"?"שעתי":(a==null?void 0:a.employment_type)==="monthly"?"חודשי":"קבלן"})]}),(a==null?void 0:a.hourly_rate)&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"שכר שעתי"}),e.jsxs("dd",{className:"font-medium",children:["₪",a.hourly_rate]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"מסמכים"}),e.jsxs("button",{onClick:()=>f(!y),className:"btn-primary text-sm flex items-center gap-1 px-3 py-1.5",children:[y?e.jsx(M,{className:"w-4 h-4"}):e.jsx(de,{className:"w-4 h-4"}),y?"ביטול":"הוסף מסמך"]})]}),y&&e.jsxs("form",{onSubmit:je,className:"mb-4 p-4 bg-blue-50 rounded-lg space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג מסמך *"}),e.jsx("select",{value:N.document_type,onChange:s=>A({...N,document_type:s.target.value}),className:"input",required:!0,children:Le.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תאריך תפוגה"}),e.jsx("input",{type:"date",value:N.expiry_date,onChange:s=>A({...N,expiry_date:s.target.value}),className:"input"})]}),e.jsx("button",{type:"submit",disabled:Q.isPending||!N.document_type,className:"btn-primary text-sm",children:Q.isPending?"שומר...":"שמור מסמך"})]}),((X=u==null?void 0:u.documents)==null?void 0:X.length)>0?e.jsx("div",{className:"space-y-2",children:u.documents.map(s=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:Qe[s.document_type]||s.document_type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.expiry_date&&e.jsx("span",{className:"text-gray-500",children:s.expiry_date}),e.jsx("button",{onClick:()=>{confirm("למחוק מסמך זה?")&&ue.mutate(s.id)},className:"text-red-400 hover:text-red-600 p-1",title:"מחק מסמך",children:e.jsx(z,{className:"w-3.5 h-3.5"})})]})]},s.id))}):e.jsx("p",{className:"text-gray-500 text-sm text-center",children:"אין מסמכים"})]}),!p&&(a==null?void 0:a.emergency_contact_name)&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"איש קשר לחירום"}),e.jsx("p",{className:"font-medium",children:a.emergency_contact_name}),e.jsx("a",{href:`tel:${a.emergency_contact_phone}`,className:"text-primary-600 text-sm",children:a.emergency_contact_phone})]})]})]})]})}export{rs as default};
