import{D as O,u as R,c as T,r as u,e as K,d as x,j as e,P as J,X as Q,t as X,o as B,U as G,S as H,z as r,a5 as m,J as V}from"./index-DNhSfFTF.js";import{A as W,S as Y}from"./save-DJuc85Nt.js";import{P as Z}from"./pencil-D6RrN4Zk.js";import{C as ee}from"./check-circle-rj1BL297.js";import{T as se}from"./trash-2-C8JFUyr_.js";import{M as ae}from"./map-pin-CnrXv9DV.js";import{C as te}from"./car-BCPsmmPr.js";import{U as le}from"./user-plus-F5Fn6_3p.js";import{P as ne}from"./phone-C6GpoGt1.js";const M=[{value:"quote",label:"הצעת מחיר"},{value:"approved",label:"מאושר"},{value:"staffed",label:"מאויש"},{value:"completed",label:"הושלם"},{value:"cancelled",label:"בוטל"}],ie={quote:"badge-warning",approved:"badge-info",staffed:"badge-info",completed:"badge-success",cancelled:"badge-gray"};function ge(){var C,k,P,S,E,F;const{id:i}=O(),y=R(),c=T(),[d,h]=u.useState(!1),[t,n]=u.useState({}),[o,f]=u.useState(!1),[A,p]=u.useState(!1),{data:l,isLoading:D}=K({queryKey:["event",i],queryFn:()=>m.getOne(i).then(a=>a.data),enabled:!!i}),{data:g}=K({queryKey:["employees","active"],queryFn:()=>V.getAll({status:"active"}).then(a=>a.data),enabled:o}),s=l==null?void 0:l.event;u.useEffect(()=>{s&&d&&n({event_name:s.event_name||"",event_date:s.event_date||"",start_time:s.start_time||"",end_time:s.end_time||"",location:s.location||"",address:s.address||"",required_guards:s.required_guards||0,event_type:s.event_type||"",expected_attendance:s.expected_attendance||"",price:s.price||"",requires_weapon:s.requires_weapon||!1,requires_vehicle:s.requires_vehicle||!1,special_equipment:s.special_equipment||"",notes:s.notes||"",company_name:s.company_name||""})},[s,d]);const j=x({mutationFn:a=>m.update(i,a),onSuccess:()=>{c.invalidateQueries({queryKey:["event",i]}),c.invalidateQueries({queryKey:["events"]}),r.success("האירוע עודכן בהצלחה"),h(!1)},onError:()=>{r.error("שגיאה בעדכון האירוע")}}),v=x({mutationFn:a=>m.update(i,{status:a}),onSuccess:()=>{c.invalidateQueries({queryKey:["event",i]}),c.invalidateQueries({queryKey:["events"]}),r.success("סטטוס עודכן")},onError:()=>{r.error("שגיאה בעדכון סטטוס")}}),N=x({mutationFn:()=>m.complete(i),onSuccess:()=>{c.invalidateQueries({queryKey:["event",i]}),c.invalidateQueries({queryKey:["events"]}),r.success("האירוע סומן כהושלם")},onError:()=>{r.error("שגיאה בסימון האירוע כהושלם")}}),b=x({mutationFn:()=>m.delete(i),onSuccess:()=>{c.invalidateQueries({queryKey:["events"]}),r.success("האירוע נמחק"),y("/events")},onError:()=>{r.error("שגיאה במחיקת האירוע")}}),_=x({mutationFn:a=>m.assign(i,a),onSuccess:()=>{c.invalidateQueries({queryKey:["event",i]}),r.success("עובד שובץ בהצלחה"),f(!1)},onError:()=>{r.error("שגיאה בשיבוץ עובד")}}),w=x({mutationFn:a=>m.unassign(i,a),onSuccess:()=>{c.invalidateQueries({queryKey:["event",i]}),r.success("שיבוץ עובד הוסר")},onError:()=>{r.error("שגיאה בהסרת שיבוץ")}}),U=()=>{const a={...t};a.price&&(a.price=Number(a.price)),a.required_guards&&(a.required_guards=Number(a.required_guards)),a.expected_attendance&&(a.expected_attendance=Number(a.expected_attendance)),j.mutate(a)},$=()=>{h(!1),n({})},z=a=>{_.mutate({employee_id:a.id,role:a.role||"מאבטח"})},I=()=>{b.mutate(),p(!1)},L=((l==null?void 0:l.assignments)||[]).map(a=>a.employee_id),q=((g==null?void 0:g.employees)||[]).filter(a=>!L.includes(a.id));return D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary-600 border-t-transparent"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:()=>y("/events"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[e.jsx(W,{className:"w-5 h-5"}),"חזרה לאירועים"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-orange-100 to-orange-50 rounded-xl flex items-center justify-center",children:e.jsx(J,{className:"w-8 h-8 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 font-heading",children:s==null?void 0:s.event_name}),e.jsx("p",{className:"text-gray-500",children:s==null?void 0:s.company_name}),(s==null?void 0:s.status)&&e.jsx("span",{className:`badge mt-1 ${ie[s.status]||"badge-gray"}`,children:((C=M.find(a=>a.value===s.status))==null?void 0:C.label)||s.status})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!d&&e.jsxs("button",{onClick:()=>h(!0),className:"btn-secondary flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"עריכה"]}),d&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:U,disabled:j.isPending,className:"btn-primary flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),j.isPending?"שומר...":"שמור"]}),e.jsxs("button",{onClick:$,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"ביטול"]})]}),!d&&(s==null?void 0:s.status)!=="completed"&&(s==null?void 0:s.status)!=="cancelled"&&e.jsxs("button",{onClick:()=>N.mutate(),disabled:N.isPending,className:"btn-success flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),N.isPending?"מעדכן...":"סמן כהושלם"]}),!d&&e.jsxs("button",{onClick:()=>p(!0),className:"btn-danger flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"מחק אירוע"]})]})]}),A&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-content max-w-md w-full mx-4 space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 font-heading",children:"מחיקת אירוע"}),e.jsxs("p",{className:"text-gray-600",children:['האם אתה בטוח שברצונך למחוק את האירוע "',s==null?void 0:s.event_name,'"? פעולה זו אינה ניתנת לביטול.']}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>p(!1),className:"btn-secondary",children:"ביטול"}),e.jsx("button",{onClick:I,disabled:b.isPending,className:"btn-danger",children:b.isPending?"מוחק...":"מחק"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 font-heading",children:"פרטי האירוע"}),d?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם האירוע"}),e.jsx("input",{value:t.event_name,onChange:a=>n({...t,event_name:a.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם חברה"}),e.jsx("input",{value:t.company_name,onChange:a=>n({...t,company_name:a.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תאריך"}),e.jsx("input",{type:"date",value:t.event_date,onChange:a=>n({...t,event_date:a.target.value}),className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג אירוע"}),e.jsx("input",{value:t.event_type,onChange:a=>n({...t,event_type:a.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שעת התחלה"}),e.jsx("input",{type:"time",value:t.start_time,onChange:a=>n({...t,start_time:a.target.value}),className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שעת סיום"}),e.jsx("input",{type:"time",value:t.end_time,onChange:a=>n({...t,end_time:a.target.value}),className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מיקום"}),e.jsx("input",{value:t.location,onChange:a=>n({...t,location:a.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"כתובת"}),e.jsx("input",{value:t.address,onChange:a=>n({...t,address:a.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מאבטחים נדרשים"}),e.jsx("input",{type:"number",value:t.required_guards,onChange:a=>n({...t,required_guards:a.target.value}),className:"input",dir:"ltr",min:0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"קהל צפוי"}),e.jsx("input",{type:"number",value:t.expected_attendance,onChange:a=>n({...t,expected_attendance:a.target.value}),className:"input",dir:"ltr",min:0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מחיר (₪)"}),e.jsx("input",{type:"number",value:t.price,onChange:a=>n({...t,price:a.target.value}),className:"input",dir:"ltr",min:0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"ציוד מיוחד"}),e.jsx("input",{value:t.special_equipment,onChange:a=>n({...t,special_equipment:a.target.value}),className:"input"})]}),e.jsxs("div",{className:"col-span-2 flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.requires_weapon,onChange:a=>n({...t,requires_weapon:a.target.checked}),className:"w-4 h-4 text-primary-600 rounded"}),e.jsx("span",{children:"דורש נשק"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.requires_vehicle,onChange:a=>n({...t,requires_vehicle:a.target.checked}),className:"w-4 h-4 text-primary-600 rounded"}),e.jsx("span",{children:"דורש רכב"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"הערות"}),e.jsx("textarea",{value:t.notes,onChange:a=>n({...t,notes:a.target.value}),className:"input",rows:3})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"תאריך"}),e.jsx("p",{className:"font-medium",children:s==null?void 0:s.event_date})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"שעות"}),e.jsxs("p",{className:"font-medium",children:[s==null?void 0:s.start_time," - ",s==null?void 0:s.end_time]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 col-span-2",children:[e.jsx(ae,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"מיקום"}),e.jsx("p",{className:"font-medium",children:s==null?void 0:s.location}),(s==null?void 0:s.address)&&e.jsx("p",{className:"text-sm text-gray-500",children:s.address})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-gray-400"}),e.jsxs("span",{children:[s==null?void 0:s.required_guards," מאבטחים"]})]}),(s==null?void 0:s.requires_weapon)&&e.jsxs("div",{className:"flex items-center gap-2 text-yellow-600",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{children:"דורש נשק"})]}),(s==null?void 0:s.requires_vehicle)&&e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx(te,{className:"w-5 h-5"}),e.jsx("span",{children:"דורש רכב"})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold font-heading",children:"צוות משובץ"}),(s==null?void 0:s.status)!=="completed"&&(s==null?void 0:s.status)!=="cancelled"&&e.jsxs("button",{onClick:()=>f(!o),className:"btn-primary text-sm flex items-center gap-1 px-3 py-1.5",children:[o?e.jsx(Q,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"}),o?"ביטול":"שבץ עובד"]})]}),o&&e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"בחר עובד לשיבוץ:"}),q.length>0?e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:q.map(a=>e.jsxs("button",{onClick:()=>z(a),disabled:_.isPending,className:"w-full flex items-center justify-between p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors text-right",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[a.first_name," ",a.last_name]}),e.jsx("p",{className:"text-sm text-gray-500",children:a.role||"מאבטח"})]}),e.jsx("span",{className:"text-sm text-gray-500",dir:"ltr",children:a.phone})]},a.id))}):e.jsx("p",{className:"text-gray-500 text-sm text-center py-2",children:"אין עובדים זמינים לשיבוץ"})]}),((k=l==null?void 0:l.assignments)==null?void 0:k.length)>0?e.jsx("div",{className:"space-y-3",children:l.assignments.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.employee_name}),e.jsx("p",{className:"text-sm text-gray-500",children:a.role||"מאבטח"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("a",{href:`tel:${a.employee_phone}`,className:"flex items-center gap-1 text-primary-600 text-sm",children:[e.jsx(ne,{className:"w-4 h-4"}),a.employee_phone]}),(s==null?void 0:s.status)!=="completed"&&(s==null?void 0:s.status)!=="cancelled"&&e.jsx("button",{onClick:()=>w.mutate(a.id),disabled:w.isPending,className:"text-red-500 hover:text-red-700 text-sm font-medium px-2 py-1 rounded hover:bg-red-50 transition-colors",children:"הסר"})]})]},a.id))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"אין עובדים משובצים"})]}),!d&&(s==null?void 0:s.notes)&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 font-heading",children:"הערות"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.notes})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 font-heading",children:"סטטוס ותשלום"}),e.jsxs("dl",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500 mb-1",children:"סטטוס"}),e.jsx("dd",{children:e.jsx("select",{value:(s==null?void 0:s.status)||"",onChange:a=>v.mutate(a.target.value),disabled:v.isPending,className:"input",children:M.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"סוג אירוע"}),e.jsx("dd",{className:"font-medium",children:(s==null?void 0:s.event_type)||"-"})]}),(s==null?void 0:s.expected_attendance)&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"קהל צפוי"}),e.jsxs("dd",{className:"font-medium",children:[s.expected_attendance," אנשים"]})]}),(s==null?void 0:s.price)&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"מחיר"}),e.jsxs("dd",{className:"font-bold text-lg font-heading",children:["₪",s.price.toLocaleString()]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 font-heading",children:"סיכום איוש"}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"נדרשים"}),e.jsx("span",{className:"font-medium",children:(s==null?void 0:s.required_guards)||0})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"משובצים"}),e.jsx("span",{className:"font-medium",children:((P=l==null?void 0:l.assignments)==null?void 0:P.length)||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"חסרים"}),e.jsx("span",{className:`font-bold ${((s==null?void 0:s.required_guards)||0)-(((S=l==null?void 0:l.assignments)==null?void 0:S.length)||0)>0?"text-red-600":"text-green-600"}`,children:Math.max(0,((s==null?void 0:s.required_guards)||0)-(((E=l==null?void 0:l.assignments)==null?void 0:E.length)||0))})]}),((s==null?void 0:s.required_guards)||0)<=(((F=l==null?void 0:l.assignments)==null?void 0:F.length)||0)&&e.jsx("p",{className:"text-green-600 text-sm mt-2 font-medium text-center",children:"האירוע מאויש במלואו"})]}),!d&&(s==null?void 0:s.special_equipment)&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 font-heading",children:"ציוד מיוחד"}),e.jsx("p",{className:"text-gray-700",children:s.special_equipment})]})]})]})]})}export{ge as default};
