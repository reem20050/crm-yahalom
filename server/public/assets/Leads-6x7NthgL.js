import{t as R,r as c,c as U,e as X,d as u,k as $,j as e,v as G,p as H,o as J,X as V,z as l,l as r}from"./index-CYVBYVvl.js";import{u as W}from"./index.esm-BCay8U7_.js";import{t as Y,o as Z,n as ee,s as t,l as se}from"./types-BkakYPHo.js";import{c as ae}from"./Skeleton-DLC-Bf1b.js";import{u as le,B as te}from"./BulkActionBar-DqqM95C4.js";import{P as ne}from"./plus-p_an0ThM.js";import{P as ie}from"./phone-D7QUjJCD.js";import{M as ce}from"./mail-PtKQKhMA.js";import{T as F}from"./trash-2-BmAQAHXt.js";/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=R("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),re=Z({company_name:t().optional(),contact_name:t().min(1,"נדרש שם איש קשר"),phone:t().min(1,"נדרש מספר טלפון"),email:t().email("אימייל לא תקין").optional().or(se("")),source:t().optional(),service_type:t().optional(),location:t().optional(),description:t().optional(),expected_value:ee().optional()}),y={new:{label:"חדש",class:"badge-info"},contacted:{label:"נוצר קשר",class:"badge-gray"},meeting_scheduled:{label:"פגישה נקבעה",class:"badge-warning"},proposal_sent:{label:"הצעה נשלחה",class:"badge-warning"},negotiation:{label:"משא ומתן",class:"badge-warning"},won:{label:"נסגר",class:"badge-success"},lost:{label:"אבד",class:"badge-danger"}},oe={website:"אתר אינטרנט",whatsapp:"וואטסאפ",phone:"טלפון",referral:"המלצה"};function Ne(){var _;const[T,o]=c.useState(!1),[h,L]=c.useState(""),[p,q]=c.useState(""),[B,j]=c.useState(!1),[f,E]=c.useState("contacted"),d=U(),{selectedIds:w,selectedCount:m,isSelected:S,toggleSelect:Q,toggleAll:D,clearSelection:b}=le(),{data:n,isLoading:K}=X({queryKey:["leads",{search:h,status:p}],queryFn:()=>r.getAll({search:h,status:p,limit:50}).then(s=>s.data)}),g=u({mutationFn:s=>r.create(s),onSuccess:()=>{d.invalidateQueries({queryKey:["leads"]}),l.success("ליד נוצר בהצלחה"),o(!1),v()},onError:()=>{l.error("שגיאה ביצירת ליד")}}),z=u({mutationFn:s=>r.delete(s),onSuccess:()=>{d.invalidateQueries({queryKey:["leads"]}),l.success("נמחק בהצלחה")},onError:()=>{l.error("שגיאה במחיקה")}}),N=u({mutationFn:({ids:s,status:i})=>r.bulkUpdateStatus(s,i),onSuccess:s=>{d.invalidateQueries({queryKey:["leads"]}),b(),j(!1),l.success(s.data.message||"לידים עודכנו")},onError:()=>l.error("שגיאה בעדכון לידים")}),k=u({mutationFn:s=>r.bulkDelete(s),onSuccess:s=>{d.invalidateQueries({queryKey:["leads"]}),b(),l.success(s.data.message||"לידים נמחקו")},onError:()=>l.error("שגיאה במחיקת לידים")}),{register:a,handleSubmit:A,reset:v,formState:{errors:x}}=W({resolver:Y(re)}),{can:C}=$(),I=s=>{g.mutate(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"לידים"}),e.jsx("p",{className:"text-gray-500",children:"ניהול לידים ומעקב מכירות"})]}),C("leads:create")&&e.jsxs("button",{onClick:()=>o(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5"}),"ליד חדש"]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(G,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש לפי שם, טלפון או חברה...",value:h,onChange:s=>L(s.target.value),className:"input pr-10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-gray-400"}),e.jsxs("select",{value:p,onChange:s=>q(s.target.value),className:"input w-auto",children:[e.jsx("option",{value:"",children:"כל הסטטוסים"}),Object.entries(y).map(([s,{label:i}])=>e.jsx("option",{value:s,children:i},s))]})]})]})}),e.jsx("div",{className:"card p-0 overflow-hidden",children:K?e.jsx(ae,{columns:7,rows:5}):((_=n==null?void 0:n.leads)==null?void 0:_.length)>0?e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 cursor-pointer",checked:m>0&&m===n.leads.length,onChange:()=>D(n.leads.map(s=>s.id))})}),e.jsx("th",{children:"איש קשר"}),e.jsx("th",{children:"חברה"}),e.jsx("th",{children:"מקור"}),e.jsx("th",{children:"סטטוס"}),e.jsx("th",{children:"תאריך יצירה"}),e.jsx("th",{})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:n.leads.map(s=>{var i,M;return e.jsxs("tr",{className:S(s.id)?"bg-primary-50":"",children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 cursor-pointer",checked:S(s.id),onChange:()=>Q(s.id)})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.contact_name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"}),s.phone]}),s.email&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),s.email]})]})]})}),e.jsx("td",{children:s.company_name||"-"}),e.jsx("td",{children:oe[s.source]||s.source||"-"}),e.jsx("td",{children:e.jsx("span",{className:((i=y[s.status])==null?void 0:i.class)||"badge-gray",children:((M=y[s.status])==null?void 0:M.label)||s.status})}),e.jsx("td",{children:e.jsxs("span",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(H,{className:"w-4 h-4"}),new Date(s.created_at).toLocaleDateString("he-IL")]})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{to:`/leads/${s.id}`,className:"text-primary-600 hover:text-primary-700 font-medium",children:"צפייה"}),C("leads:delete")&&e.jsx("button",{onClick:O=>{O.preventDefault(),confirm("האם אתה בטוח שברצונך למחוק ליד זה?")&&z.mutate(s.id)},className:"text-red-500 hover:text-red-700 p-1",title:"מחק",children:e.jsx(F,{className:"w-4 h-4"})})]})})]},s.id)})})]})}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"לא נמצאו לידים"})})}),T&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/40 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:"ליד חדש"}),e.jsx("button",{onClick:()=>{o(!1),v()},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:A(I),className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"שם איש קשר *"}),e.jsx("input",{...a("contact_name"),className:"input"}),x.contact_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:x.contact_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון *"}),e.jsx("input",{...a("phone"),className:"input",dir:"ltr"}),x.phone&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:x.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אימייל"}),e.jsx("input",{...a("email"),type:"email",className:"input",dir:"ltr"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"שם חברה"}),e.jsx("input",{...a("company_name"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מקור"}),e.jsxs("select",{...a("source"),className:"input",children:[e.jsx("option",{value:"",children:"בחר מקור"}),e.jsx("option",{value:"website",children:"אתר אינטרנט"}),e.jsx("option",{value:"whatsapp",children:"וואטסאפ"}),e.jsx("option",{value:"phone",children:"טלפון"}),e.jsx("option",{value:"referral",children:"המלצה"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג שירות"}),e.jsxs("select",{...a("service_type"),className:"input",children:[e.jsx("option",{value:"",children:"בחר סוג"}),e.jsx("option",{value:"regular",children:"אבטחה קבועה"}),e.jsx("option",{value:"event",children:"אירוע חד-פעמי"}),e.jsx("option",{value:"both",children:"שניהם"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"מיקום / אזור"}),e.jsx("input",{...a("location"),className:"input"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"תיאור"}),e.jsx("textarea",{...a("description"),className:"input",rows:3})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:g.isPending,className:"btn-primary flex-1",children:g.isPending?"שומר...":"שמור"}),e.jsx("button",{type:"button",onClick:()=>{o(!1),v()},className:"btn-secondary",children:"ביטול"})]})]})]})}),B&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-sm w-full p-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4",children:["עדכון סטטוס (",m," לידים)"]}),e.jsxs("select",{value:f,onChange:s=>E(s.target.value),className:"input w-full mb-4",children:[e.jsx("option",{value:"new",children:"חדש"}),e.jsx("option",{value:"contacted",children:"נוצר קשר"}),e.jsx("option",{value:"meeting_scheduled",children:"פגישה נקבעה"}),e.jsx("option",{value:"proposal_sent",children:"הצעה נשלחה"}),e.jsx("option",{value:"negotiation",children:"משא ומתן"}),e.jsx("option",{value:"won",children:"נסגר"}),e.jsx("option",{value:"lost",children:"אבד"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>j(!1),className:"btn-secondary",children:"ביטול"}),e.jsx("button",{onClick:()=>N.mutate({ids:[...w],status:f}),className:"btn-primary",disabled:N.isPending,children:N.isPending?"מעדכן...":"עדכן"})]})]})}),e.jsx(te,{selectedCount:m,onClear:b,actions:[{label:"עדכן סטטוס",onClick:()=>j(!0),icon:e.jsx(P,{className:"w-4 h-4"}),variant:"primary"},{label:"מחק נבחרים",onClick:()=>{confirm("האם למחוק את הלידים הנבחרים?")&&k.mutate([...w])},icon:e.jsx(F,{className:"w-4 h-4"}),variant:"danger",loading:k.isPending}]})]})}export{Ne as default};
