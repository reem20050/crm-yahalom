import{c as T,r as h,g as M,d as P,h as v,i as k,j as e,S as q,C as E,L as Q,X as z,z as r,l as p}from"./index-DBiankO6.js";import{u as D}from"./index.esm-DPhks1II.js";import{t as I,o as K,n as O,s as l,l as A}from"./types-BJfaIygm.js";import{P as R}from"./plus-DARtcNrK.js";import{P as X}from"./phone-ZRycRRwK.js";import{M as $}from"./mail-CDDYcP9C.js";import{T as B}from"./trash-2-B0O5VWvb.js";/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=T("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),H=K({company_name:l().optional(),contact_name:l().min(1,"נדרש שם איש קשר"),phone:l().min(1,"נדרש מספר טלפון"),email:l().email("אימייל לא תקין").optional().or(A("")),source:l().optional(),service_type:l().optional(),location:l().optional(),description:l().optional(),expected_value:O().optional()}),u={new:{label:"חדש",class:"badge-info"},contacted:{label:"נוצר קשר",class:"badge-gray"},meeting_scheduled:{label:"פגישה נקבעה",class:"badge-warning"},proposal_sent:{label:"הצעה נשלחה",class:"badge-warning"},negotiation:{label:"משא ומתן",class:"badge-warning"},won:{label:"נסגר",class:"badge-success"},lost:{label:"אבד",class:"badge-danger"}},J={website:"אתר אינטרנט",whatsapp:"וואטסאפ",phone:"טלפון",referral:"המלצה"};function ae(){var N;const[y,t]=h.useState(!1),[o,f]=h.useState(""),[d,w]=h.useState(""),j=M(),{data:n,isLoading:S}=P({queryKey:["leads",{search:o,status:d}],queryFn:()=>p.getAll({search:o,status:d,limit:50}).then(s=>s.data)}),m=v({mutationFn:s=>p.create(s),onSuccess:()=>{j.invalidateQueries({queryKey:["leads"]}),r.success("ליד נוצר בהצלחה"),t(!1),x()},onError:()=>{r.error("שגיאה ביצירת ליד")}}),_=v({mutationFn:s=>p.delete(s),onSuccess:()=>{j.invalidateQueries({queryKey:["leads"]}),r.success("נמחק בהצלחה")},onError:()=>{r.error("שגיאה במחיקה")}}),{register:a,handleSubmit:C,reset:x,formState:{errors:i}}=D({resolver:I(H)}),{can:b}=k(),L=s=>{m.mutate(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"לידים"}),e.jsx("p",{className:"text-gray-500",children:"ניהול לידים ומעקב מכירות"})]}),b("leads:create")&&e.jsxs("button",{onClick:()=>t(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"ליד חדש"]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(q,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש לפי שם, טלפון או חברה...",value:o,onChange:s=>f(s.target.value),className:"input pr-10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-gray-400"}),e.jsxs("select",{value:d,onChange:s=>w(s.target.value),className:"input w-auto",children:[e.jsx("option",{value:"",children:"כל הסטטוסים"}),Object.entries(u).map(([s,{label:c}])=>e.jsx("option",{value:s,children:c},s))]})]})]})}),e.jsx("div",{className:"card p-0 overflow-hidden",children:S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-primary-500 border-t-transparent"})}):((N=n==null?void 0:n.leads)==null?void 0:N.length)>0?e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"איש קשר"}),e.jsx("th",{children:"חברה"}),e.jsx("th",{children:"מקור"}),e.jsx("th",{children:"סטטוס"}),e.jsx("th",{children:"תאריך יצירה"}),e.jsx("th",{})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:n.leads.map(s=>{var c,g;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.contact_name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"}),s.phone]}),s.email&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),s.email]})]})]})}),e.jsx("td",{children:s.company_name||"-"}),e.jsx("td",{children:J[s.source]||s.source||"-"}),e.jsx("td",{children:e.jsx("span",{className:((c=u[s.status])==null?void 0:c.class)||"badge-gray",children:((g=u[s.status])==null?void 0:g.label)||s.status})}),e.jsx("td",{children:e.jsxs("span",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(E,{className:"w-4 h-4"}),new Date(s.created_at).toLocaleDateString("he-IL")]})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{to:`/leads/${s.id}`,className:"text-primary-600 hover:text-primary-700 font-medium",children:"צפייה"}),b("leads:delete")&&e.jsx("button",{onClick:F=>{F.preventDefault(),confirm("האם אתה בטוח שברצונך למחוק ליד זה?")&&_.mutate(s.id)},className:"text-red-500 hover:text-red-700 p-1",title:"מחק",children:e.jsx(B,{className:"w-4 h-4"})})]})})]},s.id)})})]})}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"לא נמצאו לידים"})})}),y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:"ליד חדש"}),e.jsx("button",{onClick:()=>{t(!1),x()},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(z,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:C(L),className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"שם איש קשר *"}),e.jsx("input",{...a("contact_name"),className:"input"}),i.contact_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.contact_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון *"}),e.jsx("input",{...a("phone"),className:"input",dir:"ltr"}),i.phone&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אימייל"}),e.jsx("input",{...a("email"),type:"email",className:"input",dir:"ltr"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"שם חברה"}),e.jsx("input",{...a("company_name"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מקור"}),e.jsxs("select",{...a("source"),className:"input",children:[e.jsx("option",{value:"",children:"בחר מקור"}),e.jsx("option",{value:"website",children:"אתר אינטרנט"}),e.jsx("option",{value:"whatsapp",children:"וואטסאפ"}),e.jsx("option",{value:"phone",children:"טלפון"}),e.jsx("option",{value:"referral",children:"המלצה"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג שירות"}),e.jsxs("select",{...a("service_type"),className:"input",children:[e.jsx("option",{value:"",children:"בחר סוג"}),e.jsx("option",{value:"regular",children:"אבטחה קבועה"}),e.jsx("option",{value:"event",children:"אירוע חד-פעמי"}),e.jsx("option",{value:"both",children:"שניהם"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"מיקום / אזור"}),e.jsx("input",{...a("location"),className:"input"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"תיאור"}),e.jsx("textarea",{...a("description"),className:"input",rows:3})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:m.isPending,className:"btn-primary flex-1",children:m.isPending?"שומר...":"שמור"}),e.jsx("button",{type:"button",onClick:()=>{t(!1),x()},className:"btn-secondary",children:"ביטול"})]})]})]})})]})}export{ae as default};
