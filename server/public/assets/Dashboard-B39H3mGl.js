import{c as k,r as L,d as b,j as e,A as j,F as y,L as d,U as $,B as C,C as A,P as u,e as q,f as N}from"./index-BPBwE9NU.js";import{S as f}from"./shield-DfQfkLR_.js";import{T as _,R as S,L as E,C as P,X as F,Y as R,a as T,b as I}from"./LineChart-UP2lafZ5.js";import{M as v}from"./map-pin-CrcavfgI.js";import{P as K}from"./phone-D6d1rIR4.js";import{A as M}from"./arrow-left-right-CPAEoLlu.js";/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=k("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);function G(){const[s,o]=L.useState("operations"),{data:i,isLoading:c}=b({queryKey:["dashboard"],queryFn:()=>N.get().then(n=>n.data),enabled:s==="business"}),{data:t,isLoading:a}=b({queryKey:["dashboard-operations"],queryFn:()=>N.getOperations().then(n=>n.data),enabled:s==="operations",refetchInterval:6e4});return(s==="business"?c:a)?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"דשבורד"}),e.jsx("p",{className:"text-gray-500",children:"ברוך הבא למערכת צוות יהלום"})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>o("operations"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${s==="operations"?"bg-primary-600 text-white shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(f,{className:"w-4 h-4 inline-block ml-1"}),"תפעולי"]}),e.jsxs("button",{onClick:()=>o("business"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${s==="business"?"bg-primary-600 text-white shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(_,{className:"w-4 h-4 inline-block ml-1"}),"עסקי"]})]})]}),s==="operations"?e.jsx(B,{data:t}):e.jsx(D,{data:i})]})}function B({data:s}){var i,c,t,a,m,n,x,g,l;const o=[{name:"מאבטחים בשטח",value:`${(s==null?void 0:s.guards_on_duty)||0}/${(s==null?void 0:s.guards_expected_today)||0}`,icon:f,color:"bg-blue-500"},{name:"אתרים מכוסים",value:(s==null?void 0:s.sites_with_coverage)||0,icon:v,color:"bg-green-500"},{name:"אירועי אבטחה פתוחים",value:((i=s==null?void 0:s.open_incidents)==null?void 0:i.count)||0,icon:j,color:((c=s==null?void 0:s.open_incidents)==null?void 0:c.critical)>0?"bg-red-600":"bg-red-500",href:"/incidents"},{name:"רישיונות שפגים",value:((t=s==null?void 0:s.expiring_licenses)==null?void 0:t.length)||0,icon:y,color:"bg-yellow-500"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:o.map(r=>{const h=r.href?d:"div",p=r.href?{to:r.href}:{};return e.jsx(h,{...p,className:"stat-card hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-card-value",children:r.value}),e.jsx("p",{className:"stat-card-label",children:r.name})]}),e.jsx("div",{className:`p-3 rounded-lg ${r.color}`,children:e.jsx(r.icon,{className:"w-6 h-6 text-white"})})]})},r.name)})}),((a=s==null?void 0:s.open_incidents)==null?void 0:a.critical)>0&&e.jsxs("div",{className:"bg-red-100 border border-red-300 rounded-lg p-4 flex items-center gap-3",children:[e.jsx(j,{className:"w-6 h-6 text-red-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-red-800",children:[s.open_incidents.critical," אירועי אבטחה קריטיים פתוחים!"]}),e.jsx(d,{to:"/incidents?severity=critical",className:"text-red-700 underline text-sm",children:"צפה באירועים"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-red-500"}),"מאבטחים שלא עשו צ'ק-אין"]}),((m=s==null?void 0:s.guards_not_checked_in)==null?void 0:m.length)>0?e.jsx("div",{className:"space-y-3",children:s.guards_not_checked_in.map(r=>e.jsxs("div",{className:"p-3 rounded-lg bg-red-50 border border-red-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[r.first_name," ",r.last_name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r.site_name||r.company_name," | ",r.start_time," - ",r.end_time]})]}),r.phone&&e.jsx("a",{href:`tel:${r.phone}`,className:"p-2 rounded-lg bg-red-100 hover:bg-red-200 transition-colors",title:"התקשר",children:e.jsx(K,{className:"w-4 h-4 text-red-600"})})]},r.id))}):e.jsx("p",{className:"text-green-600 text-center py-8 font-medium",children:"✓ כל המאבטחים עשו צ'ק-אין"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-orange-500"}),"אתרים ללא כיסוי"]}),((n=s==null?void 0:s.sites_without_coverage)==null?void 0:n.length)>0?e.jsx("div",{className:"space-y-3",children:s.sites_without_coverage.map(r=>e.jsxs("div",{className:"p-3 rounded-lg bg-orange-50 border border-orange-100",children:[e.jsx("p",{className:"font-medium text-gray-900",children:r.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r.company_name," | ",r.start_time," - ",r.end_time]}),r.address&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:r.address})]},r.id))}):e.jsx("p",{className:"text-green-600 text-center py-8 font-medium",children:"✓ כל האתרים מכוסים"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-blue-500"}),"החלפות משמרות בשעתיים הקרובות"]}),((x=s==null?void 0:s.upcoming_shift_changes)==null?void 0:x.length)>0?e.jsx("div",{className:"space-y-3",children:s.upcoming_shift_changes.map(r=>e.jsxs("div",{className:"p-3 rounded-lg bg-blue-50 border border-blue-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:r.site_name||r.company_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r.start_time," - ",r.end_time," | ",r.assigned_count,"/",r.required_employees," משובצים"]})]}),e.jsx("span",{className:`badge ${r.change_type==="starting"?"badge-success":"badge-warning"}`,children:r.change_type==="starting"?"מתחילה":"מסתיימת"})]},r.id))}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"אין החלפות קרובות"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-yellow-500"}),"רישיונות והסמכות שפגים ב-7 ימים"]}),((g=s==null?void 0:s.expiring_licenses)==null?void 0:g.length)>0?e.jsx("div",{className:"space-y-3",children:s.expiring_licenses.map(r=>e.jsx("div",{className:"p-3 rounded-lg bg-yellow-50 border border-yellow-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:r.employee_name}),e.jsx("p",{className:"text-sm text-gray-500",children:r.cert_name})]}),e.jsxs("span",{className:`text-sm font-bold ${r.days_left<=3?"text-red-600":"text-yellow-600"}`,children:[r.days_left," ימים"]})]})},r.id))}):e.jsx("p",{className:"text-green-600 text-center py-8 font-medium",children:"✓ אין רישיונות שפגים בקרוב"})]}),((l=s==null?void 0:s.today_incidents)==null?void 0:l.length)>0&&e.jsxs("div",{className:"card lg:col-span-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5 text-red-500"}),"אירועי אבטחה היום"]}),e.jsx("div",{className:"space-y-3",children:s.today_incidents.map(r=>{const h={critical:"bg-red-100 border-red-300 text-red-800",high:"bg-orange-100 border-orange-300 text-orange-800",medium:"bg-yellow-100 border-yellow-300 text-yellow-800",low:"bg-green-100 border-green-300 text-green-800"},p={critical:"קריטי",high:"גבוה",medium:"בינוני",low:"נמוך"};return e.jsx(d,{to:"/incidents",className:"block p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold border ${h[r.severity]||h.low}`,children:p[r.severity]||r.severity}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:r.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r.site_name||r.company_name," | ",r.incident_time]})]})]})})},r.id)})})]})]})]})}function D({data:s}){var i,c,t,a,m,n,x,g;const o=[{name:"לידים חדשים",value:((i=s==null?void 0:s.leads)==null?void 0:i.new_leads)||0,icon:$,color:"bg-blue-500",href:"/leads?status=new"},{name:"לקוחות פעילים",value:((c=s==null?void 0:s.customers)==null?void 0:c.active_customers)||0,icon:C,color:"bg-green-500",href:"/customers"},{name:"משמרות היום",value:((t=s==null?void 0:s.shiftsToday)==null?void 0:t.total)||0,icon:A,color:"bg-purple-500",href:"/shifts"},{name:"אירועים השבוע",value:((a=s==null?void 0:s.upcomingEvents)==null?void 0:a.length)||0,icon:u,color:"bg-orange-500",href:"/events"}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:o.map(l=>e.jsx(d,{to:l.href,className:"stat-card hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-card-value",children:l.value}),e.jsx("p",{className:"stat-card-label",children:l.name})]}),e.jsx("div",{className:`p-3 rounded-lg ${l.color}`,children:e.jsx(l.icon,{className:"w-6 h-6 text-white"})})]})},l.name))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-primary-500"}),"הכנסות - 6 חודשים אחרונים"]}),e.jsx("div",{className:"h-64",children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(E,{data:(s==null?void 0:s.monthlyRevenue)||[],children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"month"}),e.jsx(R,{}),e.jsx(T,{formatter:l=>[`₪${l==null?void 0:l.toLocaleString()}`,"הכנסות"]}),e.jsx(I,{type:"monotone",dataKey:"revenue",stroke:"#0ea5e9",strokeWidth:2})]})})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5 text-orange-500"}),"אירועים קרובים"]}),((m=s==null?void 0:s.upcomingEvents)==null?void 0:m.length)>0?e.jsx("div",{className:"space-y-3",children:s.upcomingEvents.map(l=>e.jsx(d,{to:`/events/${l.id}`,className:"block p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:l.event_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[l.event_date," | ",l.start_time," | ",l.company_name]})]}),e.jsxs("span",{className:`badge ${l.assigned_count>=l.required_guards?"badge-success":"badge-warning"}`,children:[l.assigned_count,"/",l.required_guards," משובצים"]})]})},l.id))}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"אין אירועים קרובים"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-red-500"}),"משמרות לא מאוישות היום"]}),((n=s==null?void 0:s.unassignedShifts)==null?void 0:n.length)>0?e.jsx("div",{className:"space-y-3",children:s.unassignedShifts.map(l=>e.jsxs("div",{className:"p-3 rounded-lg bg-red-50 border border-red-100",children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[l.company_name," - ",l.site_name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[l.start_time," - ",l.end_time]})]},l.id))}):e.jsx("p",{className:"text-green-600 text-center py-8",children:"✓ כל המשמרות מאוישות"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-yellow-500"}),"חשבוניות באיחור"]}),((x=s==null?void 0:s.overdueInvoices)==null?void 0:x.length)>0?e.jsx("div",{className:"space-y-3",children:s.overdueInvoices.map(l=>{var r;return e.jsx("div",{className:"p-3 rounded-lg bg-yellow-50 border border-yellow-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:l.company_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["חשבונית #",l.invoice_number]})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-bold text-gray-900",children:["₪",(r=l.total_amount)==null?void 0:r.toLocaleString()]}),e.jsxs("p",{className:"text-sm text-red-600",children:[l.days_overdue," ימים באיחור"]})]})]})},l.id)})}):e.jsx("p",{className:"text-green-600 text-center py-8",children:"✓ אין חשבוניות באיחור"})]}),((g=s==null?void 0:s.contractsExpiring)==null?void 0:g.length)>0&&e.jsxs("div",{className:"card lg:col-span-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-blue-500"}),"חוזים לחידוש בקרוב"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.contractsExpiring.map(l=>{var r;return e.jsxs(d,{to:`/customers/${l.customer_id}`,className:"p-3 rounded-lg bg-blue-50 border border-blue-100 hover:bg-blue-100 transition-colors",children:[e.jsx("p",{className:"font-medium text-gray-900",children:l.company_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["תום חוזה: ",l.end_date," | ₪",(r=l.monthly_value)==null?void 0:r.toLocaleString(),"/חודש"]})]},l.id)})})]})]})]})}export{G as default};
