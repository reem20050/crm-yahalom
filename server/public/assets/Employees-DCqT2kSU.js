import{r as g,c as T,e as P,d as N,k as E,j as e,v as q,o as M,S as A,E as F,X as Q,z as d,G as p}from"./index-CYVBYVvl.js";import{u as U}from"./index.esm-BCay8U7_.js";import{t as z,o as I,s as t,b as h,n as K,l as O}from"./types-BkakYPHo.js";import{S as $,d as G}from"./Skeleton-DLC-Bf1b.js";import{a as L}from"./WhatsAppButton-csVOSNvP.js";import{P as D}from"./plus-p_an0ThM.js";import{P as R}from"./phone-D7QUjJCD.js";import{T as V}from"./trash-2-BmAQAHXt.js";import{U as W}from"./user-plus-dEQ32aJK.js";import"./message-circle-CjovvPKe.js";import"./external-link-BuJEn0AY.js";const X=I({first_name:t().min(1,"נדרש שם פרטי"),last_name:t().min(1,"נדרש שם משפחה"),id_number:t().min(1,"נדרש מספר ת.ז"),phone:t().min(1,"נדרש מספר טלפון"),email:t().email("אימייל לא תקין").optional().or(O("")),address:t().optional(),city:t().optional(),hire_date:t().min(1,"נדרש תאריך תחילת עבודה"),employment_type:t().optional(),hourly_rate:K().optional(),has_weapon_license:h().optional(),has_driving_license:h().optional(),driving_license_type:t().optional(),emergency_contact_name:t().optional(),emergency_contact_phone:t().optional(),create_user_account:h().optional(),user_password:t().optional(),user_role:t().optional()});function ie(){var b;const[m,y]=g.useState(""),[f,n]=g.useState(!1),u=T(),{data:c,isLoading:v}=P({queryKey:["employees",{search:m}],queryFn:()=>p.getAll({search:m,limit:50}).then(s=>s.data)}),o=N({mutationFn:s=>p.create(s),onSuccess:s=>{var r;u.invalidateQueries({queryKey:["employees"]});const i=(r=s.data)!=null&&r.user_created?"עובד נוצר בהצלחה + חשבון משתמש נוצר":"עובד נוצר בהצלחה";d.success(i),n(!1),x()},onError:s=>{var i,r;d.error(((r=(i=s.response)==null?void 0:i.data)==null?void 0:r.error)||"שגיאה ביצירת עובד")}}),_=N({mutationFn:s=>p.delete(s),onSuccess:()=>{u.invalidateQueries({queryKey:["employees"]}),d.success("נמחק בהצלחה")},onError:()=>{d.error("שגיאה במחיקה")}}),{register:a,handleSubmit:w,reset:x,watch:S,formState:{errors:l}}=U({resolver:z(X),defaultValues:{hire_date:new Date().toISOString().split("T")[0],employment_type:"hourly",has_weapon_license:!1,has_driving_license:!1,create_user_account:!1,user_role:"employee"}}),k=S("create_user_account"),{can:j}=E(),C=s=>{o.mutate(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"עובדים"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"ניהול עובדים ומסמכים"})]}),j("employees:create")&&e.jsxs("button",{onClick:()=>n(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"עובד חדש"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש עובדים...",value:m,onChange:s=>y(s.target.value),className:"input pr-11"})]}),v?e.jsxs("div",{className:"space-y-6",children:[e.jsx($,{className:"h-10 w-full rounded-xl"}),e.jsx(G,{count:6})]}):((b=c==null?void 0:c.employees)==null?void 0:b.length)>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.employees.map(s=>{var i,r;return e.jsx("div",{className:"card hover:shadow-elevated transition-all duration-200",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsxs(M,{to:`/employees/${s.id}`,className:"flex items-start gap-3.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-11 h-11 bg-primary-50 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsxs("span",{className:"text-primary-700 font-semibold text-sm",children:[(i=s.first_name)==null?void 0:i[0],(r=s.last_name)==null?void 0:r[0]]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 text-sm",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1.5 mt-1",children:[e.jsx(R,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{dir:"ltr",children:s.phone}),e.jsx(L,{phone:s.phone,message:`שלום ${s.first_name}, 

צוות יהלום`})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-2",children:[e.jsx("span",{className:`badge ${s.status==="active"?"badge-success":"badge-gray"}`,children:s.status==="active"?"פעיל":"לא פעיל"}),s.has_weapon_license&&e.jsxs("span",{className:"badge badge-info flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"}),"נשק"]})]})]})]}),j("employees:delete")&&e.jsx("button",{onClick:()=>{confirm("האם אתה בטוח שברצונך למחוק עובד זה?")&&_.mutate(s.id)},className:"p-1.5 rounded-lg text-gray-300 hover:text-red-500 hover:bg-red-50 transition-colors",title:"מחק",children:e.jsx(V,{className:"w-4 h-4"})})]})},s.id)})}):e.jsxs("div",{className:"card text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-50 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(F,{className:"w-8 h-8 text-gray-300"})}),e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"לא נמצאו עובדים"}),e.jsx("button",{onClick:()=>n(!0),className:"btn-primary",children:"הוסף עובד ראשון"})]}),f&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/40 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-modal w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-slide-up",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"עובד חדש"}),e.jsx("button",{onClick:()=>{n(!1),x()},className:"p-2 hover:bg-gray-100 rounded-xl text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Q,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:w(C),className:"p-6 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם פרטי *"}),e.jsx("input",{...a("first_name"),className:"input"}),l.first_name&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.first_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם משפחה *"}),e.jsx("input",{...a("last_name"),className:"input"}),l.last_name&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.last_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"ת.ז *"}),e.jsx("input",{...a("id_number"),className:"input",dir:"ltr"}),l.id_number&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.id_number.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון *"}),e.jsx("input",{...a("phone"),className:"input",dir:"ltr"}),l.phone&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אימייל"}),e.jsx("input",{...a("email"),type:"email",className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תאריך תחילת עבודה *"}),e.jsx("input",{...a("hire_date"),type:"date",className:"input"}),l.hire_date&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.hire_date.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"כתובת"}),e.jsx("input",{...a("address"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"עיר"}),e.jsx("input",{...a("city"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג העסקה"}),e.jsxs("select",{...a("employment_type"),className:"input",children:[e.jsx("option",{value:"hourly",children:"שעתי"}),e.jsx("option",{value:"monthly",children:"חודשי"}),e.jsx("option",{value:"contractor",children:"קבלן"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שכר שעתי"}),e.jsx("input",{...a("hourly_rate",{valueAsNumber:!0}),type:"number",step:"0.01",className:"input",dir:"ltr"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 border-t border-gray-100 pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"רישיונות"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{...a("has_weapon_license"),type:"checkbox",className:"w-4 h-4 text-primary-600 rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700",children:"רישיון נשק"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{...a("has_driving_license"),type:"checkbox",className:"w-4 h-4 text-primary-600 rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700",children:"רישיון נהיגה"})]})]})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 border-t border-gray-100 pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"איש קשר לחירום"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם"}),e.jsx("input",{...a("emergency_contact_name"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון"}),e.jsx("input",{...a("emergency_contact_phone"),className:"input",dir:"ltr"})]})]})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 border-t border-gray-100 pt-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-3",children:[e.jsx("input",{...a("create_user_account"),type:"checkbox",className:"w-4 h-4 text-primary-600 rounded border-gray-300"}),e.jsx(W,{className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"צור חשבון משתמש לעובד"})]}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"מאפשר לעובד להתחבר למערכת ולבצע צ'ק-אין עצמאי. נדרש אימייל."}),k&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 p-3 bg-primary-50/50 rounded-xl border border-primary-100",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סיסמה למשתמש *"}),e.jsx("input",{...a("user_password"),type:"password",className:"input",dir:"ltr",placeholder:"לפחות 6 תווים"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תפקיד"}),e.jsxs("select",{...a("user_role"),className:"input",children:[e.jsx("option",{value:"employee",children:"עובד"}),e.jsx("option",{value:"manager",children:"מנהל משמרות"}),e.jsx("option",{value:"admin",children:"מנהל"})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-100",children:[e.jsx("button",{type:"submit",disabled:o.isPending,className:"btn-primary flex-1",children:o.isPending?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"שומר..."]}):"שמור"}),e.jsx("button",{type:"button",onClick:()=>{n(!1),x()},className:"btn-secondary",children:"ביטול"})]})]})]})})]})}export{ie as default};
