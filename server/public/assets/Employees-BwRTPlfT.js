import{r as u,g as S,d as T,h as j,i as k,j as e,S as C,L as P,p as N,X as q,z as r,q as o}from"./index-BPBwE9NU.js";import{u as E}from"./index.esm-BzXBOFgw.js";import{t as M,o as F,s as l,b,n as Q,l as z}from"./types-Cgx3EjBP.js";import{P as A}from"./plus-BBAlGWpg.js";import{P as K}from"./phone-D6d1rIR4.js";import{S as L}from"./shield-DfQfkLR_.js";import{T as O}from"./trash-2-DgMEGaWc.js";const I=F({first_name:l().min(1,"נדרש שם פרטי"),last_name:l().min(1,"נדרש שם משפחה"),id_number:l().min(1,"נדרש מספר ת.ז"),phone:l().min(1,"נדרש מספר טלפון"),email:l().email("אימייל לא תקין").optional().or(z("")),address:l().optional(),city:l().optional(),hire_date:l().min(1,"נדרש תאריך תחילת עבודה"),employment_type:l().optional(),hourly_rate:Q().optional(),has_weapon_license:b().optional(),has_driving_license:b().optional(),driving_license_type:l().optional(),emergency_contact_name:l().optional(),emergency_contact_phone:l().optional()});function G(){var p;const[c,y]=u.useState(""),[g,i]=u.useState(!1),x=S(),{data:n,isLoading:f}=T({queryKey:["employees",{search:c}],queryFn:()=>o.getAll({search:c,limit:50}).then(s=>s.data)}),d=j({mutationFn:s=>o.create(s),onSuccess:()=>{x.invalidateQueries({queryKey:["employees"]}),r.success("עובד נוצר בהצלחה"),i(!1),m()},onError:()=>{r.error("שגיאה ביצירת עובד")}}),v=j({mutationFn:s=>o.delete(s),onSuccess:()=>{x.invalidateQueries({queryKey:["employees"]}),r.success("נמחק בהצלחה")},onError:()=>{r.error("שגיאה במחיקה")}}),{register:a,handleSubmit:_,reset:m,formState:{errors:t}}=E({resolver:M(I),defaultValues:{hire_date:new Date().toISOString().split("T")[0],employment_type:"hourly",has_weapon_license:!1,has_driving_license:!1}}),{can:h}=k(),w=s=>{d.mutate(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"עובדים"}),e.jsx("p",{className:"text-gray-500",children:"ניהול עובדים ומסמכים"})]}),h("employees:create")&&e.jsxs("button",{onClick:()=>i(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),"עובד חדש"]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש עובדים...",value:c,onChange:s=>y(s.target.value),className:"input pr-10"})]})}),f?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-primary-500 border-t-transparent"})}):((p=n==null?void 0:n.employees)==null?void 0:p.length)>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.employees.map(s=>e.jsx("div",{className:"card hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(P,{to:`/employees/${s.id}`,className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(N,{className:"w-8 h-8 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"}),s.phone]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:`badge ${s.status==="active"?"badge-success":"badge-gray"}`,children:s.status==="active"?"פעיל":"לא פעיל"}),s.has_weapon_license&&e.jsxs("span",{className:"badge badge-info flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),"נשק"]})]})]})]}),h("employees:delete")&&e.jsx("button",{onClick:()=>{confirm("האם אתה בטוח שברצונך למחוק עובד זה?")&&v.mutate(s.id)},className:"text-red-400 hover:text-red-600 p-1",title:"מחק",children:e.jsx(O,{className:"w-4 h-4"})})]})},s.id))}):e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(N,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"לא נמצאו עובדים"}),e.jsx("button",{onClick:()=>i(!0),className:"btn-primary",children:"הוסף עובד ראשון"})]}),g&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:"עובד חדש"}),e.jsx("button",{onClick:()=>{i(!1),m()},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:_(w),className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם פרטי *"}),e.jsx("input",{...a("first_name"),className:"input"}),t.first_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.first_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם משפחה *"}),e.jsx("input",{...a("last_name"),className:"input"}),t.last_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.last_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"ת.ז *"}),e.jsx("input",{...a("id_number"),className:"input",dir:"ltr"}),t.id_number&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.id_number.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון *"}),e.jsx("input",{...a("phone"),className:"input",dir:"ltr"}),t.phone&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אימייל"}),e.jsx("input",{...a("email"),type:"email",className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תאריך תחילת עבודה *"}),e.jsx("input",{...a("hire_date"),type:"date",className:"input"}),t.hire_date&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.hire_date.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"כתובת"}),e.jsx("input",{...a("address"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"עיר"}),e.jsx("input",{...a("city"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג העסקה"}),e.jsxs("select",{...a("employment_type"),className:"input",children:[e.jsx("option",{value:"hourly",children:"שעתי"}),e.jsx("option",{value:"monthly",children:"חודשי"}),e.jsx("option",{value:"contractor",children:"קבלן"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שכר שעתי"}),e.jsx("input",{...a("hourly_rate",{valueAsNumber:!0}),type:"number",step:"0.01",className:"input",dir:"ltr"})]}),e.jsxs("div",{className:"col-span-2 border-t pt-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"רישיונות"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{...a("has_weapon_license"),type:"checkbox",className:"w-4 h-4 text-primary-600 rounded"}),e.jsx("span",{children:"רישיון נשק"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{...a("has_driving_license"),type:"checkbox",className:"w-4 h-4 text-primary-600 rounded"}),e.jsx("span",{children:"רישיון נהיגה"})]})]})]}),e.jsxs("div",{className:"col-span-2 border-t pt-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"איש קשר לחירום"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם"}),e.jsx("input",{...a("emergency_contact_name"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון"}),e.jsx("input",{...a("emergency_contact_phone"),className:"input",dir:"ltr"})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:d.isPending,className:"btn-primary flex-1",children:d.isPending?"שומר...":"שמור"}),e.jsx("button",{type:"button",onClick:()=>{i(!1),m()},className:"btn-secondary",children:"ביטול"})]})]})]})})]})}export{G as default};
