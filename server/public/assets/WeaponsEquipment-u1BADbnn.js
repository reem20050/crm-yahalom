import{m as Y,a as Z,r as d,c as D,e as T,d as x,j as e,X as ee,M as P,w as se,z as l,Q as j,T as b,J as ae}from"./index-DNhSfFTF.js";import{P as ne}from"./plus-42YS-w1A.js";import{P as k}from"./package-UtShABcj.js";import{A as te}from"./arrow-left-right-DQnPnGxG.js";import{T as O}from"./trash-2-C8JFUyr_.js";const le=[{value:"new",label:"חדש"},{value:"good",label:"תקין"},{value:"fair",label:"סביר"},{value:"needs_repair",label:"דורש תיקון"},{value:"damaged",label:"פגום"}];function me(){var W,I;const{isEmployee:N,can:v}=Y(),f=Z(s=>s.user),o=f==null?void 0:f.employeeId,[i,A]=d.useState("weapons"),[h,g]=d.useState(!1),[y,_]=d.useState(""),[w,q]=d.useState(null),[K,L]=d.useState(""),m=D(),[a,r]=d.useState({weapon_type:"",manufacturer:"",model:"",serial_number:"",license_number:"",license_expiry:"",employee_id:"",notes:""}),[n,c]=d.useState({item_type:"",item_name:"",serial_number:"",condition:"good",employee_id:"",notes:""}),{data:u,isLoading:B}=T({queryKey:["all-weapons",N?o:"all"],queryFn:()=>N&&o?j.getByEmployee(o).then(s=>s.data):j.getAll().then(s=>s.data),enabled:i==="weapons"}),{data:p,isLoading:z}=T({queryKey:["all-equipment",N?o:"all"],queryFn:()=>N&&o?b.getByEmployee(o).then(s=>s.data):b.getAll().then(s=>s.data),enabled:i==="equipment"}),{data:C}=T({queryKey:["employees-active"],queryFn:()=>ae.getAll({status:"active",limit:200}).then(s=>s.data)}),E=(C==null?void 0:C.employees)||[],S=x({mutationFn:s=>j.create(s),onSuccess:()=>{m.invalidateQueries({queryKey:["all-weapons"]}),l.success("נשק נוסף בהצלחה"),g(!1),r({weapon_type:"",manufacturer:"",model:"",serial_number:"",license_number:"",license_expiry:"",employee_id:"",notes:""})},onError:()=>l.error("שגיאה בהוספת נשק")}),R=x({mutationFn:s=>j.delete(s),onSuccess:()=>{m.invalidateQueries({queryKey:["all-weapons"]}),l.success("נשק נמחק")},onError:()=>l.error("שגיאה במחיקה")}),F=x({mutationFn:({id:s,employee_id:t})=>j.transfer(s,t),onSuccess:()=>{m.invalidateQueries({queryKey:["all-weapons"]}),l.success("הנשק הועבר בהצלחה"),q(null),L("")},onError:()=>l.error("שגיאה בהעברה")}),$=x({mutationFn:s=>b.create(s),onSuccess:()=>{m.invalidateQueries({queryKey:["all-equipment"]}),l.success("ציוד נוסף בהצלחה"),g(!1),c({item_type:"",item_name:"",serial_number:"",condition:"good",employee_id:"",notes:""})},onError:()=>l.error("שגיאה בהוספת ציוד")}),J=x({mutationFn:s=>b.returnItem(s,"good"),onSuccess:()=>{m.invalidateQueries({queryKey:["all-equipment"]}),l.success("ציוד הוחזר")},onError:()=>l.error("שגיאה בהחזרה")}),X=x({mutationFn:s=>b.delete(s),onSuccess:()=>{m.invalidateQueries({queryKey:["all-equipment"]}),l.success("ציוד נמחק")},onError:()=>l.error("שגיאה במחיקה")}),G=i==="weapons"?B:z,Q=((u==null?void 0:u.weapons)||[]).filter(s=>!y||[s.weapon_type,s.serial_number,s.employee_name,s.manufacturer].some(t=>t==null?void 0:t.toLowerCase().includes(y.toLowerCase()))),M=((p==null?void 0:p.equipment)||[]).filter(s=>!y||[s.item_type,s.item_name,s.employee_name,s.serial_number].some(t=>t==null?void 0:t.toLowerCase().includes(y.toLowerCase())));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"נשק וציוד"}),e.jsx("p",{className:"page-subtitle",children:"ניהול נשק, ציוד ומלאי"})]}),v("weapons:manage")&&e.jsxs("button",{onClick:()=>g(!h),className:"btn-primary flex items-center gap-2",children:[h?e.jsx(ee,{className:"w-5 h-5"}):e.jsx(ne,{className:"w-5 h-5"}),h?"ביטול":i==="weapons"?"הוסף נשק":"הוסף ציוד"]})]}),e.jsxs("div",{className:"flex items-center gap-4 border-b",children:[e.jsxs("button",{onClick:()=>{A("weapons"),g(!1),_("")},className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${i==="weapons"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(P,{className:"w-5 h-5"}),"נשק (",((W=u==null?void 0:u.weapons)==null?void 0:W.length)||0,")"]}),e.jsxs("button",{onClick:()=>{A("equipment"),g(!1),_("")},className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${i==="equipment"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(k,{className:"w-5 h-5"}),"ציוד (",((I=p==null?void 0:p.equipment)==null?void 0:I.length)||0,")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),e.jsx("input",{type:"text",value:y,onChange:s=>_(s.target.value),placeholder:"חיפוש נשק או ציוד...",className:"input pr-11"})]}),h&&i==="weapons"&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),S.mutate({...a,employee_id:a.employee_id||null,status:a.employee_id?"assigned":"in_armory"})},className:"card space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"הוספת נשק חדש"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג נשק *"}),e.jsx("input",{value:a.weapon_type,onChange:s=>r({...a,weapon_type:s.target.value}),className:"input",placeholder:"לדוגמה: אקדח, רובה...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"יצרן"}),e.jsx("input",{value:a.manufacturer,onChange:s=>r({...a,manufacturer:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"דגם"}),e.jsx("input",{value:a.model,onChange:s=>r({...a,model:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מספר סידורי *"}),e.jsx("input",{value:a.serial_number,onChange:s=>r({...a,serial_number:s.target.value}),className:"input",dir:"ltr",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מספר רישיון"}),e.jsx("input",{value:a.license_number,onChange:s=>r({...a,license_number:s.target.value}),className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תפוגת רישיון"}),e.jsx("input",{type:"date",value:a.license_expiry,onChange:s=>r({...a,license_expiry:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"הקצה למאבטח"}),e.jsxs("select",{value:a.employee_id,onChange:s=>r({...a,employee_id:s.target.value}),className:"input",children:[e.jsx("option",{value:"",children:"במחסן"}),E.map(s=>e.jsxs("option",{value:s.id,children:[s.first_name," ",s.last_name]},s.id))]})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"label",children:"הערות"}),e.jsx("input",{value:a.notes,onChange:s=>r({...a,notes:s.target.value}),className:"input"})]})]}),e.jsx("button",{type:"submit",disabled:S.isPending,className:"btn-primary",children:S.isPending?"שומר...":"הוסף נשק"})]}),h&&i==="equipment"&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),$.mutate({...n,employee_id:n.employee_id||null})},className:"card space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"הוספת ציוד חדש"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג ציוד *"}),e.jsx("input",{value:n.item_type,onChange:s=>c({...n,item_type:s.target.value}),className:"input",placeholder:"לדוגמה: רדיו, אפוד, פנס...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם פריט *"}),e.jsx("input",{value:n.item_name,onChange:s=>c({...n,item_name:s.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מספר סידורי"}),e.jsx("input",{value:n.serial_number,onChange:s=>c({...n,serial_number:s.target.value}),className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מצב"}),e.jsx("select",{value:n.condition,onChange:s=>c({...n,condition:s.target.value}),className:"input",children:le.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"הקצה למאבטח"}),e.jsxs("select",{value:n.employee_id,onChange:s=>c({...n,employee_id:s.target.value}),className:"input",children:[e.jsx("option",{value:"",children:"לא מוקצה"}),E.map(s=>e.jsxs("option",{value:s.id,children:[s.first_name," ",s.last_name]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"הערות"}),e.jsx("input",{value:n.notes,onChange:s=>c({...n,notes:s.target.value}),className:"input"})]})]}),e.jsx("button",{type:"submit",disabled:$.isPending,className:"btn-primary",children:$.isPending?"שומר...":"הוסף ציוד"})]}),w&&e.jsx("div",{className:"modal-backdrop",children:e.jsx("div",{className:"modal-content w-full max-w-md",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold font-heading mb-4",children:["העברת נשק: ",w.name]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"העבר למאבטח"}),e.jsxs("select",{value:K,onChange:s=>L(s.target.value),className:"input",children:[e.jsx("option",{value:"",children:"החזר למחסן"}),E.map(s=>e.jsxs("option",{value:s.id,children:[s.first_name," ",s.last_name]},s.id))]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>F.mutate({id:w.id,employee_id:K||null}),disabled:F.isPending,className:"btn-primary flex-1",children:F.isPending?"מעביר...":"העבר"}),e.jsx("button",{onClick:()=>q(null),className:"btn-secondary",children:"ביטול"})]})]})]})})}),G?e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary-600 border-t-transparent"})}):i==="weapons"?e.jsx("div",{className:"space-y-3",children:Q.length>0?Q.map(s=>e.jsx("div",{className:"card-interactive p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${s.status==="assigned"?"bg-success-50":s.status==="maintenance"?"bg-warning-50":"bg-gray-100"}`,children:e.jsx(P,{className:`w-6 h-6 ${s.status==="assigned"?"text-success-600":s.status==="maintenance"?"text-warning-600":"text-gray-600"}`})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold font-heading",children:[s.weapon_type," ",s.manufacturer&&`- ${s.manufacturer}`," ",s.model||""]}),e.jsxs("p",{className:"text-sm text-gray-500",children:['מס"ס: ',e.jsx("span",{dir:"ltr",children:s.serial_number}),s.license_number&&` | רישיון: ${s.license_number}`]}),s.employee_name&&e.jsxs("p",{className:"text-sm text-success-600",children:["מוקצה ל: ",s.employee_name]}),s.license_expiry&&e.jsxs("p",{className:"text-xs text-gray-400",children:["תפוגת רישיון: ",s.license_expiry]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium ${s.status==="assigned"?"bg-success-50 text-success-700":s.status==="maintenance"?"bg-warning-50 text-warning-700":"bg-gray-100 text-gray-600"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${s.status==="assigned"?"bg-success-500":s.status==="maintenance"?"bg-warning-500":"bg-gray-400"}`}),s.status==="assigned"?"מוקצה":s.status==="maintenance"?"בתחזוקה":"במחסן"]}),v("weapons:manage")&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>q({id:s.id,name:`${s.weapon_type} ${s.serial_number}`}),className:"btn-secondary text-xs px-2 py-1 flex items-center gap-1",title:"העבר",children:[e.jsx(te,{className:"w-3.5 h-3.5"}),"העבר"]}),e.jsx("button",{onClick:()=>{confirm("למחוק נשק זה?")&&R.mutate(s.id)},className:"text-red-400 hover:text-red-600 p-1",children:e.jsx(O,{className:"w-4 h-4"})})]})]})]})},s.id)):e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:e.jsx(P,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"empty-state-title",children:"אין נשק רשום"}),e.jsx("p",{className:"text-sm text-gray-500",children:"הוסף נשק חדש כדי להתחיל לנהל את המלאי"})]})}):e.jsx("div",{className:"space-y-3",children:M.length>0?M.map(s=>{const t=!!s.employee_id&&!s.return_date,H={new:"חדש",good:"תקין",fair:"סביר",needs_repair:"דורש תיקון",damaged:"פגום"},U={new:"bg-success-500",good:"bg-success-500",fair:"bg-warning-500",needs_repair:"bg-danger-500",damaged:"bg-danger-500"},V={new:"bg-success-50 text-success-700",good:"bg-success-50 text-success-700",fair:"bg-warning-50 text-warning-700",needs_repair:"bg-danger-50 text-danger-700",damaged:"bg-danger-50 text-danger-700"};return e.jsx("div",{className:"card-interactive p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${t?"bg-primary-50":"bg-gray-100"}`,children:e.jsx(k,{className:`w-6 h-6 ${t?"text-primary-600":"text-gray-600"}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold font-heading",children:s.item_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.item_type,s.serial_number&&` | מס"ס: ${s.serial_number}`]}),t&&s.employee_name&&e.jsxs("p",{className:"text-sm text-primary-600",children:["מוקצה ל: ",s.employee_name]}),s.return_date&&e.jsxs("p",{className:"text-xs text-gray-400",children:["הוחזר: ",s.return_date]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium ${V[s.condition]||"bg-gray-100 text-gray-600"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${U[s.condition]||"bg-gray-400"}`}),H[s.condition]||s.condition]}),v("equipment:manage")&&e.jsxs(e.Fragment,{children:[t&&e.jsx("button",{onClick:()=>J.mutate(s.id),className:"btn-secondary text-xs px-2 py-1",children:"החזר"}),e.jsx("button",{onClick:()=>{confirm("למחוק ציוד זה?")&&X.mutate(s.id)},className:"text-red-400 hover:text-red-600 p-1",children:e.jsx(O,{className:"w-4 h-4"})})]})]})]})},s.id)}):e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:e.jsx(k,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"empty-state-title",children:"אין ציוד רשום"}),e.jsx("p",{className:"text-sm text-gray-500",children:"הוסף ציוד חדש כדי להתחיל לנהל את המלאי"})]})})]})}export{me as default};
