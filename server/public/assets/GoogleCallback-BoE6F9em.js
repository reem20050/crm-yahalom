import{r as g,u as k,a as v,j as e,b as N,z as S}from"./index-DBiankO6.js";function G(){const[u,o]=g.useState(null),[w,s]=g.useState(!0),l=k(),d=v(m=>m.login);return g.useEffect(()=>{setTimeout(async()=>{var x,h,b,f;try{const a=window.location.href;console.log("Google callback URL:",a);const t=window.location.hash;if(console.log("Hash:",t),!t||t.length<2){o("לא התקבל טוקן מ-Google"),s(!1);return}const r=new URLSearchParams(t.substring(1)),n=r.get("id_token"),c=r.get("error"),i=r.get("state");console.log("ID Token exists:",!!n),console.log("Error param:",c),console.log("State:",i);const p=localStorage.getItem("google_oauth_state");if(p&&i&&p!==i){console.warn("State mismatch - possible CSRF attack"),o("שגיאת אבטחה - נסה שוב"),s(!1);return}if(localStorage.removeItem("google_oauth_state"),localStorage.removeItem("google_oauth_nonce"),c){o(`שגיאה מ-Google: ${c}`),s(!1);return}if(!n){o("לא התקבל טוקן מ-Google"),s(!1);return}console.log("Sending token to backend...");const j=await N.loginWithGoogle(n);d(j.data.token,j.data.user),S.success("התחברת בהצלחה עם Google!"),l("/",{replace:!0})}catch(a){console.error("Error processing callback:",a);const t=a,r=((h=(x=t.response)==null?void 0:x.data)==null?void 0:h.message)||((f=(b=t.response)==null?void 0:b.data)==null?void 0:f.error)||"שגיאה בהתחברות עם Google";o(r),s(!1)}},100)},[d,l]),w?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-600 to-blue-800",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-2xl shadow-xl",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-700 text-lg",children:"מתחבר עם Google..."}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"אנא המתן"})]})}):u?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-600 to-blue-800",dir:"rtl",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-2xl shadow-xl max-w-md",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"!"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"שגיאה בהתחברות"}),e.jsx("p",{className:"text-gray-600 mb-6",children:u}),e.jsx("button",{onClick:()=>l("/login",{replace:!0}),className:"bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"חזור לדף ההתחברות"})]})}):null}export{G as default};
