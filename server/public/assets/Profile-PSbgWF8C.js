import{a as E,r as o,d as k,j as s,aa as F,S as M,z as b,b as $}from"./index-DNhSfFTF.js";import{u as L}from"./index.esm-CTjlG80w.js";import{t as z,o as A,s as d}from"./types-C-QvhzS9.js";import{M as K}from"./mail-elckFBEn.js";import{K as R}from"./key-round-B-bdOfKl.js";import{E as m,L as T}from"./lock-C7qOvlel.js";import{E as x}from"./eye-BSeQiPpe.js";const y={admin:"מנהל",manager:"מנהל משמרות",employee:"עובד"},B={admin:"badge-danger",manager:"badge-warning",employee:"badge-info"},O=A({currentPassword:d().min(1,"נדרשת סיסמה נוכחית"),newPassword:d().min(6,"סיסמה חדשה חייבת להכיל לפחות 6 תווים"),confirmPassword:d().min(1,"נדרש אישור סיסמה")}).refine(e=>e.newPassword===e.confirmPassword,{message:"הסיסמאות אינן תואמות",path:["confirmPassword"]});function Q(){const e=E(r=>r.user),[t,h]=o.useState(!1),[l,p]=o.useState(!1),[n,j]=o.useState(!1),{register:i,handleSubmit:P,reset:v,formState:{errors:a}}=L({resolver:z(O)}),c=k({mutationFn:r=>$.changePassword(r.currentPassword,r.newPassword),onSuccess:()=>{b.success("הסיסמה שונתה בהצלחה"),v(),h(!1),p(!1),j(!1)},onError:r=>{var u,g,N,f;const w=r,C=((g=(u=w.response)==null?void 0:u.data)==null?void 0:g.message)||((f=(N=w.response)==null?void 0:N.data)==null?void 0:f.error)||"שגיאה בשינוי הסיסמה";b.error(C)}}),S=r=>{c.mutate(r)};return e?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"page-header",children:[s.jsx("h1",{className:"page-title",children:"הפרופיל שלי"}),s.jsx("p",{className:"page-subtitle",children:"צפייה בפרטי המשתמש ושינוי סיסמה"})]}),s.jsx("div",{className:"card",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-primary-100 to-primary-50 rounded-full flex items-center justify-center",children:s.jsx(F,{className:"w-8 h-8 text-primary-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 font-heading",children:[e.firstName," ",e.lastName]}),s.jsxs("div",{className:"flex items-center gap-2 mt-1 text-gray-500",children:[s.jsx(K,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",dir:"ltr",children:e.email})]})]}),s.jsxs("span",{className:`badge ${B[e.role]||"badge-gray"}`,children:[s.jsx(M,{className:"w-3 h-3 ml-1 inline-block"}),y[e.role]||e.role]})]}),s.jsxs("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"שם פרטי"}),s.jsx("p",{className:"font-medium text-gray-900",children:e.firstName})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"שם משפחה"}),s.jsx("p",{className:"font-medium text-gray-900",children:e.lastName})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"תפקיד"}),s.jsx("p",{className:"font-medium text-gray-900",children:y[e.role]||e.role})]})]})]})]})}),s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-100 to-amber-50 rounded-xl flex items-center justify-center",children:s.jsx(R,{className:"w-5 h-5 text-amber-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900 font-heading",children:"שינוי סיסמה"}),s.jsx("p",{className:"text-sm text-gray-500",children:"עדכן את הסיסמה שלך לחשבון"})]})]}),s.jsxs("form",{onSubmit:P(S),className:"space-y-5 max-w-md",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"currentPassword",className:"label",children:"סיסמה נוכחית"}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{id:"currentPassword",type:t?"text":"password",...i("currentPassword"),className:`input pl-10 ${a.currentPassword?"input-error":""}`,placeholder:"הזן סיסמה נוכחית"}),s.jsx("button",{type:"button",onClick:()=>h(!t),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:t?s.jsx(m,{className:"w-5 h-5"}):s.jsx(x,{className:"w-5 h-5"})})]}),a.currentPassword&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.currentPassword.message})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"newPassword",className:"label",children:"סיסמה חדשה"}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{id:"newPassword",type:l?"text":"password",...i("newPassword"),className:`input pl-10 ${a.newPassword?"input-error":""}`,placeholder:"לפחות 6 תווים"}),s.jsx("button",{type:"button",onClick:()=>p(!l),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:l?s.jsx(m,{className:"w-5 h-5"}):s.jsx(x,{className:"w-5 h-5"})})]}),a.newPassword&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.newPassword.message})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"confirmPassword",className:"label",children:"אישור סיסמה חדשה"}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{id:"confirmPassword",type:n?"text":"password",...i("confirmPassword"),className:`input pl-10 ${a.confirmPassword?"input-error":""}`,placeholder:"הזן שוב את הסיסמה החדשה"}),s.jsx("button",{type:"button",onClick:()=>j(!n),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:n?s.jsx(m,{className:"w-5 h-5"}):s.jsx(x,{className:"w-5 h-5"})})]}),a.confirmPassword&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.confirmPassword.message})]}),s.jsx("div",{className:"pt-2",children:s.jsxs("button",{type:"submit",disabled:c.isPending,className:"btn-primary flex items-center gap-2",children:[s.jsx(T,{className:"w-4 h-4"}),c.isPending?"משנה סיסמה...":"שנה סיסמה"]})})]})]})]}):s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("p",{className:"text-gray-500",children:"לא נמצא משתמש מחובר"})})}export{Q as default};
