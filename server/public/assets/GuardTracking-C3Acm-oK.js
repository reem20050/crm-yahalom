import{j as e,r as j,d as o,aa as f,a7 as m,C as x,T as y,a9 as b}from"./index-bRNF7Gia.js";import{G as N,M as v,A as h,I as w}from"./GoogleMapProvider-B4FnXEOR.js";import{M as _}from"./map-pin-BzAReOoP.js";function c(s){return s?Math.round((Date.now()-new Date(s+"Z").getTime())/6e4):1/0}function C(){const[s,i]=j.useState(null),{data:n=[],isLoading:g}=o({queryKey:["active-guards"],queryFn:()=>y.getActiveGuards().then(t=>t.data),refetchInterval:3e4}),{data:u=[]}=o({queryKey:["sites-with-coordinates"],queryFn:()=>b.getWithCoordinates().then(t=>t.data)}),p=n.filter(t=>t.latitude&&t.longitude);return n.filter(t=>!t.latitude||!t.longitude),e.jsxs("div",{className:"h-[calc(100vh-4rem)] flex",children:[e.jsxs("div",{className:"w-80 bg-white border-l border-gray-200 overflow-y-auto flex-shrink-0",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-primary-600"}),"מעקב שומרים"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[n.length," שומרים פעילים"]})]}),g?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-primary-600 border-t-transparent"})}):n.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx(m,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"אין שומרים פעילים כרגע"})]}):e.jsx("div",{className:"divide-y divide-gray-100",children:n.map(t=>{const a=c(t.recorded_at),r=a<10,l=a>=10&&a<60,d=!t.latitude;return e.jsxs("button",{onClick:()=>i(t),className:`w-full text-right p-3 hover:bg-gray-50 transition-colors ${(s==null?void 0:s.assignment_id)===t.assignment_id?"bg-primary-50":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${d?"bg-gray-400":r?"bg-green-500":l?"bg-amber-500":"bg-red-500"}`}),e.jsx("p",{className:"font-medium text-sm text-gray-900",children:t.employee_name})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.site_name," - ",t.company_name]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1 flex items-center gap-1",children:[e.jsx(x,{className:"w-3 h-3"}),d?"אין מיקום":r?`לפני ${a} דקות`:`לפני ${a} דקות`]})]},t.assignment_id)})})]}),e.jsx("div",{className:"flex-1 relative",children:e.jsxs(v,{defaultCenter:{lat:31.5,lng:34.8},defaultZoom:8,gestureHandling:"greedy",mapId:"guard-tracking-map",className:"w-full h-full",children:[u.map(t=>e.jsx(h,{position:{lat:t.latitude,lng:t.longitude},title:t.name,children:e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-300 border border-white shadow flex items-center justify-center",children:e.jsx(_,{className:"w-3 h-3 text-gray-600"})})},`site-${t.id}`)),p.map(t=>{const l=c(t.recorded_at)<10?"bg-blue-500":"bg-amber-500";return e.jsx(h,{position:{lat:t.latitude,lng:t.longitude},onClick:()=>i(t),title:t.employee_name,children:e.jsx("div",{className:`w-9 h-9 rounded-full ${l} border-2 border-white shadow-lg flex items-center justify-center`,children:e.jsx(m,{className:"w-4 h-4 text-white"})})},t.assignment_id)}),s&&s.latitude&&s.longitude&&e.jsx(w,{position:{lat:s.latitude,lng:s.longitude},onCloseClick:()=>i(null),children:e.jsxs("div",{className:"p-2 min-w-[180px]",dir:"rtl",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:s.employee_name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.site_name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.company_name}),s.recorded_at&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1 flex items-center gap-1",children:[e.jsx(x,{className:"w-3 h-3"}),"עדכון לפני ",c(s.recorded_at)," דקות"]})]})})]})})]})}function G(){return e.jsx(N,{children:e.jsx(C,{})})}export{G as default};
