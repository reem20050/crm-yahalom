import{g as i,r as f,h as w,d as M,i as y,j as t,p as D,z as n,G as o,n as F}from"./index-BuGAJY-0.js";import{E as b}from"./external-link-fBhYDhy5.js";import{T as L}from"./trash-2-ChWWyIyn.js";/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=i("FileSpreadsheet",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=i("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]);/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=i("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=i("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=i("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function B(r){return r<1024?r+" B":r<1024*1024?(r/1024).toFixed(1)+" KB":(r/(1024*1024)).toFixed(1)+" MB"}function q(r){return r!=null&&r.startsWith("image/")?t.jsx(S,{className:"w-5 h-5 text-purple-500"}):r!=null&&r.includes("spreadsheet")||r!=null&&r.includes("excel")?t.jsx(_,{className:"w-5 h-5 text-green-500"}):r!=null&&r.includes("pdf")?t.jsx(F,{className:"w-5 h-5 text-red-500"}):t.jsx(z,{className:"w-5 h-5 text-blue-500"})}function H({entityType:r,entityId:s}){const[j,l]=f.useState(!1),d=f.useRef(null),u=w(),{data:c,isLoading:v}=M({queryKey:["documents",r,s],queryFn:()=>o.getByEntity(r,s).then(e=>e.data)}),x=(c==null?void 0:c.documents)??[],h=y({mutationFn:e=>{const a=new FormData;return a.append("file",e),a.append("entity_type",r),a.append("entity_id",s),o.upload(a)},onSuccess:()=>{u.invalidateQueries({queryKey:["documents",r,s]}),n.success("מסמך הועלה בהצלחה")},onError:e=>{var m,g;const a=e;n.error(((g=(m=a.response)==null?void 0:m.data)==null?void 0:g.message)||"שגיאה בהעלאת מסמך")}}),N=y({mutationFn:e=>o.delete(e),onSuccess:()=>{u.invalidateQueries({queryKey:["documents",r,s]}),n.success("מסמך נמחק")},onError:()=>n.error("שגיאה במחיקת מסמך")}),p=e=>{if(!e||e.length===0)return;const a=e[0];if(a.size>10*1024*1024){n.error("הקובץ גדול מדי (מקסימום 10MB)");return}h.mutate(a)},k=e=>{e.preventDefault(),l(!1),p(e.dataTransfer.files)};return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors cursor-pointer ${j?"border-primary-500 bg-primary-50":"border-gray-300 hover:border-primary-400 hover:bg-gray-50"}`,onDragOver:e=>{e.preventDefault(),l(!0)},onDragLeave:()=>l(!1),onDrop:k,onClick:()=>{var e;return(e=d.current)==null?void 0:e.click()},children:[h.isPending?t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx(D,{className:"w-6 h-6 animate-spin text-primary-500"}),t.jsx("span",{className:"text-primary-600 font-medium",children:"מעלה..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(E,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),t.jsx("p",{className:"text-sm text-gray-600",children:"גרור קובץ לכאן או לחץ לבחירה"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"מקסימום 10MB"})]}),t.jsx("input",{ref:d,type:"file",className:"hidden",onChange:e=>p(e.target.files)})]}),v?t.jsx("div",{className:"text-center py-4",children:t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-primary-600 border-t-transparent mx-auto"})}):x.length>0?t.jsx("div",{className:"divide-y divide-gray-100",children:x.map(e=>t.jsxs("div",{className:"flex items-center justify-between py-3",children:[t.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[q(e.file_type),t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.file_name}),t.jsxs("p",{className:"text-xs text-gray-500",children:[B(e.file_size)," • ",e.uploaded_by_name||"מערכת"," • ",new Date(e.created_at).toLocaleDateString("he-IL")]})]})]}),t.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.google_drive_url&&t.jsx("a",{href:e.google_drive_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 hover:text-primary-700 p-1",title:"פתח ב-Google Drive",children:t.jsx(b,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{confirm("האם למחוק מסמך זה?")&&N.mutate(e.id)},className:"text-red-400 hover:text-red-600 p-1",title:"מחק מסמך",children:t.jsx(L,{className:"w-4 h-4"})})]})]},e.id))}):t.jsx("p",{className:"text-center text-gray-400 text-sm py-4",children:"אין מסמכים"})]})}export{H as D,Q as P};
