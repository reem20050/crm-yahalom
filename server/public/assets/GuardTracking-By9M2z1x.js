import{j as e,r as u,e as c,ac as y,aa as f,o as d,s as j,g as w}from"./index-DNhSfFTF.js";import{G as v,a as N,M as m,I as b}from"./GoogleMapProvider-CVeS9EjV.js";function l(s){return s?Math.round((Date.now()-new Date(s+"Z").getTime())/6e4):1/0}const _={width:"100%",height:"100%"},k={lat:31.5,lng:34.8},C={url:"data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><circle cx="10" cy="10" r="8" fill="%239CA3AF" stroke="white" stroke-width="2"/></svg>'),scaledSize:{width:20,height:20}};function G(s){return{url:"data:image/svg+xml,"+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><circle cx="16" cy="16" r="14" fill="${s?"%233B82F6":"%23F59E0B"}" stroke="white" stroke-width="3"/><text x="16" y="21" text-anchor="middle" fill="white" font-size="14">&#x1F464;</text></svg>`),scaledSize:{width:32,height:32}}}function I(){const[s,i]=u.useState(null),{data:n=[],isLoading:x}=c({queryKey:["active-guards"],queryFn:()=>j.getActiveGuards().then(t=>t.data),refetchInterval:3e4}),{data:h=[]}=c({queryKey:["sites-with-coordinates"],queryFn:()=>w.getWithCoordinates().then(t=>t.data)}),g=n.filter(t=>t.latitude&&t.longitude);return e.jsxs("div",{className:"h-[calc(100vh-4rem)] flex",children:[e.jsxs("div",{className:"w-80 bg-white border-l border-gray-200 overflow-y-auto flex-shrink-0",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 font-heading flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-primary-600"}),"מעקב שומרים"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[n.length," שומרים פעילים"]})]}),x?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-primary-600 border-t-transparent"})}):n.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx(f,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"אין שומרים פעילים כרגע"})]}):e.jsx("div",{className:"divide-y divide-gray-100",children:n.map(t=>{const a=l(t.recorded_at),r=a<10,p=a>=10&&a<60,o=!t.latitude;return e.jsxs("button",{onClick:()=>i(t),className:`w-full text-right p-3 hover:bg-gray-50 transition-colors ${(s==null?void 0:s.assignment_id)===t.assignment_id?"bg-primary-50":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${o?"bg-gray-400":r?"bg-green-500":p?"bg-amber-500":"bg-red-500"}`}),e.jsx("p",{className:"font-medium text-sm text-gray-900",children:t.employee_name})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.site_name," - ",t.company_name]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1 flex items-center gap-1",children:[e.jsx(d,{className:"w-3 h-3"}),o?"אין מיקום":`לפני ${a} דקות`]})]},t.assignment_id)})})]}),e.jsx("div",{className:"flex-1 relative",children:e.jsxs(N,{mapContainerStyle:_,center:k,zoom:8,options:{gestureHandling:"greedy"},children:[h.map(t=>e.jsx(m,{position:{lat:t.latitude,lng:t.longitude},title:t.name,icon:C},`site-${t.id}`)),g.map(t=>{const r=l(t.recorded_at)<10;return e.jsx(m,{position:{lat:t.latitude,lng:t.longitude},onClick:()=>i(t),title:t.employee_name,icon:G(r)},t.assignment_id)}),s&&s.latitude&&s.longitude&&e.jsx(b,{position:{lat:s.latitude,lng:s.longitude},onCloseClick:()=>i(null),children:e.jsxs("div",{className:"p-2 min-w-[180px]",dir:"rtl",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:s.employee_name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.site_name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.company_name}),s.recorded_at&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1 flex items-center gap-1",children:[e.jsx(d,{className:"w-3 h-3"}),"עדכון לפני ",l(s.recorded_at)," דקות"]})]})})]})})]})}function M(){return e.jsx(v,{children:e.jsx(I,{})})}export{M as default};
