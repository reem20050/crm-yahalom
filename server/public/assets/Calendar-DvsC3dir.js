import{u as se,k as ae,r as h,e as L,j as e,S as P,P as A,p as _,s as re,a2 as ne,D as le}from"./index-CYVBYVvl.js";import{C as oe,a as ce}from"./chevron-right-BiJ3-t6b.js";import{E as ie}from"./external-link-BuJEn0AY.js";const de=["专","驻专专","专抓","驻专","","","","住","住驻专","拽专","专","爪专"],xe=["专砖","砖","砖砖","专注","砖","砖砖","砖转"],W=3;function ge(n,r){const i=new Date(n,r,1),d=new Date(n,r+1,0),y=i.getDay(),c=[];for(let s=y-1;s>=0;s--){const x=new Date(n,r,-s);c.push({date:x,isCurrentMonth:!1})}for(let s=1;s<=d.getDate();s++)c.push({date:new Date(n,r,s),isCurrentMonth:!0});const g=7-c.length%7;if(g<7)for(let s=1;s<=g;s++){const x=new Date(n,r+1,s);c.push({date:x,isCurrentMonth:!1})}return c}function k(n){const r=n.getFullYear(),i=String(n.getMonth()+1).padStart(2,"0"),d=String(n.getDate()).padStart(2,"0");return`${r}-${i}-${d}`}function me(n,r){const i=new Date(n,r,1),d=new Date(n,r+1,0);return{start_date:k(i),end_date:k(d)}}function be(){const n=se(),{isEmployee:r}=ae(),i=new Date,[d,y]=h.useState(i.getFullYear()),[c,g]=h.useState(i.getMonth()),[s,x]=h.useState("all"),[N,he]=h.useState(!0),{start_date:u,end_date:f}=me(d,c),{data:E,isLoading:O}=L({queryKey:["calendar-shifts",u,f],queryFn:()=>re.getAll({start_date:u,end_date:f}).then(t=>t.data)}),{data:D,isLoading:H}=L({queryKey:["calendar-events",u,f],queryFn:()=>ne.getAll({start_date:u,end_date:f}).then(t=>t.data)}),{data:b}=L({queryKey:["google-calendar-events",u,f],queryFn:()=>le.getGoogleCalendarEvents(u,f).then(t=>t.data),retry:!1,enabled:!r}),F=O||H,S=(E==null?void 0:E.shifts)??[],C=(D==null?void 0:D.events)??[],M=(b==null?void 0:b.events)??[],v=(b==null?void 0:b.connected)??!1,q=h.useMemo(()=>{const t={};for(const a of S){const l=a.date;t[l]||(t[l]=[]),t[l].push(a)}return t},[S]),B=h.useMemo(()=>{const t={};for(const a of C){const l=a.event_date;t[l]||(t[l]=[]),t[l].push(a)}return t},[C]),Y=h.useMemo(()=>{const t={};for(const a of M){const l=a.start_date;t[l]||(t[l]=[]),t[l].push(a)}return t},[M]),K=h.useMemo(()=>ge(d,c),[d,c]),Q=k(i),V=()=>{c===0?(g(11),y(t=>t-1)):g(t=>t-1)},X=()=>{c===11?(g(0),y(t=>t+1)):g(t=>t+1)},z=()=>{y(i.getFullYear()),g(i.getMonth())},J=t=>e.jsxs("button",{onClick:a=>{a.stopPropagation(),n("/shifts")},className:"w-full text-right rounded px-1.5 py-0.5 text-[11px] leading-tight bg-blue-50 text-blue-800 border border-blue-200 hover:bg-blue-100 transition-colors cursor-pointer truncate flex items-center gap-1",title:`${t.start_time} - ${t.end_time} | ${t.site_name||t.customer_name||"砖专转"}`,children:[e.jsx(P,{className:"w-3 h-3 flex-shrink-0 text-blue-500"}),e.jsxs("span",{className:"truncate",children:[t.start_time," ",t.site_name||t.customer_name||"砖专转"]})]},`shift-${t.id}`),U=t=>e.jsxs("button",{onClick:a=>{a.stopPropagation(),n(`/events/${t.id}`)},className:"w-full text-right rounded px-1.5 py-0.5 text-[11px] leading-tight bg-emerald-50 text-emerald-800 border border-emerald-200 hover:bg-emerald-100 transition-colors cursor-pointer truncate flex items-center gap-1",title:`${t.start_time} - ${t.end_time} | ${t.event_name} | ${t.location}`,children:[e.jsx(A,{className:"w-3 h-3 flex-shrink-0 text-emerald-500"}),e.jsxs("span",{className:"truncate",children:[t.start_time," ",t.event_name]})]},`event-${t.id}`),Z=t=>e.jsxs("a",{href:t.html_link,target:"_blank",rel:"noopener noreferrer",className:"w-full text-right rounded px-1.5 py-0.5 text-[11px] leading-tight bg-purple-50 text-purple-800 border border-purple-200 hover:bg-purple-100 transition-colors cursor-pointer truncate flex items-center gap-1",title:`${t.start_time?t.start_time+" - "+t.end_time+" | ":"  | "}${t.title}${t.location?" | "+t.location:""}`,onClick:a=>a.stopPropagation(),children:[e.jsx(_,{className:"w-3 h-3 flex-shrink-0 text-purple-500"}),e.jsxs("span",{className:"truncate",children:[t.all_day?"":t.start_time," ",t.title]}),e.jsx(ie,{className:"w-2.5 h-2.5 flex-shrink-0 text-purple-400"})]},`google-${t.id}`),ee=t=>{const a=q[t]||[],l=B[t]||[],m=Y[t]||[];let o=[];(s==="all"||s==="shifts")&&(o=o.concat(a.map(J))),(s==="all"||s==="events")&&(o=o.concat(l.map(U))),(s==="all"||s==="google")&&N&&(o=o.concat(m.map(Z)));const R=o.length,j=o.slice(0,W),p=R-W;return e.jsxs("div",{className:"flex flex-col gap-0.5 mt-1",children:[j,p>0&&e.jsxs("span",{className:"text-[10px] text-gray-400 text-center",children:["+",p," 住驻"]})]})},G=S.length,T=C.length,I=M.length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:" 砖"}),e.jsx("p",{className:"text-gray-500",children:r?"砖专转 专注 砖":"转爪 砖转 砖 砖专转 专注"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-blue-100 border border-blue-300"}),"砖专转 (",G,")"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-emerald-100 border border-emerald-300"}),"专注 (",T,")"]}),v&&!r&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-purple-100 border border-purple-300"}),"Google (",I,")"]})]})})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:V,className:"btn-secondary p-2","aria-label":"砖 拽",children:e.jsx(oe,{className:"w-5 h-5"})}),e.jsxs("h2",{className:"text-lg font-semibold min-w-[160px] text-center",children:[de[c]," ",d]}),e.jsx("button",{onClick:X,className:"btn-secondary p-2","aria-label":"砖 ",children:e.jsx(ce,{className:"w-5 h-5"})}),e.jsx("button",{onClick:z,className:"btn-secondary text-sm px-3 py-1.5",children:""})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x("all"),className:`text-sm px-3 py-1.5 rounded-lg transition-colors ${s==="all"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:""}),e.jsxs("button",{onClick:()=>x("shifts"),className:`text-sm px-3 py-1.5 rounded-lg transition-colors flex items-center gap-1 ${s==="shifts"?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(P,{className:"w-3.5 h-3.5"}),"砖专转"]}),e.jsxs("button",{onClick:()=>x("events"),className:`text-sm px-3 py-1.5 rounded-lg transition-colors flex items-center gap-1 ${s==="events"?"bg-emerald-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(A,{className:"w-3.5 h-3.5"}),"专注"]}),v&&!r&&e.jsxs("button",{onClick:()=>{x(s==="google"?"all":"google")},className:`text-sm px-3 py-1.5 rounded-lg transition-colors flex items-center gap-1 ${s==="google"?"bg-purple-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(_,{className:"w-3.5 h-3.5"}),"Google"]})]})]})}),F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-2 border-primary-600 border-t-transparent"})}):e.jsxs("div",{className:"card p-0 overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-7 border-b bg-gray-50",children:xe.map((t,a)=>e.jsx("div",{className:`py-3 text-center text-sm font-semibold text-gray-600 ${a<6?"border-l border-gray-200":""} ${a===6?"text-red-500":""}`,children:t},t))}),e.jsx("div",{className:"grid grid-cols-7",children:K.map(({date:t,isCurrentMonth:a},l)=>{const m=k(t),o=m===Q,j=t.getDay()===6,p=q[m]||[],w=B[m]||[],$=Y[m]||[],te=s==="all"&&(p.length>0||w.length>0||N&&$.length>0)||s==="shifts"&&p.length>0||s==="events"&&w.length>0||s==="google"&&$.length>0;return e.jsxs("div",{className:`
                    min-h-[120px] p-1.5 border-b border-l border-gray-200
                    transition-colors
                    ${a?"bg-white":"bg-gray-50"}
                    ${o?"bg-primary-50 ring-2 ring-inset ring-primary-400":""}
                    ${j&&a?"bg-red-50/30":""}
                    ${te?"hover:bg-gray-50":""}
                  `,children:[e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsx("span",{className:`
                        text-sm font-medium w-7 h-7 flex items-center justify-center rounded-full
                        ${o?"bg-primary-500 text-white":""}
                        ${a?"":"text-gray-300"}
                        ${a&&!o&&j?"text-red-400":""}
                        ${a&&!o&&!j?"text-gray-700":""}
                      `,children:t.getDate()}),a&&(p.length>0||w.length>0||$.length>0)&&e.jsxs("div",{className:"flex items-center gap-0.5",children:[p.length>0&&(s==="all"||s==="shifts")&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-400"}),w.length>0&&(s==="all"||s==="events")&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-400"}),$.length>0&&N&&(s==="all"||s==="google")&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-purple-400"})]})]}),a&&ee(m)]},`${m}-${l}`)})})]}),!F&&e.jsxs("div",{className:`grid grid-cols-1 ${v&&!r?"md:grid-cols-4":"md:grid-cols-3"} gap-4`,children:[e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(P,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:G}),e.jsx("p",{className:"text-sm text-gray-500",children:"砖专转 砖"})]})]}),e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center",children:e.jsx(A,{className:"w-6 h-6 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:T}),e.jsx("p",{className:"text-sm text-gray-500",children:"专注 砖"})]})]}),v&&!r&&e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(_,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:I}),e.jsx("p",{className:"text-sm text-gray-500",children:"专注 Google"})]})]}),e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx(_,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:G+T+(N?I:0)}),e.jsx("p",{className:"text-sm text-gray-500",children:'住" 驻专'})]})]})]})]})}export{be as default};
