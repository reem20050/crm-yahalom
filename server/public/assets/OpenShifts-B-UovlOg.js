import{x as N,c as v,r as b,e as w,d as k,j as e,L as m,o as _,U as C,C as D,z as y,s as h}from"./index-DNhSfFTF.js";import{M as q}from"./map-pin-CnrXv9DV.js";/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=N("CalendarX",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"10",x2:"14",y1:"14",y2:"18",key:"1g3qc0"}],["line",{x1:"14",x2:"10",y1:"14",y2:"18",key:"1az83m"}]]);function u(t){return t?t.slice(0,5):""}function g(t){const n=new Date(t+"T00:00:00"),i=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],r=["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"];return`יום ${i[n.getDay()]}, ${n.getDate()} ${r[n.getMonth()]}`}function p(t){const n=new Date().toISOString().split("T")[0];return t===n}function f(t){const n=new Date;return n.setDate(n.getDate()+1),t===n.toISOString().split("T")[0]}function T(t){return p(t)?"היום":f(t)?"מחר":g(t)}function O(){const t=v(),[n,i]=b.useState(null),{data:r,isLoading:d}=w({queryKey:["open-shifts"],queryFn:()=>h.getOpen().then(s=>s.data),refetchInterval:6e4}),c=k({mutationFn:s=>h.selfAssign(s),onSuccess:()=>{t.invalidateQueries({queryKey:["open-shifts"]}),t.invalidateQueries({queryKey:["my-active-assignment"]}),y.success("נרשמת למשמרת בהצלחה!"),i(null)},onError:s=>{var a,o;y.error(((o=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:o.error)||"שגיאה ברישום למשמרת"),i(null)}}),x=(r==null?void 0:r.shifts)||[],l={};for(const s of x)l[s.date]||(l[s.date]=[]),l[s.date].push(s);const j=Object.keys(l).sort();return d?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(m,{className:"w-10 h-10 animate-spin text-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{className:"page-title",children:"משמרות פתוחות"}),e.jsx("p",{className:"page-subtitle",children:"משמרות שחסר בהן כוח אדם - הירשם כדי להשתבץ"})]}),x.length===0?e.jsxs("div",{className:"card text-center py-16 px-8",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-gray-100 to-gray-50 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(S,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2 font-heading",children:"אין משמרות פתוחות"}),e.jsx("p",{className:"text-gray-500",children:"כרגע כל המשמרות מאוישות. בדוק שוב מאוחר יותר."})]}):e.jsx("div",{className:"space-y-8",children:j.map(s=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 font-heading",children:T(s)}),(p(s)||f(s))&&e.jsx("span",{className:"text-sm text-gray-400",children:g(s)})]}),e.jsx("div",{className:"grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3",children:l[s].map(a=>e.jsx("div",{className:"card hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-primary-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:a.site_name||"אתר לא ידוע"}),a.customer_name&&e.jsx("p",{className:"text-sm text-gray-500",children:a.customer_name})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(_,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[u(a.start_time)," - ",u(a.end_time)]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(C,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[a.slots_available," ",a.slots_available===1?"מקום פנוי":"מקומות פנויים",e.jsxs("span",{className:"text-gray-400",children:[" (מתוך ",a.required_employees,")"]})]})]}),e.jsx("div",{className:"pt-2",children:n===a.shift_id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"האם להירשם למשמרת זו?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c.mutate(a.shift_id),disabled:c.isPending,className:"flex-1 btn-success text-sm py-2 flex items-center justify-center gap-1",children:c.isPending?e.jsx(m,{className:"w-4 h-4 animate-spin"}):"אישור"}),e.jsx("button",{onClick:()=>i(null),disabled:c.isPending,className:"flex-1 btn-secondary text-sm py-2",children:"ביטול"})]})]}):e.jsxs("button",{onClick:()=>i(a.shift_id),className:"w-full btn-success text-sm py-2.5 flex items-center justify-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"הירשם למשמרת"]})})]})},a.shift_id))})]},s))})]})}export{O as default};
