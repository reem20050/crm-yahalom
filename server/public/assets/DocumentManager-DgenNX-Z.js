import{x as i,r as g,c as w,e as b,d as y,j as r,L as D,z as n,V as c,E as F}from"./index-DNhSfFTF.js";import{E as M}from"./external-link-BplGfNjn.js";import{T as _}from"./trash-2-C8JFUyr_.js";/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=i("FileSpreadsheet",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=i("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]);/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=i("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=i("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function B(t){return t<1024?t+" B":t<1024*1024?(t/1024).toFixed(1)+" KB":(t/(1024*1024)).toFixed(1)+" MB"}function q(t){return t!=null&&t.startsWith("image/")?r.jsx(E,{className:"w-5 h-5 text-purple-500"}):t!=null&&t.includes("spreadsheet")||t!=null&&t.includes("excel")?r.jsx(L,{className:"w-5 h-5 text-green-500"}):t!=null&&t.includes("pdf")?r.jsx(F,{className:"w-5 h-5 text-red-500"}):r.jsx(z,{className:"w-5 h-5 text-blue-500"})}function H({entityType:t,entityId:s}){const[j,l]=g.useState(!1),d=g.useRef(null),u=w(),{data:o,isLoading:v}=b({queryKey:["documents",t,s],queryFn:()=>c.getByEntity(t,s).then(e=>e.data)}),x=(o==null?void 0:o.documents)??[],h=y({mutationFn:e=>{const a=new FormData;return a.append("file",e),a.append("entity_type",t),a.append("entity_id",s),c.upload(a)},onSuccess:()=>{u.invalidateQueries({queryKey:["documents",t,s]}),n.success("מסמך הועלה בהצלחה")},onError:e=>{var p,f;const a=e;n.error(((f=(p=a.response)==null?void 0:p.data)==null?void 0:f.message)||"שגיאה בהעלאת מסמך")}}),N=y({mutationFn:e=>c.delete(e),onSuccess:()=>{u.invalidateQueries({queryKey:["documents",t,s]}),n.success("מסמך נמחק")},onError:()=>n.error("שגיאה במחיקת מסמך")}),m=e=>{if(!e||e.length===0)return;const a=e[0];if(a.size>10*1024*1024){n.error("הקובץ גדול מדי (מקסימום 10MB)");return}h.mutate(a)},k=e=>{e.preventDefault(),l(!1),m(e.dataTransfer.files)};return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:`border-2 border-dashed rounded-xl p-6 text-center transition-all duration-200 cursor-pointer ${j?"border-primary-500 bg-primary-50 shadow-inner":"border-primary-200 hover:border-primary-400 hover:bg-primary-50/30"}`,onDragOver:e=>{e.preventDefault(),l(!0)},onDragLeave:()=>l(!1),onDrop:k,onClick:()=>{var e;return(e=d.current)==null?void 0:e.click()},children:[h.isPending?r.jsxs("div",{className:"flex items-center justify-center gap-2",children:[r.jsx(D,{className:"w-6 h-6 animate-spin text-primary-500"}),r.jsx("span",{className:"text-primary-600 font-medium font-heading",children:"מעלה..."})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-primary-100 to-primary-50 flex items-center justify-center mx-auto mb-3",children:r.jsx(S,{className:"w-6 h-6 text-primary-500"})}),r.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"גרור קובץ לכאן או לחץ לבחירה"}),r.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"מקסימום 10MB"})]}),r.jsx("input",{ref:d,type:"file",className:"hidden",onChange:e=>m(e.target.files)})]}),v?r.jsx("div",{className:"text-center py-4",children:r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-primary-600 border-t-transparent mx-auto"})}):x.length>0?r.jsx("div",{className:"space-y-2",children:x.map(e=>r.jsxs("div",{className:"card flex items-center justify-between p-3 hover:shadow-card-hover transition-all duration-200",children:[r.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[r.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-gray-100 to-gray-50 flex items-center justify-center flex-shrink-0",children:q(e.file_type)}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:"text-sm font-medium font-heading text-gray-900 truncate",children:e.file_name}),r.jsxs("p",{className:"text-xs text-gray-500",children:[B(e.file_size)," • ",e.uploaded_by_name||"מערכת"," • ",new Date(e.created_at).toLocaleDateString("he-IL")]})]})]}),r.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.google_drive_url&&r.jsx("a",{href:e.google_drive_url,target:"_blank",rel:"noopener noreferrer",className:"btn-icon text-primary-600 hover:text-primary-700",title:"פתח ב-Google Drive",children:r.jsx(M,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>{confirm("האם למחוק מסמך זה?")&&N.mutate(e.id)},className:"btn-icon text-red-400 hover:text-red-600",title:"מחק מסמך",children:r.jsx(_,{className:"w-4 h-4"})})]})]},e.id))}):r.jsx("p",{className:"text-center text-gray-400 text-sm py-4",children:"אין מסמכים"})]})}export{H as D};
