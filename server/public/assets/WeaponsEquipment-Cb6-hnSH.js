import{r as d,g as B,d as S,h as p,j as s,X as G,t as K,S as H,z as t,x as b,y as j,q as J}from"./index-DVPKYaqZ.js";import{P as U}from"./plus-BMlu7TrJ.js";import{P as L}from"./package-BtEFAGBx.js";import{A as V}from"./arrow-left-right-BR8HjtzT.js";import{T as Q}from"./trash-2-DYOkOht6.js";const Y=[{value:"new",label:"חדש"},{value:"good",label:"תקין"},{value:"fair",label:"סביר"},{value:"needs_repair",label:"דורש תיקון"},{value:"damaged",label:"פגום"}];function le(){var P,A;const[i,E]=d.useState("weapons"),[x,h]=d.useState(!1),[g,y]=d.useState(""),[N,v]=d.useState(null),[F,$]=d.useState(""),o=B(),[a,r]=d.useState({weapon_type:"",manufacturer:"",model:"",serial_number:"",license_number:"",license_expiry:"",employee_id:"",notes:""}),[l,c]=d.useState({item_type:"",item_name:"",serial_number:"",condition:"good",employee_id:"",notes:""}),{data:m,isLoading:W}=S({queryKey:["all-weapons"],queryFn:()=>b.getAll().then(e=>e.data),enabled:i==="weapons"}),{data:u,isLoading:M}=S({queryKey:["all-equipment"],queryFn:()=>j.getAll().then(e=>e.data),enabled:i==="equipment"}),{data:f}=S({queryKey:["employees-active"],queryFn:()=>J.getAll({status:"active",limit:200}).then(e=>e.data)}),_=(f==null?void 0:f.employees)||[],q=p({mutationFn:e=>b.create(e),onSuccess:()=>{o.invalidateQueries({queryKey:["all-weapons"]}),t.success("נשק נוסף בהצלחה"),h(!1),r({weapon_type:"",manufacturer:"",model:"",serial_number:"",license_number:"",license_expiry:"",employee_id:"",notes:""})},onError:()=>t.error("שגיאה בהוספת נשק")}),I=p({mutationFn:e=>b.delete(e),onSuccess:()=>{o.invalidateQueries({queryKey:["all-weapons"]}),t.success("נשק נמחק")},onError:()=>t.error("שגיאה במחיקה")}),C=p({mutationFn:({id:e,employee_id:n})=>b.transfer(e,n),onSuccess:()=>{o.invalidateQueries({queryKey:["all-weapons"]}),t.success("הנשק הועבר בהצלחה"),v(null),$("")},onError:()=>t.error("שגיאה בהעברה")}),w=p({mutationFn:e=>j.create(e),onSuccess:()=>{o.invalidateQueries({queryKey:["all-equipment"]}),t.success("ציוד נוסף בהצלחה"),h(!1),c({item_type:"",item_name:"",serial_number:"",condition:"good",employee_id:"",notes:""})},onError:()=>t.error("שגיאה בהוספת ציוד")}),O=p({mutationFn:e=>j.returnItem(e,"good"),onSuccess:()=>{o.invalidateQueries({queryKey:["all-equipment"]}),t.success("ציוד הוחזר")},onError:()=>t.error("שגיאה בהחזרה")}),z=p({mutationFn:e=>j.delete(e),onSuccess:()=>{o.invalidateQueries({queryKey:["all-equipment"]}),t.success("ציוד נמחק")},onError:()=>t.error("שגיאה במחיקה")}),R=i==="weapons"?W:M,T=((m==null?void 0:m.weapons)||[]).filter(e=>!g||[e.weapon_type,e.serial_number,e.employee_name,e.manufacturer].some(n=>n==null?void 0:n.toLowerCase().includes(g.toLowerCase()))),k=((u==null?void 0:u.equipment)||[]).filter(e=>!g||[e.item_type,e.item_name,e.employee_name,e.serial_number].some(n=>n==null?void 0:n.toLowerCase().includes(g.toLowerCase())));return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"נשק וציוד"}),s.jsx("p",{className:"text-gray-500",children:"ניהול נשק, ציוד ומלאי"})]}),s.jsxs("button",{onClick:()=>h(!x),className:"btn-primary flex items-center gap-2",children:[x?s.jsx(G,{className:"w-5 h-5"}):s.jsx(U,{className:"w-5 h-5"}),x?"ביטול":i==="weapons"?"הוסף נשק":"הוסף ציוד"]})]}),s.jsxs("div",{className:"flex items-center gap-4 border-b",children:[s.jsxs("button",{onClick:()=>{E("weapons"),h(!1),y("")},className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${i==="weapons"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[s.jsx(K,{className:"w-5 h-5"}),"נשק (",((P=m==null?void 0:m.weapons)==null?void 0:P.length)||0,")"]}),s.jsxs("button",{onClick:()=>{E("equipment"),h(!1),y("")},className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${i==="equipment"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[s.jsx(L,{className:"w-5 h-5"}),"ציוד (",((A=u==null?void 0:u.equipment)==null?void 0:A.length)||0,")"]})]}),s.jsxs("div",{className:"relative",children:[s.jsx(H,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),s.jsx("input",{type:"text",value:g,onChange:e=>y(e.target.value),placeholder:"חיפוש...",className:"input pr-10"})]}),x&&i==="weapons"&&s.jsxs("form",{onSubmit:e=>{e.preventDefault(),q.mutate({...a,employee_id:a.employee_id||null,status:a.employee_id?"assigned":"in_armory"})},className:"card space-y-4",children:[s.jsx("h3",{className:"font-semibold text-lg",children:"הוספת נשק חדש"}),s.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"סוג נשק *"}),s.jsx("input",{value:a.weapon_type,onChange:e=>r({...a,weapon_type:e.target.value}),className:"input",placeholder:"לדוגמה: אקדח, רובה...",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"יצרן"}),s.jsx("input",{value:a.manufacturer,onChange:e=>r({...a,manufacturer:e.target.value}),className:"input"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"דגם"}),s.jsx("input",{value:a.model,onChange:e=>r({...a,model:e.target.value}),className:"input"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"מספר סידורי *"}),s.jsx("input",{value:a.serial_number,onChange:e=>r({...a,serial_number:e.target.value}),className:"input",dir:"ltr",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"מספר רישיון"}),s.jsx("input",{value:a.license_number,onChange:e=>r({...a,license_number:e.target.value}),className:"input",dir:"ltr"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"תפוגת רישיון"}),s.jsx("input",{type:"date",value:a.license_expiry,onChange:e=>r({...a,license_expiry:e.target.value}),className:"input"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"הקצה למאבטח"}),s.jsxs("select",{value:a.employee_id,onChange:e=>r({...a,employee_id:e.target.value}),className:"input",children:[s.jsx("option",{value:"",children:"במחסן"}),_.map(e=>s.jsxs("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),s.jsxs("div",{className:"lg:col-span-2",children:[s.jsx("label",{className:"label",children:"הערות"}),s.jsx("input",{value:a.notes,onChange:e=>r({...a,notes:e.target.value}),className:"input"})]})]}),s.jsx("button",{type:"submit",disabled:q.isPending,className:"btn-primary",children:q.isPending?"שומר...":"הוסף נשק"})]}),x&&i==="equipment"&&s.jsxs("form",{onSubmit:e=>{e.preventDefault(),w.mutate({...l,employee_id:l.employee_id||null})},className:"card space-y-4",children:[s.jsx("h3",{className:"font-semibold text-lg",children:"הוספת ציוד חדש"}),s.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"סוג ציוד *"}),s.jsx("input",{value:l.item_type,onChange:e=>c({...l,item_type:e.target.value}),className:"input",placeholder:"לדוגמה: רדיו, אפוד, פנס...",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"שם פריט *"}),s.jsx("input",{value:l.item_name,onChange:e=>c({...l,item_name:e.target.value}),className:"input",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"מספר סידורי"}),s.jsx("input",{value:l.serial_number,onChange:e=>c({...l,serial_number:e.target.value}),className:"input",dir:"ltr"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"מצב"}),s.jsx("select",{value:l.condition,onChange:e=>c({...l,condition:e.target.value}),className:"input",children:Y.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"הקצה למאבטח"}),s.jsxs("select",{value:l.employee_id,onChange:e=>c({...l,employee_id:e.target.value}),className:"input",children:[s.jsx("option",{value:"",children:"לא מוקצה"}),_.map(e=>s.jsxs("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"הערות"}),s.jsx("input",{value:l.notes,onChange:e=>c({...l,notes:e.target.value}),className:"input"})]})]}),s.jsx("button",{type:"submit",disabled:w.isPending,className:"btn-primary",children:w.isPending?"שומר...":"הוסף ציוד"})]}),N&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md p-6",children:[s.jsxs("h3",{className:"text-lg font-bold mb-4",children:["העברת נשק: ",N.name]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"העבר למאבטח"}),s.jsxs("select",{value:F,onChange:e=>$(e.target.value),className:"input",children:[s.jsx("option",{value:"",children:"החזר למחסן"}),_.map(e=>s.jsxs("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>C.mutate({id:N.id,employee_id:F||null}),disabled:C.isPending,className:"btn-primary flex-1",children:C.isPending?"מעביר...":"העבר"}),s.jsx("button",{onClick:()=>v(null),className:"btn-secondary",children:"ביטול"})]})]})]})}),R?s.jsx("div",{className:"flex items-center justify-center h-48",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-primary-500 border-t-transparent"})}):i==="weapons"?s.jsx("div",{className:"space-y-3",children:T.length>0?T.map(e=>s.jsx("div",{className:"card p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${e.status==="assigned"?"bg-green-100":e.status==="maintenance"?"bg-yellow-100":"bg-gray-100"}`,children:s.jsx(K,{className:`w-6 h-6 ${e.status==="assigned"?"text-green-600":e.status==="maintenance"?"text-yellow-600":"text-gray-600"}`})}),s.jsxs("div",{children:[s.jsxs("p",{className:"font-semibold",children:[e.weapon_type," ",e.manufacturer&&`- ${e.manufacturer}`," ",e.model||""]}),s.jsxs("p",{className:"text-sm text-gray-500",children:['מס"ס: ',s.jsx("span",{dir:"ltr",children:e.serial_number}),e.license_number&&` | רישיון: ${e.license_number}`]}),e.employee_name&&s.jsxs("p",{className:"text-sm text-green-600",children:["מוקצה ל: ",e.employee_name]}),e.license_expiry&&s.jsxs("p",{className:"text-xs text-gray-400",children:["תפוגת רישיון: ",e.license_expiry]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`badge ${e.status==="assigned"?"badge-success":e.status==="maintenance"?"badge-warning":"badge-gray"}`,children:e.status==="assigned"?"מוקצה":e.status==="maintenance"?"בתחזוקה":"במחסן"}),s.jsxs("button",{onClick:()=>v({id:e.id,name:`${e.weapon_type} ${e.serial_number}`}),className:"btn-secondary text-xs px-2 py-1 flex items-center gap-1",title:"העבר",children:[s.jsx(V,{className:"w-3.5 h-3.5"}),"העבר"]}),s.jsx("button",{onClick:()=>{confirm("למחוק נשק זה?")&&I.mutate(e.id)},className:"text-red-400 hover:text-red-600 p-1",children:s.jsx(Q,{className:"w-4 h-4"})})]})]})},e.id)):s.jsx("p",{className:"text-gray-400 text-center py-8",children:"אין נשק רשום"})}):s.jsx("div",{className:"space-y-3",children:k.length>0?k.map(e=>{const n=!!e.employee_id&&!e.return_date,X={new:"חדש",good:"תקין",fair:"סביר",needs_repair:"דורש תיקון",damaged:"פגום"};return s.jsx("div",{className:"card p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${n?"bg-blue-100":"bg-gray-100"}`,children:s.jsx(L,{className:`w-6 h-6 ${n?"text-blue-600":"text-gray-600"}`})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:e.item_name}),s.jsxs("p",{className:"text-sm text-gray-500",children:[e.item_type,e.serial_number&&` | מס"ס: ${e.serial_number}`]}),n&&e.employee_name&&s.jsxs("p",{className:"text-sm text-blue-600",children:["מוקצה ל: ",e.employee_name]}),e.return_date&&s.jsxs("p",{className:"text-xs text-gray-400",children:["הוחזר: ",e.return_date]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`badge ${e.condition==="good"||e.condition==="new"?"badge-success":e.condition==="fair"?"badge-warning":"badge-danger"}`,children:X[e.condition]||e.condition}),n&&s.jsx("button",{onClick:()=>O.mutate(e.id),className:"btn-secondary text-xs px-2 py-1",children:"החזר"}),s.jsx("button",{onClick:()=>{confirm("למחוק ציוד זה?")&&z.mutate(e.id)},className:"text-red-400 hover:text-red-600 p-1",children:s.jsx(Q,{className:"w-4 h-4"})})]})]})},e.id)}):s.jsx("p",{className:"text-gray-400 text-center py-8",children:"אין ציוד רשום"})})]})}export{le as default};
