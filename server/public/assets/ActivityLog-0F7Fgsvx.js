import{h as M,r as j,d as T,i as D,j as e,C,n as S,U as Y,z as N,o as p}from"./index-vmuGjYfz.js";import{P}from"./plus-CIxyOe6u.js";import{S as L}from"./save-FVnBl6wD.js";import{M as $}from"./mail-DnwDVnw0.js";import{R as A}from"./refresh-cw-BjGTUE46.js";import{M as y}from"./message-circle-DUOvsKYn.js";import{P as _}from"./phone-qzm71CD_.js";const v={call:{label:"שיחה",icon:_,colorClass:"text-blue-600",bgClass:"bg-blue-100"},meeting:{label:"פגישה",icon:Y,colorClass:"text-purple-600",bgClass:"bg-purple-100"},proposal:{label:"הצעת מחיר",icon:S,colorClass:"text-orange-600",bgClass:"bg-orange-100"},note:{label:"הערה",icon:y,colorClass:"text-gray-600",bgClass:"bg-gray-100"},whatsapp:{label:"WhatsApp",icon:y,colorClass:"text-green-600",bgClass:"bg-green-100"},status_change:{label:"שינוי סטטוס",icon:A,colorClass:"text-yellow-600",bgClass:"bg-yellow-100"},email:{label:"אימייל",icon:$,colorClass:"text-cyan-600",bgClass:"bg-cyan-100"}},E=Object.entries(v).map(([n,{label:t}])=>({value:n,label:t}));function I(n){const t=new Date(n),a=new Date,i=a.getTime()-t.getTime(),o=Math.floor(i/6e4),c=Math.floor(i/36e5),m=Math.floor(i/864e5),r=t.toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}),g=t.getDate()===a.getDate()&&t.getMonth()===a.getMonth()&&t.getFullYear()===a.getFullYear(),l=new Date(a);l.setDate(l.getDate()-1);const d=t.getDate()===l.getDate()&&t.getMonth()===l.getMonth()&&t.getFullYear()===l.getFullYear();return o<1?"עכשיו":o<60?`לפני ${o} דקות`:g?c===1?"לפני שעה":c<4?`לפני ${c} שעות`:`היום ${r}`:d?`אתמול ${r}`:m<7?`לפני ${m} ימים`:t.toLocaleDateString("he-IL",{day:"numeric",month:"short",year:t.getFullYear()!==a.getFullYear()?"numeric":void 0})+` ${r}`}function V({entityType:n,entityId:t}){const a=M(),[i,o]=j.useState(!1),[c,m]=j.useState("call"),[r,g]=j.useState(""),l=["activities",n,t],{data:d,isLoading:b}=T({queryKey:l,queryFn:()=>(n==="lead"?p.getForLead:p.getForCustomer)(t).then(x=>x.data),enabled:!!t}),u=(d==null?void 0:d.activities)??[],f=D({mutationFn:s=>(n==="lead"?p.addToLead:p.addToCustomer)(t,s),onSuccess:()=>{a.invalidateQueries({queryKey:l}),N.success("הפעולה נוספה בהצלחה"),g(""),m("call"),o(!1)},onError:()=>{N.error("שגיאה בהוספת פעולה")}}),w=s=>{if(s.preventDefault(),!r.trim()){N.error("נא להזין תיאור");return}f.mutate({action:c,description:r.trim()})};return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"יומן פעולות"}),e.jsx("button",{onClick:()=>o(!i),className:"btn-primary text-sm flex items-center gap-1 px-3 py-1.5",children:i?e.jsx(e.Fragment,{children:"סגור"}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4"}),"הוסף פעולה"]})})]}),i&&e.jsxs("form",{onSubmit:w,className:"mb-6 p-4 bg-blue-50 rounded-lg space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג פעולה"}),e.jsx("select",{value:c,onChange:s=>m(s.target.value),className:"input",children:E.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תיאור"}),e.jsx("textarea",{value:r,onChange:s=>g(s.target.value),className:"input",rows:3,placeholder:"תאר את הפעולה..."})]}),e.jsxs("button",{type:"submit",disabled:f.isPending||!r.trim(),className:"btn-primary text-sm flex items-center gap-1",children:[e.jsx(L,{className:"w-4 h-4"}),f.isPending?"שומר...":"שמור"]})]}),b&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary-600 border-t-transparent"})}),!b&&u.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"אין פעולות עדיין"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"הוסף פעולה ראשונה כדי להתחיל לעקוב"})]}),!b&&u.length>0&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute right-[19px] top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-0",children:u.map((s,x)=>{const h=v[s.action]??{label:s.action,icon:C,colorClass:"text-gray-600",bgClass:"bg-gray-100"},F=h.icon;return e.jsxs("div",{className:"relative flex gap-4 pb-6",children:[e.jsx("div",{className:`relative z-10 flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${h.bgClass}`,children:e.jsx(F,{className:`w-5 h-5 ${h.colorClass}`})}),e.jsxs("div",{className:"flex-1 pt-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:h.label}),e.jsx("span",{className:"text-xs text-gray-400",children:I(s.created_at)})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-700 mt-1 whitespace-pre-wrap",children:s.description}),s.user_name&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s.user_name})]}),x===u.length-1&&e.jsx("div",{className:"absolute right-[19px] bottom-0 h-6 w-0.5 bg-white"})]},s.id)})})]})]})}export{V as A};
