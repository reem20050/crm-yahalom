import{r as N,c as k,e as C,d as y,m as P,j as e,w as T,q,B as z,U as A,al as B,X as M,z as d,am as u}from"./index-DNhSfFTF.js";import{u as E}from"./index.esm-CTjlG80w.js";import{t as F,o as Q,s as r,n as h,l as K}from"./types-C-QvhzS9.js";import{S as $,d as L}from"./Skeleton-B57jvd7z.js";import{P as O}from"./plus-42YS-w1A.js";import{P as R}from"./phone-C6GpoGt1.js";import{T as U}from"./trash-2-C8JFUyr_.js";import{S as G}from"./star-Bi8HfDq8.js";const I=Q({company_name:r().min(1,"נדרש שם חברה"),contact_name:r().min(1,"נדרש שם איש קשר"),phone:r().optional(),email:r().email("אימייל לא תקין").optional().or(K("")),specialization:r().optional(),hourly_rate:h().optional(),daily_rate:h().optional(),max_workers:h().optional(),notes:r().optional()});function V({rating:t}){return e.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(c=>e.jsx(G,{className:`w-3.5 h-3.5 ${c<=t?"text-yellow-400 fill-yellow-400":"text-gray-200"}`},c))})}function X(t){switch(t){case"active":return{class:"badge-success",label:"פעיל"};case"inactive":return{class:"badge-gray",label:"לא פעיל"};case"blacklisted":return{class:"badge-danger",label:"חסום"};default:return{class:"badge-gray",label:t||"לא ידוע"}}}function ae(){var g;const[t,c]=N.useState(""),[f,n]=N.useState(!1),j=k(),{data:m,isLoading:v}=C({queryKey:["contractors",{search:t}],queryFn:()=>u.getAll({search:t,limit:50}).then(s=>s.data)}),o=y({mutationFn:s=>u.create(s),onSuccess:()=>{j.invalidateQueries({queryKey:["contractors"]}),d.success("קבלן נוצר בהצלחה"),n(!1),x()},onError:s=>{var i,b;d.error(((b=(i=s.response)==null?void 0:i.data)==null?void 0:b.error)||"שגיאה ביצירת קבלן")}}),w=y({mutationFn:s=>u.delete(s),onSuccess:()=>{j.invalidateQueries({queryKey:["contractors"]}),d.success("קבלן נמחק בהצלחה")},onError:()=>{d.error("שגיאה במחיקת קבלן")}}),{register:a,handleSubmit:S,reset:x,formState:{errors:l}}=E({resolver:F(I),defaultValues:{max_workers:10}}),{can:p}=P(),_=s=>{o.mutate(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"קבלנים"}),e.jsx("p",{className:"page-subtitle",children:"ניהול קבלנים וספקי כוח אדם"})]}),p("contractors:create")&&e.jsxs("button",{onClick:()=>n(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"קבלן חדש"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש קבלנים...",value:t,onChange:s=>c(s.target.value),className:"input pr-11"})]}),v?e.jsxs("div",{className:"space-y-6",children:[e.jsx($,{className:"h-10 w-full rounded-xl"}),e.jsx(L,{count:6})]}):((g=m==null?void 0:m.contractors)==null?void 0:g.length)>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:m.contractors.map(s=>{const i=X(s.status);return e.jsx("div",{className:"card hover:shadow-card-hover hover:-translate-y-0.5 transition-all duration-300",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsxs(q,{to:`/contractors/${s.id}`,className:"flex items-start gap-3.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-11 h-11 bg-gradient-to-br from-primary-100 to-primary-50 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(z,{className:"w-5 h-5 text-primary-700"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading font-semibold text-gray-900 text-sm truncate",children:s.company_name}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:s.contact_name}),s.phone&&e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1.5 mt-1",children:[e.jsx(R,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{dir:"ltr",children:s.phone})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-1.5 mt-2",children:[e.jsx("span",{className:`badge ${i.class}`,children:i.label}),s.specialization&&e.jsx("span",{className:"badge badge-info",children:s.specialization}),e.jsxs("span",{className:"badge badge-gray flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"}),s.workers_count||0]})]}),s.rating>0&&e.jsx("div",{className:"mt-2",children:e.jsx(V,{rating:s.rating})})]})]}),p("contractors:delete")&&e.jsx("button",{onClick:()=>{confirm("האם אתה בטוח שברצונך למחוק קבלן זה?")&&w.mutate(s.id)},className:"p-1.5 rounded-lg text-gray-300 hover:text-danger-500 hover:bg-danger-50 transition-colors",title:"מחק",children:e.jsx(U,{className:"w-4 h-4"})})]})},s.id)})}):e.jsxs("div",{className:"card text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gray-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(B,{className:"w-7 h-7 text-gray-400"})}),e.jsx("p",{className:"text-gray-500 font-medium mb-1",children:"אין קבלנים"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"הוסף קבלן חדש כדי להתחיל לנהל את הספקים"}),p("contractors:create")&&e.jsx("button",{onClick:()=>n(!0),className:"btn-primary",children:"הוסף קבלן ראשון"})]}),f&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-content max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"קבלן חדש"}),e.jsx("button",{onClick:()=>{n(!1),x()},className:"p-2 hover:bg-gray-100 rounded-xl text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(M,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:S(_),className:"p-6 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם חברה *"}),e.jsx("input",{...a("company_name"),className:"input"}),l.company_name&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.company_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"איש קשר *"}),e.jsx("input",{...a("contact_name"),className:"input"}),l.contact_name&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.contact_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון"}),e.jsx("input",{...a("phone"),className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אימייל"}),e.jsx("input",{...a("email"),type:"email",className:"input",dir:"ltr"}),l.email&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תחום התמחות"}),e.jsx("input",{...a("specialization"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מקסימום עובדים"}),e.jsx("input",{...a("max_workers",{valueAsNumber:!0}),type:"number",className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תעריף שעתי (₪)"}),e.jsx("input",{...a("hourly_rate",{valueAsNumber:!0}),type:"number",step:"0.01",className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תעריף יומי (₪)"}),e.jsx("input",{...a("daily_rate",{valueAsNumber:!0}),type:"number",step:"0.01",className:"input",dir:"ltr"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2",children:[e.jsx("label",{className:"label",children:"הערות"}),e.jsx("textarea",{...a("notes"),className:"input",rows:3})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-100",children:[e.jsx("button",{type:"submit",disabled:o.isPending,className:"btn-primary flex-1",children:o.isPending?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"שומר..."]}):"שמור"}),e.jsx("button",{type:"button",onClick:()=>{n(!1),x()},className:"btn-secondary",children:"ביטול"})]})]})]})})]})}export{ae as default};
