import{r as g,c as T,e as P,d as N,m as q,j as e,w as E,q as M,S as A,I as F,X as I,z as d,J as p}from"./index-DNhSfFTF.js";import{u as Q}from"./index.esm-CTjlG80w.js";import{t as U,o as K,s as r,b as h,n as O,l as $}from"./types-C-QvhzS9.js";import{S as z,d as L}from"./Skeleton-B57jvd7z.js";import{a as D}from"./WhatsAppButton-CMz-ehNn.js";import{P as G}from"./plus-42YS-w1A.js";import{P as J}from"./phone-C6GpoGt1.js";import{T as R}from"./trash-2-C8JFUyr_.js";import{U as V}from"./user-plus-F5Fn6_3p.js";import"./message-circle-CWw4z9y6.js";import"./external-link-BplGfNjn.js";const W=K({first_name:r().min(1,"נדרש שם פרטי"),last_name:r().min(1,"נדרש שם משפחה"),id_number:r().min(1,"נדרש מספר ת.ז"),phone:r().min(1,"נדרש מספר טלפון"),email:r().email("אימייל לא תקין").optional().or($("")),address:r().optional(),city:r().optional(),hire_date:r().min(1,"נדרש תאריך תחילת עבודה"),employment_type:r().optional(),hourly_rate:O().optional(),has_weapon_license:h().optional(),has_driving_license:h().optional(),driving_license_type:r().optional(),emergency_contact_name:r().optional(),emergency_contact_phone:r().optional(),create_user_account:h().optional(),user_password:r().optional(),user_role:r().optional()});function ie(){var b;const[o,y]=g.useState(""),[f,n]=g.useState(!1),u=T(),{data:c,isLoading:v}=P({queryKey:["employees",{search:o}],queryFn:()=>p.getAll({search:o,limit:50}).then(s=>s.data)}),m=N({mutationFn:s=>p.create(s),onSuccess:s=>{var t;u.invalidateQueries({queryKey:["employees"]});const i=(t=s.data)!=null&&t.user_created?"עובד נוצר בהצלחה + חשבון משתמש נוצר":"עובד נוצר בהצלחה";d.success(i),n(!1),x()},onError:s=>{var i,t;d.error(((t=(i=s.response)==null?void 0:i.data)==null?void 0:t.error)||"שגיאה ביצירת עובד")}}),_=N({mutationFn:s=>p.delete(s),onSuccess:()=>{u.invalidateQueries({queryKey:["employees"]}),d.success("נמחק בהצלחה")},onError:()=>{d.error("שגיאה במחיקה")}}),{register:a,handleSubmit:w,reset:x,watch:S,formState:{errors:l}}=Q({resolver:U(W),defaultValues:{hire_date:new Date().toISOString().split("T")[0],employment_type:"hourly",has_weapon_license:!1,has_driving_license:!1,create_user_account:!1,user_role:"employee"}}),k=S("create_user_account"),{can:j}=q(),C=s=>{m.mutate(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"עובדים"}),e.jsx("p",{className:"page-subtitle",children:"ניהול עובדים ומסמכים"})]}),j("employees:create")&&e.jsxs("button",{onClick:()=>n(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"עובד חדש"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש עובדים...",value:o,onChange:s=>y(s.target.value),className:"input pr-11"})]}),v?e.jsxs("div",{className:"space-y-6",children:[e.jsx(z,{className:"h-10 w-full rounded-xl"}),e.jsx(L,{count:6})]}):((b=c==null?void 0:c.employees)==null?void 0:b.length)>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.employees.map(s=>{var i,t;return e.jsx("div",{className:"card hover:shadow-card-hover hover:-translate-y-0.5 transition-all duration-300",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsxs(M,{to:`/employees/${s.id}`,className:"flex items-start gap-3.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-11 h-11 bg-gradient-to-br from-primary-100 to-primary-50 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsxs("span",{className:"text-primary-700 font-semibold text-sm",children:[(i=s.first_name)==null?void 0:i[0],(t=s.last_name)==null?void 0:t[0]]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"font-heading font-semibold text-gray-900 text-sm",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1.5 mt-1",children:[e.jsx(J,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{dir:"ltr",children:s.phone}),e.jsx(D,{phone:s.phone,message:`שלום ${s.first_name}, 

צוות יהלום`})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-2",children:[e.jsx("span",{className:`badge ${s.status==="active"?"badge-success":"badge-gray"}`,children:s.status==="active"?"פעיל":"לא פעיל"}),s.has_weapon_license&&e.jsxs("span",{className:"badge badge-info flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"}),"נשק"]})]})]})]}),j("employees:delete")&&e.jsx("button",{onClick:()=>{confirm("האם אתה בטוח שברצונך למחוק עובד זה?")&&_.mutate(s.id)},className:"p-1.5 rounded-lg text-gray-300 hover:text-danger-500 hover:bg-danger-50 transition-colors",title:"מחק",children:e.jsx(R,{className:"w-4 h-4"})})]})},s.id)})}):e.jsxs("div",{className:"card text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gray-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(F,{className:"w-7 h-7 text-gray-400"})}),e.jsx("p",{className:"text-gray-500 font-medium mb-1",children:"לא נמצאו עובדים"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"הוסף עובד חדש כדי להתחיל לנהל את הצוות"}),e.jsx("button",{onClick:()=>n(!0),className:"btn-primary",children:"הוסף עובד ראשון"})]}),f&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-content max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"עובד חדש"}),e.jsx("button",{onClick:()=>{n(!1),x()},className:"p-2 hover:bg-gray-100 rounded-xl text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(I,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:w(C),className:"p-6 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם פרטי *"}),e.jsx("input",{...a("first_name"),className:"input"}),l.first_name&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.first_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם משפחה *"}),e.jsx("input",{...a("last_name"),className:"input"}),l.last_name&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.last_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"ת.ז *"}),e.jsx("input",{...a("id_number"),className:"input",dir:"ltr"}),l.id_number&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.id_number.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון *"}),e.jsx("input",{...a("phone"),className:"input",dir:"ltr"}),l.phone&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אימייל"}),e.jsx("input",{...a("email"),type:"email",className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תאריך תחילת עבודה *"}),e.jsx("input",{...a("hire_date"),type:"date",className:"input"}),l.hire_date&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.hire_date.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"כתובת"}),e.jsx("input",{...a("address"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"עיר"}),e.jsx("input",{...a("city"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג העסקה"}),e.jsxs("select",{...a("employment_type"),className:"input",children:[e.jsx("option",{value:"hourly",children:"שעתי"}),e.jsx("option",{value:"monthly",children:"חודשי"}),e.jsx("option",{value:"contractor",children:"קבלן"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שכר שעתי"}),e.jsx("input",{...a("hourly_rate",{valueAsNumber:!0}),type:"number",step:"0.01",className:"input",dir:"ltr"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 border-t border-gray-100 pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"רישיונות"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{...a("has_weapon_license"),type:"checkbox",className:"w-4 h-4 text-primary-600 rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700",children:"רישיון נשק"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{...a("has_driving_license"),type:"checkbox",className:"w-4 h-4 text-primary-600 rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700",children:"רישיון נהיגה"})]})]})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 border-t border-gray-100 pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"איש קשר לחירום"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם"}),e.jsx("input",{...a("emergency_contact_name"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון"}),e.jsx("input",{...a("emergency_contact_phone"),className:"input",dir:"ltr"})]})]})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 border-t border-gray-100 pt-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-3",children:[e.jsx("input",{...a("create_user_account"),type:"checkbox",className:"w-4 h-4 text-primary-600 rounded border-gray-300"}),e.jsx(V,{className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"צור חשבון משתמש לעובד"})]}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"מאפשר לעובד להתחבר למערכת ולבצע צ'ק-אין עצמאי. נדרש אימייל."}),k&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 p-3 bg-primary-50/50 rounded-xl border border-primary-100",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סיסמה למשתמש *"}),e.jsx("input",{...a("user_password"),type:"password",className:"input",dir:"ltr",placeholder:"לפחות 6 תווים"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תפקיד"}),e.jsxs("select",{...a("user_role"),className:"input",children:[e.jsx("option",{value:"employee",children:"עובד"}),e.jsx("option",{value:"manager",children:"מנהל משמרות"}),e.jsx("option",{value:"admin",children:"מנהל"})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-100",children:[e.jsx("button",{type:"submit",disabled:m.isPending,className:"btn-primary flex-1",children:m.isPending?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"שומר..."]}):"שמור"}),e.jsx("button",{type:"button",onClick:()=>{n(!1),x()},className:"btn-secondary",children:"ביטול"})]})]})]})})]})}export{ie as default};
