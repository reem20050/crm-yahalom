import{u as te,r as p,f as I,j as e,P as L,g as $,$ as se,a1 as ae,s as re}from"./index-ByDqAFDZ.js";import{C as ne,a as le}from"./chevron-right-CKDR5AtT.js";import{S as A}from"./shield-BrNbB9xY.js";import{E as oe}from"./external-link-XrOfjeQI.js";const ce=["专","驻专专","专抓","驻专","","","","住","住驻专","拽专","专","爪专"],ie=["专砖","砖","砖砖","专注","砖","砖砖","砖转"],R=3;function de(l,n){const d=new Date(l,n,1),x=new Date(l,n+1,0),g=d.getDay(),i=[];for(let r=g-1;r>=0;r--){const m=new Date(l,n,-r);i.push({date:m,isCurrentMonth:!1})}for(let r=1;r<=x.getDate();r++)i.push({date:new Date(l,n,r),isCurrentMonth:!0});const a=7-i.length%7;if(a<7)for(let r=1;r<=a;r++){const m=new Date(l,n+1,r);i.push({date:m,isCurrentMonth:!1})}return i}function _(l){const n=l.getFullYear(),d=String(l.getMonth()+1).padStart(2,"0"),x=String(l.getDate()).padStart(2,"0");return`${n}-${d}-${x}`}function xe(l,n){const d=new Date(l,n,1),x=new Date(l,n+1,0);return{start_date:_(d),end_date:_(x)}}function fe(){const l=te(),n=new Date,[d,x]=p.useState(n.getFullYear()),[g,i]=p.useState(n.getMonth()),[a,r]=p.useState("all"),[m,ge]=p.useState(!0),{start_date:f,end_date:b}=xe(d,g),{data:k,isLoading:W}=I({queryKey:["calendar-shifts",f,b],queryFn:()=>se.getAll({start_date:f,end_date:b}).then(t=>t.data)}),{data:E,isLoading:O}=I({queryKey:["calendar-events",f,b],queryFn:()=>ae.getAll({start_date:f,end_date:b}).then(t=>t.data)}),{data:y}=I({queryKey:["google-calendar-events",f,b],queryFn:()=>re.getGoogleCalendarEvents(f,b).then(t=>t.data),retry:!1}),F=W||O,S=(k==null?void 0:k.shifts)??[],D=(E==null?void 0:E.events)??[],C=(y==null?void 0:y.events)??[],N=(y==null?void 0:y.connected)??!1,P=p.useMemo(()=>{const t={};for(const s of S){const o=s.date;t[o]||(t[o]=[]),t[o].push(s)}return t},[S]),q=p.useMemo(()=>{const t={};for(const s of D){const o=s.event_date;t[o]||(t[o]=[]),t[o].push(s)}return t},[D]),B=p.useMemo(()=>{const t={};for(const s of C){const o=s.start_date;t[o]||(t[o]=[]),t[o].push(s)}return t},[C]),H=p.useMemo(()=>de(d,g),[d,g]),K=_(n),Q=()=>{g===0?(i(11),x(t=>t-1)):i(t=>t-1)},V=()=>{g===11?(i(0),x(t=>t+1)):i(t=>t+1)},X=()=>{x(n.getFullYear()),i(n.getMonth())},z=t=>e.jsxs("button",{onClick:s=>{s.stopPropagation(),l("/shifts")},className:"w-full text-right rounded px-1.5 py-0.5 text-[11px] leading-tight bg-blue-50 text-blue-800 border border-blue-200 hover:bg-blue-100 transition-colors cursor-pointer truncate flex items-center gap-1",title:`${t.start_time} - ${t.end_time} | ${t.site_name||t.customer_name||"砖专转"}`,children:[e.jsx(A,{className:"w-3 h-3 flex-shrink-0 text-blue-500"}),e.jsxs("span",{className:"truncate",children:[t.start_time," ",t.site_name||t.customer_name||"砖专转"]})]},`shift-${t.id}`),J=t=>e.jsxs("button",{onClick:s=>{s.stopPropagation(),l(`/events/${t.id}`)},className:"w-full text-right rounded px-1.5 py-0.5 text-[11px] leading-tight bg-emerald-50 text-emerald-800 border border-emerald-200 hover:bg-emerald-100 transition-colors cursor-pointer truncate flex items-center gap-1",title:`${t.start_time} - ${t.end_time} | ${t.event_name} | ${t.location}`,children:[e.jsx(L,{className:"w-3 h-3 flex-shrink-0 text-emerald-500"}),e.jsxs("span",{className:"truncate",children:[t.start_time," ",t.event_name]})]},`event-${t.id}`),U=t=>e.jsxs("a",{href:t.html_link,target:"_blank",rel:"noopener noreferrer",className:"w-full text-right rounded px-1.5 py-0.5 text-[11px] leading-tight bg-purple-50 text-purple-800 border border-purple-200 hover:bg-purple-100 transition-colors cursor-pointer truncate flex items-center gap-1",title:`${t.start_time?t.start_time+" - "+t.end_time+" | ":"  | "}${t.title}${t.location?" | "+t.location:""}`,onClick:s=>s.stopPropagation(),children:[e.jsx($,{className:"w-3 h-3 flex-shrink-0 text-purple-500"}),e.jsxs("span",{className:"truncate",children:[t.all_day?"":t.start_time," ",t.title]}),e.jsx(oe,{className:"w-2.5 h-2.5 flex-shrink-0 text-purple-400"})]},`google-${t.id}`),Z=t=>{const s=P[t]||[],o=q[t]||[],h=B[t]||[];let c=[];(a==="all"||a==="shifts")&&(c=c.concat(s.map(z))),(a==="all"||a==="events")&&(c=c.concat(o.map(J))),(a==="all"||a==="google")&&m&&(c=c.concat(h.map(U)));const Y=c.length,j=c.slice(0,R),u=Y-R;return e.jsxs("div",{className:"flex flex-col gap-0.5 mt-1",children:[j,u>0&&e.jsxs("span",{className:"text-[10px] text-gray-400 text-center",children:["+",u," 住驻"]})]})},M=S.length,G=D.length,T=C.length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:" 砖"}),e.jsx("p",{className:"text-gray-500",children:"转爪 砖转 砖 砖专转 专注"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-blue-100 border border-blue-300"}),"砖专转 (",M,")"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-emerald-100 border border-emerald-300"}),"专注 (",G,")"]}),N&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-purple-100 border border-purple-300"}),"Google (",T,")"]})]})})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:Q,className:"btn-secondary p-2","aria-label":"砖 拽",children:e.jsx(ne,{className:"w-5 h-5"})}),e.jsxs("h2",{className:"text-lg font-semibold min-w-[160px] text-center",children:[ce[g]," ",d]}),e.jsx("button",{onClick:V,className:"btn-secondary p-2","aria-label":"砖 ",children:e.jsx(le,{className:"w-5 h-5"})}),e.jsx("button",{onClick:X,className:"btn-secondary text-sm px-3 py-1.5",children:""})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r("all"),className:`text-sm px-3 py-1.5 rounded-lg transition-colors ${a==="all"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:""}),e.jsxs("button",{onClick:()=>r("shifts"),className:`text-sm px-3 py-1.5 rounded-lg transition-colors flex items-center gap-1 ${a==="shifts"?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(A,{className:"w-3.5 h-3.5"}),"砖专转"]}),e.jsxs("button",{onClick:()=>r("events"),className:`text-sm px-3 py-1.5 rounded-lg transition-colors flex items-center gap-1 ${a==="events"?"bg-emerald-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(L,{className:"w-3.5 h-3.5"}),"专注"]}),N&&e.jsxs("button",{onClick:()=>{r(a==="google"?"all":"google")},className:`text-sm px-3 py-1.5 rounded-lg transition-colors flex items-center gap-1 ${a==="google"?"bg-purple-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx($,{className:"w-3.5 h-3.5"}),"Google"]})]})]})}),F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-2 border-primary-600 border-t-transparent"})}):e.jsxs("div",{className:"card p-0 overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-7 border-b bg-gray-50",children:ie.map((t,s)=>e.jsx("div",{className:`py-3 text-center text-sm font-semibold text-gray-600 ${s<6?"border-l border-gray-200":""} ${s===6?"text-red-500":""}`,children:t},t))}),e.jsx("div",{className:"grid grid-cols-7",children:H.map(({date:t,isCurrentMonth:s},o)=>{const h=_(t),c=h===K,j=t.getDay()===6,u=P[h]||[],v=q[h]||[],w=B[h]||[],ee=a==="all"&&(u.length>0||v.length>0||m&&w.length>0)||a==="shifts"&&u.length>0||a==="events"&&v.length>0||a==="google"&&w.length>0;return e.jsxs("div",{className:`
                    min-h-[120px] p-1.5 border-b border-l border-gray-200
                    transition-colors
                    ${s?"bg-white":"bg-gray-50"}
                    ${c?"bg-primary-50 ring-2 ring-inset ring-primary-400":""}
                    ${j&&s?"bg-red-50/30":""}
                    ${ee?"hover:bg-gray-50":""}
                  `,children:[e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsx("span",{className:`
                        text-sm font-medium w-7 h-7 flex items-center justify-center rounded-full
                        ${c?"bg-primary-500 text-white":""}
                        ${s?"":"text-gray-300"}
                        ${s&&!c&&j?"text-red-400":""}
                        ${s&&!c&&!j?"text-gray-700":""}
                      `,children:t.getDate()}),s&&(u.length>0||v.length>0||w.length>0)&&e.jsxs("div",{className:"flex items-center gap-0.5",children:[u.length>0&&(a==="all"||a==="shifts")&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-400"}),v.length>0&&(a==="all"||a==="events")&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-400"}),w.length>0&&m&&(a==="all"||a==="google")&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-purple-400"})]})]}),s&&Z(h)]},`${h}-${o}`)})})]}),!F&&e.jsxs("div",{className:`grid grid-cols-1 ${N?"md:grid-cols-4":"md:grid-cols-3"} gap-4`,children:[e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(A,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:M}),e.jsx("p",{className:"text-sm text-gray-500",children:"砖专转 砖"})]})]}),e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"w-6 h-6 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:G}),e.jsx("p",{className:"text-sm text-gray-500",children:"专注 砖"})]})]}),N&&e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx($,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:T}),e.jsx("p",{className:"text-sm text-gray-500",children:"专注 Google"})]})]}),e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx($,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:M+G+(m?T:0)}),e.jsx("p",{className:"text-sm text-gray-500",children:'住" 驻专'})]})]})]})]})}export{fe as default};
