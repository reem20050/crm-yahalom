import{c as P,g as L,r as i,d as U,h as p,j as e,X as C,a6 as d}from"./index-DVPKYaqZ.js";import{P as K}from"./plus-BMlu7TrJ.js";import{S as Q}from"./shield-BAUQc-9_.js";import{P as z}from"./pencil-D2PURvPY.js";import{K as D}from"./key-round-D4Q5zA7V.js";/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=P("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.302.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=P("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),w={email:"",password:"",first_name:"",last_name:"",phone:"",role:"employee"},R={admin:"מנהל",manager:"מנהל משמרות",employee:"עובד"},X={admin:"bg-purple-100 text-purple-800",manager:"bg-blue-100 text-blue-800",employee:"bg-gray-100 text-gray-800"};function T(){const h=L(),[S,u]=i.useState(!1),[c,g]=i.useState(null),[t,n]=i.useState(w),[y,o]=i.useState(null),[j,b]=i.useState(""),[x,l]=i.useState(""),{data:_=[],isLoading:q}=U({queryKey:["users"],queryFn:async()=>(await d.getAll()).data}),N=p({mutationFn:s=>d.create(s),onSuccess:()=>{h.invalidateQueries({queryKey:["users"]}),m()},onError:s=>{var a,r;l(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"שגיאה ביצירת משתמש")}}),v=p({mutationFn:({id:s,data:a})=>d.update(s,a),onSuccess:()=>{h.invalidateQueries({queryKey:["users"]}),m()},onError:s=>{var a,r;l(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"שגיאה בעדכון משתמש")}}),k=p({mutationFn:({id:s,is_active:a})=>d.update(s,{is_active:a}),onSuccess:()=>{h.invalidateQueries({queryKey:["users"]})}}),f=p({mutationFn:({id:s,password:a})=>d.resetPassword(s,a),onSuccess:()=>{o(null),b("")},onError:s=>{var a,r;l(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"שגיאה באיפוס סיסמה")}}),m=()=>{u(!1),g(null),n(w),l("")},M=()=>{n(w),g(null),l(""),u(!0)},E=s=>{g(s),n({email:s.email,password:"",first_name:s.first_name,last_name:s.last_name,phone:s.phone||"",role:s.role}),l(""),u(!0)},F=s=>{if(s.preventDefault(),l(""),c){const a={first_name:t.first_name,last_name:t.last_name,phone:t.phone,role:t.role,email:t.email};v.mutate({id:c.id,data:a})}else{if(!t.password){l("נא להזין סיסמה");return}N.mutate({...t})}},G=s=>s?new Date(s).toLocaleDateString("he-IL",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-";return q?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ניהול משתמשים"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"ניהול חשבונות משתמשים והרשאות גישה למערכת"})]}),e.jsxs("button",{onClick:M,className:"btn-primary flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"הוסף משתמש"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(Q,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"אבטחת Google:"})," התחברות עם Google זמינה רק למשתמשים שכתובת ה-Gmail שלהם רשומה במערכת. כדי לאפשר למישהו להתחבר עם Google, הוסף אותו כמשתמש עם כתובת ה-Gmail שלו."]})]}),e.jsx("div",{className:"card overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"שם"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"אימייל"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"טלפון"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"תפקיד"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"סטטוס"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"התחברות אחרונה"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"פעולות"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[_.map(s=>{var a,r;return e.jsxs("tr",{className:s.is_active?"":"bg-gray-50 opacity-60",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-700 font-medium text-sm",children:[(a=s.first_name)==null?void 0:a[0],(r=s.last_name)==null?void 0:r[0]]}),e.jsxs("span",{className:"font-medium text-gray-900",children:[s.first_name," ",s.last_name]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 direction-ltr text-right",children:s.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:s.phone||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium ${X[s.role]||"bg-gray-100 text-gray-800"}`,children:R[s.role]||s.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.is_active?e.jsx("span",{className:"badge-success",children:"פעיל"}):e.jsx("span",{className:"badge-danger",children:"מושבת"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:G(s.last_login)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>E(s),className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded",title:"ערוך",children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{o({userId:s.id,userName:`${s.first_name} ${s.last_name}`}),b(""),l("")},className:"p-1.5 text-gray-400 hover:text-orange-600 hover:bg-orange-50 rounded",title:"איפוס סיסמה",children:e.jsx(D,{className:"h-4 w-4"})}),s.is_active?e.jsx("button",{onClick:()=>k.mutate({id:s.id,is_active:0}),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded",title:"השבת משתמש",children:e.jsx(A,{className:"h-4 w-4"})}):e.jsx("button",{onClick:()=>k.mutate({id:s.id,is_active:1}),className:"p-1.5 text-gray-400 hover:text-green-600 hover:bg-green-50 rounded",title:"הפעל משתמש",children:e.jsx(I,{className:"h-4 w-4"})})]})})]},s.id)}),_.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-12 text-center text-gray-500",children:"אין משתמשים במערכת"})})]})]})})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-lg font-bold",children:c?"עריכת משתמש":"הוספת משתמש חדש"}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600",children:e.jsx(C,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:F,className:"p-6 space-y-4",children:[x&&e.jsx("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg text-sm",children:x}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם פרטי *"}),e.jsx("input",{type:"text",className:"input",value:t.first_name,onChange:s=>n({...t,first_name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם משפחה *"}),e.jsx("input",{type:"text",className:"input",value:t.last_name,onChange:s=>n({...t,last_name:s.target.value}),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אימייל *"}),e.jsx("input",{type:"email",className:"input",dir:"ltr",value:t.email,onChange:s=>n({...t,email:s.target.value}),required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"אם הכתובת היא Gmail, המשתמש יוכל גם להתחבר עם Google"})]}),!c&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סיסמה *"}),e.jsx("input",{type:"password",className:"input",dir:"ltr",value:t.password,onChange:s=>n({...t,password:s.target.value}),minLength:6,placeholder:"לפחות 6 תווים",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון"}),e.jsx("input",{type:"tel",className:"input",dir:"ltr",value:t.phone,onChange:s=>n({...t,phone:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תפקיד *"}),e.jsxs("select",{className:"input",value:t.role,onChange:s=>n({...t,role:s.target.value}),children:[e.jsx("option",{value:"employee",children:"עובד"}),e.jsx("option",{value:"manager",children:"מנהל משמרות"}),e.jsx("option",{value:"admin",children:"מנהל"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:N.isPending||v.isPending,children:N.isPending||v.isPending?"שומר...":c?"עדכן":"צור משתמש"}),e.jsx("button",{type:"button",onClick:m,className:"btn-secondary",children:"ביטול"})]})]})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-lg font-bold",children:"איפוס סיסמה"}),e.jsx("button",{onClick:()=>{o(null),l("")},className:"text-gray-400 hover:text-gray-600",children:e.jsx(C,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[x&&e.jsx("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg text-sm",children:x}),e.jsxs("p",{className:"text-gray-600",children:["איפוס סיסמה עבור ",e.jsx("strong",{children:y.userName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סיסמה חדשה"}),e.jsx("input",{type:"password",className:"input",dir:"ltr",value:j,onChange:s=>b(s.target.value),minLength:6,placeholder:"לפחות 6 תווים"})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx("button",{onClick:()=>{if(j.length<6){l("הסיסמה חייבת להכיל לפחות 6 תווים");return}l(""),f.mutate({id:y.userId,password:j})},className:"btn-primary flex-1",disabled:f.isPending,children:f.isPending?"מאפס...":"אפס סיסמה"}),e.jsx("button",{onClick:()=>{o(null),l("")},className:"btn-secondary",children:"ביטול"})]})]})]})})]})}export{T as default};
