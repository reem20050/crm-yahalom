import{r as n,h as y,j as e,X as N,D as E,z as f,E as k}from"./index-DVPKYaqZ.js";import{M as x}from"./message-circle-DlpaFzPM.js";import{S}from"./send-DzsuVkbT.js";import{E as W}from"./external-link-ClpMtne6.js";function p(a){return a.replace(/[\s\-+]/g,"")}function M({phone:a,name:g,size:d="md"}){const[t,r]=n.useState(!1),[o,u]=n.useState(""),i=n.useRef(null),m=n.useRef(null),l=y({mutationFn:()=>k.sendWhatsApp(p(a),o),onSuccess:()=>{f.success("ההודעה נשלחה בהצלחה"),u(""),r(!1)},onError:()=>{f.error("שגיאה בשליחת ההודעה")}});n.useEffect(()=>{t&&setTimeout(()=>{var s;return(s=m.current)==null?void 0:s.focus()},50)},[t]),n.useEffect(()=>{if(!t)return;const s=v=>{i.current&&!i.current.contains(v.target)&&r(!1)},c=setTimeout(()=>{document.addEventListener("mousedown",s)},0);return()=>{clearTimeout(c),document.removeEventListener("mousedown",s)}},[t]),n.useEffect(()=>{if(!t)return;const s=c=>{c.key==="Escape"&&r(!1)};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[t]);const h=()=>{o.trim()&&l.mutate()},b=()=>{const s=p(a);window.open(`https://wa.me/${s}`,"_blank")},j=d==="sm"?"w-4 h-4":"w-5 h-5",w=d==="sm"?"w-8 h-8":"w-10 h-10";return e.jsxs("div",{className:"relative inline-block",ref:i,children:[e.jsx("button",{onClick:()=>r(!t),title:"שלח הודעת WhatsApp",className:`${w} flex items-center justify-center rounded-lg bg-green-50 text-green-600 hover:bg-green-100 hover:text-green-700 transition-colors`,children:e.jsx(x,{className:j})}),t&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 w-80 bg-white rounded-xl shadow-2xl border border-gray-200 z-50 overflow-hidden",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-green-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4 text-green-600"}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-900",children:["שלח הודעה ל-",g]})]}),e.jsx("button",{onClick:()=>r(!1),className:"p-1 rounded-lg hover:bg-green-100 transition-colors",children:e.jsx(N,{className:"w-4 h-4 text-gray-400"})})]}),e.jsx("div",{className:"p-4",children:e.jsx("textarea",{ref:m,value:o,onChange:s=>u(s.target.value),placeholder:"כתוב הודעה...",rows:4,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent placeholder-gray-400",dir:"rtl"})}),e.jsxs("div",{className:"flex items-center gap-2 px-4 pb-4",children:[e.jsxs("button",{onClick:h,disabled:l.isPending||!o.trim(),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[l.isPending?e.jsx(E,{className:"w-4 h-4 animate-spin"}):e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:"שלח"})]}),e.jsxs("button",{onClick:b,className:"flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{children:"פתח ב-WhatsApp Web"})]})]})]})]})}export{M as W};
