import{u as Q,r as u,e as I,j as e,P as _,C as V,T as X,W as z}from"./index-BGOlPzIM.js";import{C as G,a as J}from"./chevron-right-B1kwH_PQ.js";import{S as k}from"./shield-C9G2romd.js";const U=["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],Z=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],L=3;function ee(r,n){const d=new Date(r,n,1),x=new Date(r,n+1,0),m=d.getDay(),i=[];for(let l=m-1;l>=0;l--){const g=new Date(r,n,-l);i.push({date:g,isCurrentMonth:!1})}for(let l=1;l<=x.getDate();l++)i.push({date:new Date(r,n,l),isCurrentMonth:!0});const a=7-i.length%7;if(a<7)for(let l=1;l<=a;l++){const g=new Date(r,n+1,l);i.push({date:g,isCurrentMonth:!1})}return i}function j(r){const n=r.getFullYear(),d=String(r.getMonth()+1).padStart(2,"0"),x=String(r.getDate()).padStart(2,"0");return`${n}-${d}-${x}`}function te(r,n){const d=new Date(r,n,1),x=new Date(r,n+1,0);return{start_date:j(d),end_date:j(x)}}function re(){const r=Q(),n=new Date,[d,x]=u.useState(n.getFullYear()),[m,i]=u.useState(n.getMonth()),[a,l]=u.useState("all"),{start_date:g,end_date:f}=te(d,m),{data:N,isLoading:A}=I({queryKey:["calendar-shifts",g,f],queryFn:()=>X.getAll({start_date:g,end_date:f}).then(t=>t.data)}),{data:v,isLoading:F}=I({queryKey:["calendar-events",g,f],queryFn:()=>z.getAll({start_date:g,end_date:f}).then(t=>t.data)}),C=A||F,w=(N==null?void 0:N.shifts)??[],$=(v==null?void 0:v.events)??[],M=u.useMemo(()=>{const t={};for(const s of w){const o=s.date;t[o]||(t[o]=[]),t[o].push(s)}return t},[w]),E=u.useMemo(()=>{const t={};for(const s of $){const o=s.event_date;t[o]||(t[o]=[]),t[o].push(s)}return t},[$]),P=u.useMemo(()=>ee(d,m),[d,m]),W=j(n),Y=()=>{m===0?(i(11),x(t=>t-1)):i(t=>t-1)},B=()=>{m===11?(i(0),x(t=>t+1)):i(t=>t+1)},R=()=>{x(n.getFullYear()),i(n.getMonth())},q=t=>e.jsxs("button",{onClick:s=>{s.stopPropagation(),r("/shifts")},className:"w-full text-right rounded px-1.5 py-0.5 text-[11px] leading-tight bg-blue-50 text-blue-800 border border-blue-200 hover:bg-blue-100 transition-colors cursor-pointer truncate flex items-center gap-1",title:`${t.start_time} - ${t.end_time} | ${t.site_name||t.customer_name||"משמרת"}`,children:[e.jsx(k,{className:"w-3 h-3 flex-shrink-0 text-blue-500"}),e.jsxs("span",{className:"truncate",children:[t.start_time," ",t.site_name||t.customer_name||"משמרת"]})]},`shift-${t.id}`),O=t=>e.jsxs("button",{onClick:s=>{s.stopPropagation(),r(`/events/${t.id}`)},className:"w-full text-right rounded px-1.5 py-0.5 text-[11px] leading-tight bg-emerald-50 text-emerald-800 border border-emerald-200 hover:bg-emerald-100 transition-colors cursor-pointer truncate flex items-center gap-1",title:`${t.start_time} - ${t.end_time} | ${t.event_name} | ${t.location}`,children:[e.jsx(_,{className:"w-3 h-3 flex-shrink-0 text-emerald-500"}),e.jsxs("span",{className:"truncate",children:[t.start_time," ",t.event_name]})]},`event-${t.id}`),H=t=>{const s=M[t]||[],o=E[t]||[];let c=[];(a==="all"||a==="shifts")&&(c=c.concat(s.map(q))),(a==="all"||a==="events")&&(c=c.concat(o.map(O)));const h=c.length,T=c.slice(0,L),p=h-L;return e.jsxs("div",{className:"flex flex-col gap-0.5 mt-1",children:[T,p>0&&e.jsxs("span",{className:"text-[10px] text-gray-400 text-center",children:["+",p," נוספים"]})]})},D=w.length,S=$.length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"לוח שנה"}),e.jsx("p",{className:"text-gray-500",children:"תצוגה חודשית של משמרות ואירועים"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-blue-100 border border-blue-300"}),"משמרות (",D,")"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-sm bg-emerald-100 border border-emerald-300"}),"אירועים (",S,")"]})]})})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:Y,className:"btn-secondary p-2","aria-label":"חודש קודם",children:e.jsx(G,{className:"w-5 h-5"})}),e.jsxs("h2",{className:"text-lg font-semibold min-w-[160px] text-center",children:[U[m]," ",d]}),e.jsx("button",{onClick:B,className:"btn-secondary p-2","aria-label":"חודש הבא",children:e.jsx(J,{className:"w-5 h-5"})}),e.jsx("button",{onClick:R,className:"btn-secondary text-sm px-3 py-1.5",children:"היום"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>l("all"),className:`text-sm px-3 py-1.5 rounded-lg transition-colors ${a==="all"?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"הכל"}),e.jsxs("button",{onClick:()=>l("shifts"),className:`text-sm px-3 py-1.5 rounded-lg transition-colors flex items-center gap-1 ${a==="shifts"?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(k,{className:"w-3.5 h-3.5"}),"משמרות"]}),e.jsxs("button",{onClick:()=>l("events"),className:`text-sm px-3 py-1.5 rounded-lg transition-colors flex items-center gap-1 ${a==="events"?"bg-emerald-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(_,{className:"w-3.5 h-3.5"}),"אירועים"]})]})]})}),C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"})}):e.jsxs("div",{className:"card p-0 overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-7 border-b bg-gray-50",children:Z.map((t,s)=>e.jsx("div",{className:`py-3 text-center text-sm font-semibold text-gray-600 ${s<6?"border-l border-gray-200":""} ${s===6?"text-red-500":""}`,children:t},t))}),e.jsx("div",{className:"grid grid-cols-7",children:P.map(({date:t,isCurrentMonth:s},o)=>{const c=j(t),h=c===W,p=t.getDay()===6,b=M[c]||[],y=E[c]||[],K=a==="all"&&(b.length>0||y.length>0)||a==="shifts"&&b.length>0||a==="events"&&y.length>0;return e.jsxs("div",{className:`
                    min-h-[120px] p-1.5 border-b border-l border-gray-200
                    transition-colors
                    ${s?"bg-white":"bg-gray-50"}
                    ${h?"bg-primary-50 ring-2 ring-inset ring-primary-400":""}
                    ${p&&s?"bg-red-50/30":""}
                    ${K?"hover:bg-gray-50":""}
                  `,children:[e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsx("span",{className:`
                        text-sm font-medium w-7 h-7 flex items-center justify-center rounded-full
                        ${h?"bg-primary-500 text-white":""}
                        ${s?"":"text-gray-300"}
                        ${s&&!h&&p?"text-red-400":""}
                        ${s&&!h&&!p?"text-gray-700":""}
                      `,children:t.getDate()}),s&&(b.length>0||y.length>0)&&e.jsxs("div",{className:"flex items-center gap-0.5",children:[b.length>0&&(a==="all"||a==="shifts")&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-400"}),y.length>0&&(a==="all"||a==="events")&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-400"})]})]}),s&&H(c)]},`${c}-${o}`)})})]}),!C&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(k,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:D}),e.jsx("p",{className:"text-sm text-gray-500",children:"משמרות החודש"})]})]}),e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center",children:e.jsx(_,{className:"w-6 h-6 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:S}),e.jsx("p",{className:"text-sm text-gray-500",children:"אירועים החודש"})]})]}),e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(V,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:D+S}),e.jsx("p",{className:"text-sm text-gray-500",children:'סה"כ פריטים'})]})]})]})]})}export{re as default};
