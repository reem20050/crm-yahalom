import{r as b,h as k,d as T,i as g,c as C,j as e,S as P,L as q,p as E,X as M,z as n,q as o}from"./index-vmuGjYfz.js";import{u as A}from"./index.esm-DkHJ7T-n.js";import{t as F,o as Q,s as t,b as N,n as z,l as I}from"./types-CyPoD2DI.js";import{a as K}from"./WhatsAppButton-k1u1ZJ6C.js";import{P as L}from"./plus-CIxyOe6u.js";import{P as O}from"./phone-qzm71CD_.js";import{S as $}from"./shield-PLRY_L6g.js";import{T as D}from"./trash-2-DXQhv5Lj.js";import"./message-circle-DUOvsKYn.js";const R=Q({first_name:t().min(1,"נדרש שם פרטי"),last_name:t().min(1,"נדרש שם משפחה"),id_number:t().min(1,"נדרש מספר ת.ז"),phone:t().min(1,"נדרש מספר טלפון"),email:t().email("אימייל לא תקין").optional().or(I("")),address:t().optional(),city:t().optional(),hire_date:t().min(1,"נדרש תאריך תחילת עבודה"),employment_type:t().optional(),hourly_rate:z().optional(),has_weapon_license:N().optional(),has_driving_license:N().optional(),driving_license_type:t().optional(),emergency_contact_name:t().optional(),emergency_contact_phone:t().optional()});function Z(){var h;const[c,y]=b.useState(""),[f,r]=b.useState(!1),x=k(),{data:i,isLoading:v}=T({queryKey:["employees",{search:c}],queryFn:()=>o.getAll({search:c,limit:50}).then(s=>s.data)}),d=g({mutationFn:s=>o.create(s),onSuccess:()=>{x.invalidateQueries({queryKey:["employees"]}),n.success("עובד נוצר בהצלחה"),r(!1),m()},onError:()=>{n.error("שגיאה ביצירת עובד")}}),_=g({mutationFn:s=>o.delete(s),onSuccess:()=>{x.invalidateQueries({queryKey:["employees"]}),n.success("נמחק בהצלחה")},onError:()=>{n.error("שגיאה במחיקה")}}),{register:a,handleSubmit:w,reset:m,formState:{errors:l}}=A({resolver:F(R),defaultValues:{hire_date:new Date().toISOString().split("T")[0],employment_type:"hourly",has_weapon_license:!1,has_driving_license:!1}}),{can:p}=C(),S=s=>{d.mutate(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"עובדים"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"ניהול עובדים ומסמכים"})]}),p("employees:create")&&e.jsxs("button",{onClick:()=>r(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"עובד חדש"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש עובדים...",value:c,onChange:s=>y(s.target.value),className:"input pr-11"})]}),v?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary-600 border-t-transparent"})}):((h=i==null?void 0:i.employees)==null?void 0:h.length)>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.employees.map(s=>{var u,j;return e.jsx("div",{className:"card hover:shadow-elevated transition-all duration-200",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsxs(q,{to:`/employees/${s.id}`,className:"flex items-start gap-3.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-11 h-11 bg-primary-50 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsxs("span",{className:"text-primary-700 font-semibold text-sm",children:[(u=s.first_name)==null?void 0:u[0],(j=s.last_name)==null?void 0:j[0]]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 text-sm",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1.5 mt-1",children:[e.jsx(O,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{dir:"ltr",children:s.phone}),e.jsx(K,{phone:s.phone,message:`שלום ${s.first_name}, 

צוות יהלום`})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-2",children:[e.jsx("span",{className:`badge ${s.status==="active"?"badge-success":"badge-gray"}`,children:s.status==="active"?"פעיל":"לא פעיל"}),s.has_weapon_license&&e.jsxs("span",{className:"badge badge-info flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),"נשק"]})]})]})]}),p("employees:delete")&&e.jsx("button",{onClick:()=>{confirm("האם אתה בטוח שברצונך למחוק עובד זה?")&&_.mutate(s.id)},className:"p-1.5 rounded-lg text-gray-300 hover:text-red-500 hover:bg-red-50 transition-colors",title:"מחק",children:e.jsx(D,{className:"w-4 h-4"})})]})},s.id)})}):e.jsxs("div",{className:"card text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-50 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(E,{className:"w-8 h-8 text-gray-300"})}),e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"לא נמצאו עובדים"}),e.jsx("button",{onClick:()=>r(!0),className:"btn-primary",children:"הוסף עובד ראשון"})]}),f&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/40 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-modal w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-slide-up",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"עובד חדש"}),e.jsx("button",{onClick:()=>{r(!1),m()},className:"p-2 hover:bg-gray-100 rounded-xl text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(M,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:w(S),className:"p-6 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם פרטי *"}),e.jsx("input",{...a("first_name"),className:"input"}),l.first_name&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.first_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם משפחה *"}),e.jsx("input",{...a("last_name"),className:"input"}),l.last_name&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.last_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"ת.ז *"}),e.jsx("input",{...a("id_number"),className:"input",dir:"ltr"}),l.id_number&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.id_number.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון *"}),e.jsx("input",{...a("phone"),className:"input",dir:"ltr"}),l.phone&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אימייל"}),e.jsx("input",{...a("email"),type:"email",className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תאריך תחילת עבודה *"}),e.jsx("input",{...a("hire_date"),type:"date",className:"input"}),l.hire_date&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.hire_date.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"כתובת"}),e.jsx("input",{...a("address"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"עיר"}),e.jsx("input",{...a("city"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג העסקה"}),e.jsxs("select",{...a("employment_type"),className:"input",children:[e.jsx("option",{value:"hourly",children:"שעתי"}),e.jsx("option",{value:"monthly",children:"חודשי"}),e.jsx("option",{value:"contractor",children:"קבלן"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שכר שעתי"}),e.jsx("input",{...a("hourly_rate",{valueAsNumber:!0}),type:"number",step:"0.01",className:"input",dir:"ltr"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 border-t border-gray-100 pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"רישיונות"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{...a("has_weapon_license"),type:"checkbox",className:"w-4 h-4 text-primary-600 rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700",children:"רישיון נשק"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{...a("has_driving_license"),type:"checkbox",className:"w-4 h-4 text-primary-600 rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700",children:"רישיון נהיגה"})]})]})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 border-t border-gray-100 pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"איש קשר לחירום"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם"}),e.jsx("input",{...a("emergency_contact_name"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון"}),e.jsx("input",{...a("emergency_contact_phone"),className:"input",dir:"ltr"})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-100",children:[e.jsx("button",{type:"submit",disabled:d.isPending,className:"btn-primary flex-1",children:d.isPending?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"שומר..."]}):"שמור"}),e.jsx("button",{type:"button",onClick:()=>{r(!1),m()},className:"btn-secondary",children:"ביטול"})]})]})]})})]})}export{Z as default};
