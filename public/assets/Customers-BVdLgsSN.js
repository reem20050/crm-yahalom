import{r as h,h as _,e as w,i as u,j as e,S,L as C,B as j,X as k,z as c,m as o}from"./index-BGOlPzIM.js";import{u as M}from"./index.esm-BhRLWoPf.js";import{t as T,o as q,s as t,l as P}from"./types-JheIi145.js";import{P as E}from"./plus-BSkoP1vL.js";import{M as F}from"./map-pin-DO8tcCZO.js";import{T as Q}from"./trash-2-D90EavDq.js";const z=q({company_name:t().min(1,"נדרש שם חברה"),business_id:t().optional(),address:t().optional(),city:t().optional(),service_type:t().optional(),payment_terms:t().optional(),notes:t().optional(),contact_name:t().min(1,"נדרש שם איש קשר"),contact_phone:t().min(1,"נדרש טלפון איש קשר"),contact_email:t().email("אימייל לא תקין").optional().or(P("")),contact_role:t().optional()});function I(){var p;const[r,N]=h.useState(""),[b,i]=h.useState(!1),x=_(),{data:n,isLoading:y}=w({queryKey:["customers",{search:r}],queryFn:()=>o.getAll({search:r,limit:50}).then(s=>s.data)}),m=u({mutationFn:s=>o.create(s),onSuccess:()=>{x.invalidateQueries({queryKey:["customers"]}),c.success("לקוח נוצר בהצלחה"),i(!1),d()},onError:()=>{c.error("שגיאה ביצירת לקוח")}}),v=u({mutationFn:s=>o.delete(s),onSuccess:()=>{x.invalidateQueries({queryKey:["customers"]}),c.success("נמחק בהצלחה")},onError:()=>{c.error("שגיאה במחיקה")}}),{register:a,handleSubmit:g,reset:d,formState:{errors:l}}=M({resolver:T(z),defaultValues:{payment_terms:"net30",service_type:"regular"}}),f=s=>{m.mutate(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"לקוחות"}),e.jsx("p",{className:"text-gray-500",children:"ניהול לקוחות וחוזים"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"לקוח חדש"]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש לקוחות...",value:r,onChange:s=>N(s.target.value),className:"input pr-10"})]})}),y?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-primary-500 border-t-transparent"})}):((p=n==null?void 0:n.customers)==null?void 0:p.length)>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.customers.map(s=>e.jsx("div",{className:"card hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(C,{to:`/customers/${s.id}`,className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center",children:e.jsx(j,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.company_name}),s.city&&e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),s.city]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("span",{className:`badge ${s.status==="active"?"badge-success":"badge-gray"}`,children:s.status==="active"?"פעיל":"לא פעיל"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.sites_count," אתרים"]})]})]})]}),e.jsx("button",{onClick:()=>{confirm("האם אתה בטוח שברצונך למחוק לקוח זה?")&&v.mutate(s.id)},className:"text-red-400 hover:text-red-600 p-1",title:"מחק",children:e.jsx(Q,{className:"w-4 h-4"})})]})},s.id))}):e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(j,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"לא נמצאו לקוחות"}),e.jsx("button",{onClick:()=>i(!0),className:"btn-primary",children:"הוסף לקוח ראשון"})]}),b&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:"לקוח חדש"}),e.jsx("button",{onClick:()=>{i(!1),d()},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(k,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:g(f),className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("h3",{className:"font-medium mb-3 text-gray-700",children:"פרטי החברה"})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"שם החברה *"}),e.jsx("input",{...a("company_name"),className:"input"}),l.company_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.company_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"ח.פ / ע.מ"}),e.jsx("input",{...a("business_id"),className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג שירות"}),e.jsxs("select",{...a("service_type"),className:"input",children:[e.jsx("option",{value:"regular",children:"שמירה קבועה"}),e.jsx("option",{value:"events",children:"אירועים"}),e.jsx("option",{value:"consulting",children:"ייעוץ"}),e.jsx("option",{value:"mixed",children:"משולב"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"כתובת"}),e.jsx("input",{...a("address"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"עיר"}),e.jsx("input",{...a("city"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תנאי תשלום"}),e.jsxs("select",{...a("payment_terms"),className:"input",children:[e.jsx("option",{value:"immediate",children:"מיידי"}),e.jsx("option",{value:"net15",children:"שוטף + 15"}),e.jsx("option",{value:"net30",children:"שוטף + 30"}),e.jsx("option",{value:"net45",children:"שוטף + 45"}),e.jsx("option",{value:"net60",children:"שוטף + 60"})]})]}),e.jsx("div",{className:"col-span-2 border-t pt-4 mt-2",children:e.jsx("h3",{className:"font-medium mb-3 text-gray-700",children:"איש קשר ראשי"})}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם איש קשר *"}),e.jsx("input",{...a("contact_name"),className:"input"}),l.contact_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.contact_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תפקיד"}),e.jsx("input",{...a("contact_role"),className:"input",placeholder:"מנכ״ל, מנהל תפעול..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון *"}),e.jsx("input",{...a("contact_phone"),className:"input",dir:"ltr"}),l.contact_phone&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.contact_phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אימייל"}),e.jsx("input",{...a("contact_email"),type:"email",className:"input",dir:"ltr"}),l.contact_email&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.contact_email.message})]}),e.jsxs("div",{className:"col-span-2 border-t pt-4 mt-2",children:[e.jsx("label",{className:"label",children:"הערות"}),e.jsx("textarea",{...a("notes"),className:"input min-h-[80px]"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:m.isPending,className:"btn-primary flex-1",children:m.isPending?"שומר...":"שמור"}),e.jsx("button",{type:"button",onClick:()=>{i(!1),d()},className:"btn-secondary",children:"ביטול"})]})]})]})})]})}export{I as default};
