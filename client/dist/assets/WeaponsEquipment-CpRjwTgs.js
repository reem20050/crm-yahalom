import{c as U,a as V,r as o,h as Y,d as P,i as x,j as s,X as Z,w as M,S as D,z as t,D as j,E as b,t as ee}from"./index-JKjlBWqP.js";import{P as se}from"./plus-D55zDAxi.js";import{P as I}from"./package-Dws3lKrU.js";import{A as ae}from"./arrow-left-right-BOw-iQ0z.js";import{T as O}from"./trash-2-DEta57Ha.js";const ne=[{value:"new",label:"חדש"},{value:"good",label:"תקין"},{value:"fair",label:"סביר"},{value:"needs_repair",label:"דורש תיקון"},{value:"damaged",label:"פגום"}];function oe(){var Q,W;const{isEmployee:N,can:v}=U(),f=V(e=>e.user),d=f==null?void 0:f.employeeId,[i,T]=o.useState("weapons"),[h,g]=o.useState(!1),[y,_]=o.useState(""),[q,C]=o.useState(null),[k,A]=o.useState(""),m=Y(),[a,r]=o.useState({weapon_type:"",manufacturer:"",model:"",serial_number:"",license_number:"",license_expiry:"",employee_id:"",notes:""}),[n,c]=o.useState({item_type:"",item_name:"",serial_number:"",condition:"good",employee_id:"",notes:""}),{data:u,isLoading:z}=P({queryKey:["all-weapons",N?d:"all"],queryFn:()=>N&&d?j.getByEmployee(d).then(e=>e.data):j.getAll().then(e=>e.data),enabled:i==="weapons"}),{data:p,isLoading:B}=P({queryKey:["all-equipment",N?d:"all"],queryFn:()=>N&&d?b.getByEmployee(d).then(e=>e.data):b.getAll().then(e=>e.data),enabled:i==="equipment"}),{data:w}=P({queryKey:["employees-active"],queryFn:()=>ee.getAll({status:"active",limit:200}).then(e=>e.data)}),E=(w==null?void 0:w.employees)||[],S=x({mutationFn:e=>j.create(e),onSuccess:()=>{m.invalidateQueries({queryKey:["all-weapons"]}),t.success("נשק נוסף בהצלחה"),g(!1),r({weapon_type:"",manufacturer:"",model:"",serial_number:"",license_number:"",license_expiry:"",employee_id:"",notes:""})},onError:()=>t.error("שגיאה בהוספת נשק")}),R=x({mutationFn:e=>j.delete(e),onSuccess:()=>{m.invalidateQueries({queryKey:["all-weapons"]}),t.success("נשק נמחק")},onError:()=>t.error("שגיאה במחיקה")}),F=x({mutationFn:({id:e,employee_id:l})=>j.transfer(e,l),onSuccess:()=>{m.invalidateQueries({queryKey:["all-weapons"]}),t.success("הנשק הועבר בהצלחה"),C(null),A("")},onError:()=>t.error("שגיאה בהעברה")}),$=x({mutationFn:e=>b.create(e),onSuccess:()=>{m.invalidateQueries({queryKey:["all-equipment"]}),t.success("ציוד נוסף בהצלחה"),g(!1),c({item_type:"",item_name:"",serial_number:"",condition:"good",employee_id:"",notes:""})},onError:()=>t.error("שגיאה בהוספת ציוד")}),X=x({mutationFn:e=>b.returnItem(e,"good"),onSuccess:()=>{m.invalidateQueries({queryKey:["all-equipment"]}),t.success("ציוד הוחזר")},onError:()=>t.error("שגיאה בהחזרה")}),G=x({mutationFn:e=>b.delete(e),onSuccess:()=>{m.invalidateQueries({queryKey:["all-equipment"]}),t.success("ציוד נמחק")},onError:()=>t.error("שגיאה במחיקה")}),H=i==="weapons"?z:B,K=((u==null?void 0:u.weapons)||[]).filter(e=>!y||[e.weapon_type,e.serial_number,e.employee_name,e.manufacturer].some(l=>l==null?void 0:l.toLowerCase().includes(y.toLowerCase()))),L=((p==null?void 0:p.equipment)||[]).filter(e=>!y||[e.item_type,e.item_name,e.employee_name,e.serial_number].some(l=>l==null?void 0:l.toLowerCase().includes(y.toLowerCase())));return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"נשק וציוד"}),s.jsx("p",{className:"text-gray-500",children:"ניהול נשק, ציוד ומלאי"})]}),v("weapons:manage")&&s.jsxs("button",{onClick:()=>g(!h),className:"btn-primary flex items-center gap-2",children:[h?s.jsx(Z,{className:"w-5 h-5"}):s.jsx(se,{className:"w-5 h-5"}),h?"ביטול":i==="weapons"?"הוסף נשק":"הוסף ציוד"]})]}),s.jsxs("div",{className:"flex items-center gap-4 border-b",children:[s.jsxs("button",{onClick:()=>{T("weapons"),g(!1),_("")},className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${i==="weapons"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[s.jsx(M,{className:"w-5 h-5"}),"נשק (",((Q=u==null?void 0:u.weapons)==null?void 0:Q.length)||0,")"]}),s.jsxs("button",{onClick:()=>{T("equipment"),g(!1),_("")},className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${i==="equipment"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[s.jsx(I,{className:"w-5 h-5"}),"ציוד (",((W=p==null?void 0:p.equipment)==null?void 0:W.length)||0,")"]})]}),s.jsxs("div",{className:"relative",children:[s.jsx(D,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),s.jsx("input",{type:"text",value:y,onChange:e=>_(e.target.value),placeholder:"חיפוש...",className:"input pr-10"})]}),h&&i==="weapons"&&s.jsxs("form",{onSubmit:e=>{e.preventDefault(),S.mutate({...a,employee_id:a.employee_id||null,status:a.employee_id?"assigned":"in_armory"})},className:"card space-y-4",children:[s.jsx("h3",{className:"font-semibold text-lg",children:"הוספת נשק חדש"}),s.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"סוג נשק *"}),s.jsx("input",{value:a.weapon_type,onChange:e=>r({...a,weapon_type:e.target.value}),className:"input",placeholder:"לדוגמה: אקדח, רובה...",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"יצרן"}),s.jsx("input",{value:a.manufacturer,onChange:e=>r({...a,manufacturer:e.target.value}),className:"input"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"דגם"}),s.jsx("input",{value:a.model,onChange:e=>r({...a,model:e.target.value}),className:"input"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"מספר סידורי *"}),s.jsx("input",{value:a.serial_number,onChange:e=>r({...a,serial_number:e.target.value}),className:"input",dir:"ltr",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"מספר רישיון"}),s.jsx("input",{value:a.license_number,onChange:e=>r({...a,license_number:e.target.value}),className:"input",dir:"ltr"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"תפוגת רישיון"}),s.jsx("input",{type:"date",value:a.license_expiry,onChange:e=>r({...a,license_expiry:e.target.value}),className:"input"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"הקצה למאבטח"}),s.jsxs("select",{value:a.employee_id,onChange:e=>r({...a,employee_id:e.target.value}),className:"input",children:[s.jsx("option",{value:"",children:"במחסן"}),E.map(e=>s.jsxs("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),s.jsxs("div",{className:"lg:col-span-2",children:[s.jsx("label",{className:"label",children:"הערות"}),s.jsx("input",{value:a.notes,onChange:e=>r({...a,notes:e.target.value}),className:"input"})]})]}),s.jsx("button",{type:"submit",disabled:S.isPending,className:"btn-primary",children:S.isPending?"שומר...":"הוסף נשק"})]}),h&&i==="equipment"&&s.jsxs("form",{onSubmit:e=>{e.preventDefault(),$.mutate({...n,employee_id:n.employee_id||null})},className:"card space-y-4",children:[s.jsx("h3",{className:"font-semibold text-lg",children:"הוספת ציוד חדש"}),s.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"סוג ציוד *"}),s.jsx("input",{value:n.item_type,onChange:e=>c({...n,item_type:e.target.value}),className:"input",placeholder:"לדוגמה: רדיו, אפוד, פנס...",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"שם פריט *"}),s.jsx("input",{value:n.item_name,onChange:e=>c({...n,item_name:e.target.value}),className:"input",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"מספר סידורי"}),s.jsx("input",{value:n.serial_number,onChange:e=>c({...n,serial_number:e.target.value}),className:"input",dir:"ltr"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"מצב"}),s.jsx("select",{value:n.condition,onChange:e=>c({...n,condition:e.target.value}),className:"input",children:ne.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"הקצה למאבטח"}),s.jsxs("select",{value:n.employee_id,onChange:e=>c({...n,employee_id:e.target.value}),className:"input",children:[s.jsx("option",{value:"",children:"לא מוקצה"}),E.map(e=>s.jsxs("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"הערות"}),s.jsx("input",{value:n.notes,onChange:e=>c({...n,notes:e.target.value}),className:"input"})]})]}),s.jsx("button",{type:"submit",disabled:$.isPending,className:"btn-primary",children:$.isPending?"שומר...":"הוסף ציוד"})]}),q&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/40 backdrop-blur-sm animate-fade-in",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md p-6",children:[s.jsxs("h3",{className:"text-lg font-bold mb-4",children:["העברת נשק: ",q.name]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"העבר למאבטח"}),s.jsxs("select",{value:k,onChange:e=>A(e.target.value),className:"input",children:[s.jsx("option",{value:"",children:"החזר למחסן"}),E.map(e=>s.jsxs("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>F.mutate({id:q.id,employee_id:k||null}),disabled:F.isPending,className:"btn-primary flex-1",children:F.isPending?"מעביר...":"העבר"}),s.jsx("button",{onClick:()=>C(null),className:"btn-secondary",children:"ביטול"})]})]})]})}),H?s.jsx("div",{className:"flex items-center justify-center h-48",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary-600 border-t-transparent"})}):i==="weapons"?s.jsx("div",{className:"space-y-3",children:K.length>0?K.map(e=>s.jsx("div",{className:"card p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${e.status==="assigned"?"bg-green-100":e.status==="maintenance"?"bg-yellow-100":"bg-gray-100"}`,children:s.jsx(M,{className:`w-6 h-6 ${e.status==="assigned"?"text-green-600":e.status==="maintenance"?"text-yellow-600":"text-gray-600"}`})}),s.jsxs("div",{children:[s.jsxs("p",{className:"font-semibold",children:[e.weapon_type," ",e.manufacturer&&`- ${e.manufacturer}`," ",e.model||""]}),s.jsxs("p",{className:"text-sm text-gray-500",children:['מס"ס: ',s.jsx("span",{dir:"ltr",children:e.serial_number}),e.license_number&&` | רישיון: ${e.license_number}`]}),e.employee_name&&s.jsxs("p",{className:"text-sm text-green-600",children:["מוקצה ל: ",e.employee_name]}),e.license_expiry&&s.jsxs("p",{className:"text-xs text-gray-400",children:["תפוגת רישיון: ",e.license_expiry]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`badge ${e.status==="assigned"?"badge-success":e.status==="maintenance"?"badge-warning":"badge-gray"}`,children:e.status==="assigned"?"מוקצה":e.status==="maintenance"?"בתחזוקה":"במחסן"}),v("weapons:manage")&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:()=>C({id:e.id,name:`${e.weapon_type} ${e.serial_number}`}),className:"btn-secondary text-xs px-2 py-1 flex items-center gap-1",title:"העבר",children:[s.jsx(ae,{className:"w-3.5 h-3.5"}),"העבר"]}),s.jsx("button",{onClick:()=>{confirm("למחוק נשק זה?")&&R.mutate(e.id)},className:"text-red-400 hover:text-red-600 p-1",children:s.jsx(O,{className:"w-4 h-4"})})]})]})]})},e.id)):s.jsx("p",{className:"text-gray-400 text-center py-8",children:"אין נשק רשום"})}):s.jsx("div",{className:"space-y-3",children:L.length>0?L.map(e=>{const l=!!e.employee_id&&!e.return_date,J={new:"חדש",good:"תקין",fair:"סביר",needs_repair:"דורש תיקון",damaged:"פגום"};return s.jsx("div",{className:"card p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${l?"bg-blue-100":"bg-gray-100"}`,children:s.jsx(I,{className:`w-6 h-6 ${l?"text-blue-600":"text-gray-600"}`})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:e.item_name}),s.jsxs("p",{className:"text-sm text-gray-500",children:[e.item_type,e.serial_number&&` | מס"ס: ${e.serial_number}`]}),l&&e.employee_name&&s.jsxs("p",{className:"text-sm text-blue-600",children:["מוקצה ל: ",e.employee_name]}),e.return_date&&s.jsxs("p",{className:"text-xs text-gray-400",children:["הוחזר: ",e.return_date]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`badge ${e.condition==="good"||e.condition==="new"?"badge-success":e.condition==="fair"?"badge-warning":"badge-danger"}`,children:J[e.condition]||e.condition}),v("equipment:manage")&&s.jsxs(s.Fragment,{children:[l&&s.jsx("button",{onClick:()=>X.mutate(e.id),className:"btn-secondary text-xs px-2 py-1",children:"החזר"}),s.jsx("button",{onClick:()=>{confirm("למחוק ציוד זה?")&&G.mutate(e.id)},className:"text-red-400 hover:text-red-600 p-1",children:s.jsx(O,{className:"w-4 h-4"})})]})]})]})},e.id)}):s.jsx("p",{className:"text-gray-400 text-center py-8",children:"אין ציוד רשום"})})]})}export{oe as default};
