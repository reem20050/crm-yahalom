import{r as u,h as w,d as S,i as j,c as k,j as e,S as C,L as M,B as N,X as T,z as c,m as o}from"./index-JKjlBWqP.js";import{u as P}from"./index.esm-BjcwIVP4.js";import{t as q,o as E,s as t,l as F}from"./types-CZGUu-Ca.js";import{P as Q}from"./plus-D55zDAxi.js";import{M as z}from"./map-pin-CWqW4J8V.js";import{T as K}from"./trash-2-DEta57Ha.js";const L=E({company_name:t().min(1,"נדרש שם חברה"),business_id:t().optional(),address:t().optional(),city:t().optional(),service_type:t().optional(),payment_terms:t().optional(),notes:t().optional(),contact_name:t().min(1,"נדרש שם איש קשר"),contact_phone:t().min(1,"נדרש טלפון איש קשר"),contact_email:t().email("אימייל לא תקין").optional().or(F("")),contact_role:t().optional()});function V(){var h;const[r,b]=u.useState(""),[y,n]=u.useState(!1),x=w(),{data:i,isLoading:v}=S({queryKey:["customers",{search:r}],queryFn:()=>o.getAll({search:r,limit:50}).then(s=>s.data)}),m=j({mutationFn:s=>o.create(s),onSuccess:()=>{x.invalidateQueries({queryKey:["customers"]}),c.success("לקוח נוצר בהצלחה"),n(!1),d()},onError:()=>{c.error("שגיאה ביצירת לקוח")}}),g=j({mutationFn:s=>o.delete(s),onSuccess:()=>{x.invalidateQueries({queryKey:["customers"]}),c.success("נמחק בהצלחה")},onError:()=>{c.error("שגיאה במחיקה")}}),{register:a,handleSubmit:f,reset:d,formState:{errors:l}}=P({resolver:q(L),defaultValues:{payment_terms:"net30",service_type:"regular"}}),{can:p}=k(),_=s=>{m.mutate(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"לקוחות"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"ניהול לקוחות וחוזים"})]}),p("customers:create")&&e.jsxs("button",{onClick:()=>n(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"לקוח חדש"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"חיפוש לקוחות...",value:r,onChange:s=>b(s.target.value),className:"input pr-11"})]}),v?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary-600 border-t-transparent"})}):((h=i==null?void 0:i.customers)==null?void 0:h.length)>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.customers.map(s=>e.jsx("div",{className:"card hover:shadow-elevated transition-all duration-200",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsxs(M,{to:`/customers/${s.id}`,className:"flex items-start gap-3.5 flex-1 min-w-0",children:[e.jsx("div",{className:"w-11 h-11 bg-primary-50 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(N,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm text-gray-900 truncate",children:s.company_name}),s.city&&e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1 mt-0.5",children:[e.jsx(z,{className:"w-3 h-3 flex-shrink-0"}),s.city]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:`badge ${s.status==="active"?"badge-success":"badge-gray"}`,children:s.status==="active"?"פעיל":"לא פעיל"}),e.jsxs("span",{className:"text-xs text-gray-400",children:[s.sites_count," אתרים"]})]})]})]}),p("customers:delete")&&e.jsx("button",{onClick:()=>{confirm("האם אתה בטוח שברצונך למחוק לקוח זה?")&&g.mutate(s.id)},className:"p-1.5 rounded-lg text-gray-300 hover:text-red-500 hover:bg-red-50 transition-colors",title:"מחק",children:e.jsx(K,{className:"w-4 h-4"})})]})},s.id))}):e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(N,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"לא נמצאו לקוחות"}),e.jsx("button",{onClick:()=>n(!0),className:"btn-primary",children:"הוסף לקוח ראשון"})]}),y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/40 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-modal w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-slide-up",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:"לקוח חדש"}),e.jsx("button",{onClick:()=>{n(!1),d()},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(T,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:f(_),className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("h3",{className:"font-medium mb-3 text-gray-700",children:"פרטי החברה"})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"שם החברה *"}),e.jsx("input",{...a("company_name"),className:"input"}),l.company_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.company_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"ח.פ / ע.מ"}),e.jsx("input",{...a("business_id"),className:"input",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג שירות"}),e.jsxs("select",{...a("service_type"),className:"input",children:[e.jsx("option",{value:"regular",children:"שמירה קבועה"}),e.jsx("option",{value:"events",children:"אירועים"}),e.jsx("option",{value:"consulting",children:"ייעוץ"}),e.jsx("option",{value:"mixed",children:"משולב"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"כתובת"}),e.jsx("input",{...a("address"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"עיר"}),e.jsx("input",{...a("city"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תנאי תשלום"}),e.jsxs("select",{...a("payment_terms"),className:"input",children:[e.jsx("option",{value:"immediate",children:"מיידי"}),e.jsx("option",{value:"net15",children:"שוטף + 15"}),e.jsx("option",{value:"net30",children:"שוטף + 30"}),e.jsx("option",{value:"net45",children:"שוטף + 45"}),e.jsx("option",{value:"net60",children:"שוטף + 60"})]})]}),e.jsx("div",{className:"col-span-2 border-t pt-4 mt-2",children:e.jsx("h3",{className:"font-medium mb-3 text-gray-700",children:"איש קשר ראשי"})}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם איש קשר *"}),e.jsx("input",{...a("contact_name"),className:"input"}),l.contact_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.contact_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"תפקיד"}),e.jsx("input",{...a("contact_role"),className:"input",placeholder:"מנכ״ל, מנהל תפעול..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"טלפון *"}),e.jsx("input",{...a("contact_phone"),className:"input",dir:"ltr"}),l.contact_phone&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.contact_phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אימייל"}),e.jsx("input",{...a("contact_email"),type:"email",className:"input",dir:"ltr"}),l.contact_email&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.contact_email.message})]}),e.jsxs("div",{className:"col-span-2 border-t pt-4 mt-2",children:[e.jsx("label",{className:"label",children:"הערות"}),e.jsx("textarea",{...a("notes"),className:"input min-h-[80px]"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:m.isPending,className:"btn-primary flex-1",children:m.isPending?"שומר...":"שמור"}),e.jsx("button",{type:"button",onClick:()=>{n(!1),d()},className:"btn-secondary",children:"ביטול"})]})]})]})})]})}export{V as default};
